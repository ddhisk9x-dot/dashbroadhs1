(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1389:(e,t,s)=>{Promise.resolve().then(s.bind(s,3955))},3955:(e,t,s)=>{"use strict";s.d(t,{default:()=>ex});var a=s(5155),l=s(2115);async function n(e,t){let s=await fetch(e,{credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},...t});if(!s.ok)throw Error(await s.text().catch(()=>"")||"HTTP ".concat(s.status));return await s.json()}let r={async login(e,t){try{let s=await n("/api/login",{method:"POST",body:JSON.stringify({username:e,password:t})});if(!s.ok)return{success:!1,error:s.error||"Đăng nhập thất bại"};return{success:!0,user:s.user}}catch(e){return{success:!1,error:(null==e?void 0:e.message)||"Lỗi kết nối server"}}},async logout(){await n("/api/logout",{method:"POST"})},getAllStudents:async()=>(await n("/api/admin/get-students")).students||[],async getStudentMe(e){let t=await n("/api/student/me");return{...t.student,stats:t.stats}},importExcel:async e=>(await n("/api/admin/save-students",{method:"POST",body:JSON.stringify({students:e})}),{success:!0}),saveReport:async(e,t,s,a)=>(await n("/api/admin/save-report",{method:"POST",body:JSON.stringify({mhs:e,report:t,actions:s,monthKey:a})}),{success:!0}),async tick(e,t,s,a){let l="",r="",i=!1;return"boolean"==typeof a?(l=String(null!=t?t:"").trim(),r=String(null!=s?s:"").trim(),i=!!a):(l=String(null!=e?e:"").trim(),r=String(null!=t?t:"").trim(),i=!!s),{success:!0,student:(await n("/api/student/tick",{method:"POST",body:JSON.stringify({actionId:l,date:r,completed:i})})).student}},generateStudentReport:async e=>n("/api/ai/generate-report",{method:"POST",body:JSON.stringify({student:e})}),syncSheet:async e=>n("/api/sync/sheets",{method:"POST",body:JSON.stringify(e||{mode:"new_only"})})},i=r.generateStudentReport;var o=s(5299);function d(){let[e,t]=(0,l.useState)(""),[s,n]=(0,l.useState)(""),[r,i]=(0,l.useState)(""),[d,c]=(0,l.useState)(!1),x=async()=>{if(!e||!s)return alert("Nhập đủ mật khẩu hiện tại + mật khẩu mới");if(s!==r)return alert("Mật khẩu mới nhập lại kh\xf4ng khớp");c(!0);try{let a=await fetch("/api/account/change-password",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:s})}),l=await a.json().catch(()=>({}));if(!a.ok||!(null==l?void 0:l.ok))return alert((null==l?void 0:l.error)||"Đổi mật khẩu thất bại");t(""),n(""),i(""),alert("Đổi mật khẩu th\xe0nh c\xf4ng")}catch(e){alert((null==e?void 0:e.message)||"Network error")}finally{c(!1)}};return(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800 mb-3",children:"Đổi mật khẩu"}),(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsx)("input",{type:"password",value:e,onChange:e=>t(e.target.value),placeholder:"Mật khẩu hiện tại",className:"px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500"}),(0,a.jsx)("input",{type:"password",value:s,onChange:e=>n(e.target.value),placeholder:"Mật khẩu mới",className:"px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500"}),(0,a.jsx)("input",{type:"password",value:r,onChange:e=>i(e.target.value),placeholder:"Nhập lại mật khẩu mới",className:"px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500"}),(0,a.jsxs)("button",{onClick:x,disabled:d,className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white font-semibold disabled:opacity-50",children:[d?(0,a.jsx)(o.A,{className:"animate-spin",size:18}):null,"Lưu mật khẩu mới"]})]})]})}var c=s(814),x=s(2472),h=s(5917),m=s(8104),u=s(6265),g=s(9564),p=s(8425),b=s(7734),f=s(3697),v=s(3420),j=s(46),N=s(4344);let y=e=>{let{data:t,stats:s,subject:l}=e,n=!l||"math"===l,r=!l||"lit"===l,i=!l||"eng"===l;return(0,a.jsxs)("div",{className:"h-96 w-full bg-white p-6 rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100/50 transition-all hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)]",children:[!l&&(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-6 bg-indigo-500 rounded-full inline-block"}),"Biểu đồ Học tập"]})}),(0,a.jsx)(u.u,{width:"100%",height:l?"100%":"85%",children:(0,a.jsxs)(g.b,{data:t,margin:{top:10,right:30,left:0,bottom:5},children:[(0,a.jsx)(p.d,{strokeDasharray:"3 3",stroke:"#f1f5f9",vertical:!1}),(0,a.jsx)(b.W,{dataKey:"month",stroke:"#94a3b8",tick:{fontSize:12,fill:"#64748b"},axisLine:!1,tickLine:!1,dy:10}),(0,a.jsx)(f.h,{domain:[0,15],stroke:"#94a3b8",tick:{fontSize:12,fill:"#64748b"},axisLine:!1,tickLine:!1,dx:-10}),(0,a.jsx)(v.m,{contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)",padding:"12px",backgroundColor:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(4px)"},cursor:{stroke:"#cbd5e1",strokeWidth:1,strokeDasharray:"4 4"}}),(0,a.jsx)(j.s,{wrapperStyle:{paddingTop:"20px"}}),n&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"math",name:"To\xe1n",stroke:"#3b82f6",strokeWidth:3,dot:{r:4,strokeWidth:2,fill:"#fff"},activeDot:{r:7,strokeWidth:0}}),r&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"lit",name:"Văn",stroke:"#ec4899",strokeWidth:3,dot:{r:4,strokeWidth:2,fill:"#fff"},activeDot:{r:7,strokeWidth:0}}),i&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"eng",name:"Anh",stroke:"#8b5cf6",strokeWidth:3,dot:{r:4,strokeWidth:2,fill:"#fff"},activeDot:{r:7,strokeWidth:0}}),n&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"gradeMath",name:"TB Khối To\xe1n",stroke:"#3b82f6",strokeWidth:2,strokeDasharray:"3 3",dot:!1,activeDot:{r:4,strokeWidth:0}}),r&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"gradeLit",name:"TB Khối Văn",stroke:"#ec4899",strokeWidth:2,strokeDasharray:"3 3",dot:!1,activeDot:{r:4,strokeWidth:0}}),i&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"gradeEng",name:"TB Khối Anh",stroke:"#8b5cf6",strokeWidth:2,strokeDasharray:"3 3",dot:!1,activeDot:{r:4,strokeWidth:0}}),n&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"targetMath",name:"Mục ti\xeau To\xe1n",stroke:"#dc2626",strokeWidth:2,strokeDasharray:"6 4",dot:!1}),r&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"targetLit",name:"Mục ti\xeau Văn",stroke:"#dc2626",strokeWidth:2,strokeDasharray:"6 4",dot:!1}),i&&(0,a.jsx)(N.N1,{connectNulls:!1,type:"monotone",dataKey:"targetEng",name:"Mục ti\xeau Anh",stroke:"#dc2626",strokeWidth:2,strokeDasharray:"6 4",dot:!1})]})})]})};var w=s(4926);function k(e){let{student:t,onLogout:s,streak:l}=e;return(0,a.jsx)("div",{className:"bg-white border-b border-slate-200/60 px-5 py-4 sticky top-0 z-20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"text-slate-800 font-bold text-lg",children:["Xin ch\xe0o, ",(0,a.jsx)("span",{className:"uppercase",children:t.name})," \uD83D\uDC4B"]}),l>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-orange-50 border border-orange-100 px-2 py-0.5 rounded-full",children:[(0,a.jsx)("span",{className:"text-sm",children:"\uD83D\uDD25"}),(0,a.jsxs)("span",{className:"text-xs font-bold text-orange-600",children:[l," ng\xe0y"]})]})]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500 mt-0.5",children:["MHS: ",(0,a.jsx)("span",{className:"font-mono text-indigo-600",children:t.mhs})," | Lớp:"," ",(0,a.jsx)("span",{className:"font-semibold text-slate-700",children:t.class})]})]}),(0,a.jsxs)("button",{onClick:s,className:"flex items-center gap-2 text-sm font-semibold text-slate-600 hover:text-red-600 transition",children:[(0,a.jsx)(w.A,{size:16}),"Đăng xuất"]})]})})}function S(e){let{overviewText:t,strengthsText:s,risksText:l}=e;return(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"rounded-2xl border border-orange-100 bg-orange-50/60 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-orange-700 mb-2",children:"Tổng quan"}),(0,a.jsx)("div",{className:"text-sm text-slate-700 leading-relaxed",children:t})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800 mb-2",children:"Điểm mạnh"}),(0,a.jsxs)("div",{className:"text-sm text-slate-700 leading-relaxed",children:["• ",s]})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800 mb-2",children:"Cần lưu \xfd"}),(0,a.jsxs)("div",{className:"text-sm text-slate-700 leading-relaxed",children:["• ",l]})]})]})}var A=s(368),T=s(7937);function C(e){let{selectedTaskMonthSafe:t,selectedDate:s,monthKeys:l,canPrevMonth:n,canNextMonth:r,onSelectMonth:i,onSelectDate:o,onPrevMonth:d,onNextMonth:c}=e;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800",children:"Th\xf3i quen H\xe0ng ng\xe0y"}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["Nhiệm vụ theo th\xe1ng: ",(0,a.jsx)("b",{children:t})," (th\xe1ng sau c\xf3 thể kh\xe1c)."]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("button",{onClick:d,disabled:!n,className:"p-2 rounded-xl border border-slate-200 bg-white disabled:opacity-40",title:"Th\xe1ng trước",children:(0,a.jsx)(A.A,{size:18})}),(0,a.jsx)("select",{value:t,onChange:e=>i(e.target.value),className:"px-3 py-2 rounded-xl border border-slate-200 bg-white text-sm font-semibold text-slate-700",children:l.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("button",{onClick:c,disabled:!r,className:"p-2 rounded-xl border border-slate-200 bg-white disabled:opacity-40",title:"Th\xe1ng sau",children:(0,a.jsx)(T.A,{size:18})}),(0,a.jsx)("input",{type:"date",value:s,onChange:e=>o(e.target.value),className:"px-3 py-2 rounded-xl border border-slate-200 text-sm bg-white"})]})]})}var M=s(6613),D=s(3997);function E(e){let{leaderboardClass:t,leaderboardGrade:s,currentMhs:n,month:r}=e,[i,o]=(0,l.useState)("class"),d="class"===i?t:s,c=(null==d?void 0:d[r])||[];return(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(M.A,{className:"text-indigo-600",size:20}),(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800",children:"Bảng Xếp Hạng"})]}),(0,a.jsxs)("span",{className:"text-[10px] bg-indigo-100 text-indigo-700 font-mono px-2 py-0.5 rounded-full w-fit",children:["Th\xe1ng ",r]})]}),(0,a.jsxs)("div",{className:"flex bg-slate-100 p-1 rounded-xl",children:[(0,a.jsx)("button",{onClick:()=>o("class"),className:"px-3 py-1.5 rounded-lg text-xs font-bold transition ".concat("class"===i?"bg-white text-indigo-600 shadow-sm":"text-slate-500 hover:text-slate-600"),children:"Lớp"}),(0,a.jsx)("button",{onClick:()=>o("grade"),className:"px-3 py-1.5 rounded-lg text-xs font-bold transition ".concat("grade"===i?"bg-white text-indigo-600 shadow-sm":"text-slate-500 hover:text-slate-600"),children:"Khối"})]})]}),(0,a.jsx)("div",{className:"space-y-3",children:0===c.length?(0,a.jsxs)("div",{className:"text-center py-4 text-xs text-slate-400 italic",children:["Chưa c\xf3 dữ liệu th\xe1ng ",r,"."]}):c.map(e=>{var t,s;let l=e.id===n;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-xl border ".concat(1===(t=e.rank)?"bg-yellow-50 border-yellow-200":2===t?"bg-slate-50 border-slate-200":3===t?"bg-orange-50 border-orange-200":"bg-white border-slate-100"," ").concat(l?"ring-2 ring-indigo-500 ring-offset-2":""),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 flex justify-center",children:1===(s=e.rank)?(0,a.jsx)(M.A,{size:20,className:"text-yellow-500"}):2===s?(0,a.jsx)(D.A,{size:20,className:"text-gray-400"}):3===s?(0,a.jsx)(x.A,{size:20,className:"text-orange-500"}):(0,a.jsx)("span",{className:"text-sm font-bold text-slate-500 w-5 text-center",children:s})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[e.name,l&&(0,a.jsx)("span",{className:"text-[10px] bg-indigo-600 text-white px-1.5 rounded",children:"Bạn"})]}),(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:e.class})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800",children:e.score}),(0,a.jsx)("div",{className:"text-[10px] text-slate-400 uppercase",children:"Ticks"})]})]},e.id)})}),(0,a.jsxs)("div",{className:"mt-4 text-[11px] text-slate-400 text-center",children:["* Top 3 học sinh chăm chỉ nhất th\xe1ng ",r,"."]})]})}function L(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(a)}function z(e){return L(e).slice(0,7)}function B(e){var t,s;let a=Array.isArray(e)?e:[],l=null==(s=a[a.length-1])||null==(t=s.month)?void 0:t.trim();return l&&/^\d{4}-\d{2}$/.test(l)?l:z(new Date)}function R(e){let t=e.actionsByMonth;return t&&"object"==typeof t?t:{}}function O(e,t){let s=R(e),a=null==s?void 0:s[t];return Array.isArray(a)&&a.length?a:Array.isArray(e.activeActions)?e.activeActions:[]}function P(e){let t=new Map;return(e.ticks||[]).forEach(e=>t.set(String(e.date),!!e.completed)),t}function H(e){var t,s,n,r;let{student:i,onUpdateAction:o,onLogout:u}=e,g=(0,l.useMemo)(()=>(function(e){let t=String(e||"").trim();if(!/^\d{4}-\d{2}$/.test(t))return z(new Date);let[s,a]=t.split("-"),l=Number(s),n=Number(a);return l&&n?(13===(n+=1)&&(n=1,l+=1),"".concat(String(l).padStart(4,"0"),"-").concat(String(n).padStart(2,"0"))):z(new Date)})(B(i.scores)),[i.scores]),[p,b]=(0,l.useState)(()=>z(new Date)),[f,v]=(0,l.useState)(()=>L(new Date)),[j,N]=(0,l.useState)("range"),[w,A]=(0,l.useState)(30),T=(0,l.useMemo)(()=>Array.from(new Set([...(i.scores||[]).map(e=>String(e.month||"").trim()).filter(e=>/^\d{4}-\d{2}$/.test(e)),...Object.keys(R(i)).filter(e=>/^\d{4}-\d{2}$/.test(e)),g,z(new Date)])).sort((e,t)=>e.localeCompare(t)),[i,g]),M=(0,l.useMemo)(()=>{if(T.includes(p))return p;let e=z(new Date);return T.includes(e)?e:g},[p,T,g]);(0,l.useEffect)(()=>{let e=L(new Date);f.slice(0,7)!==M&&(e.startsWith(M)?v(e):v("".concat(M,"-01")))},[M]),(0,l.useEffect)(()=>{let e=new Date,t=z(e),s=L(e);b(t),v(s)},[]);let D=(0,l.useMemo)(()=>O(i,M),[i,M]),H=(0,l.useMemo)(()=>"month"===j?function(e){let[t,s]=e.split("-"),a=Number(t),l=Number(s);if(!a||!l)return[];let n=new Date(a,l,0).getDate(),r=[];for(let e=1;e<=n;e++){let a=String(e).padStart(2,"0");r.push("".concat(t,"-").concat(s,"-").concat(a))}return r}(M):(function(e){let t=[],s=new Date;for(let a=e-1;a>=0;a--){let e=new Date(s);e.setDate(s.getDate()-a),t.push(L(e))}return t})(w).filter(e=>e.slice(0,7)===M),[j,w,M]),K=(0,l.useMemo)(()=>O(i,M),[i,M]),q=i.aiReport,W=(null==q?void 0:q.overview)||"Tổng quan: dữ liệu mới nhất th\xe1ng ".concat(B(i.scores),"."),_=(null==q?void 0:q.strengths)&&q.strengths[0]||"C\xf3 dữ liệu theo d\xf5i theo th\xe1ng.",F=(null==q?void 0:q.risks)&&q.risks[0]||"Cần duy tr\xec th\xf3i quen học đều.",I=(0,l.useMemo)(()=>{let e=Array.isArray(null==q?void 0:q.studyPlan)?q.studyPlan:[],t=new Map;for(let s of e){let e=String(s.day||"").trim()||"Kh\xe1c";t.has(e)||t.set(e,[]),t.get(e).push(s)}return Array.from(t.entries())},[q]),U=(0,l.useMemo)(()=>(function(e){let t,s=new Set;if(Object.values(R(e)).forEach(e=>{e.forEach(e=>{var t;null==(t=e.ticks)||t.forEach(e=>{e.completed&&s.add(String(e.date))})})}),Array.isArray(e.activeActions)&&e.activeActions.forEach(e=>{var t;null==(t=e.ticks)||t.forEach(e=>{e.completed&&s.add(String(e.date))})}),0===s.size)return 0;let a=new Date,l=L(a),n=new Date(a);n.setDate(n.getDate()-1);let r=L(n);if(s.has(l))t=a;else{if(!s.has(r))return 0;t=n}let i=0;for(let e=0;e<3650;e++){let e=L(t);if(s.has(e))i++,t.setDate(t.getDate()-1);else break}return i})(i),[i]),G=(0,l.useMemo)(()=>{var e,t;let s=i.scores||[],a=(null==(e=i.dashboardStats)?void 0:e.gradeAvgSubjectsByMonth)||{},l=(null==(t=i.dashboardStats)?void 0:t.subjectTargets)||{};return s.map(e=>{let t=a[e.month]||{},s=l[e.month]||{};return{...e,gradeMath:t.math||0,gradeLit:t.lit||0,gradeEng:t.eng||0,targetMath:s.math||0,targetLit:s.lit||0,targetEng:s.eng||0}})},[i.scores,i.dashboardStats]),J=async e=>{let t=!!P(e).get(f);await o(e.id,f,!t)},V=T.indexOf(M),X=V>0,$=V>=0&&V<T.length-1;return(0,a.jsxs)("div",{className:"min-h-screen bg-[#f7f9fc] font-sans",children:[(0,a.jsx)(k,{student:i,onLogout:u,streak:U}),(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-5 py-6 space-y-6",children:[(0,a.jsx)(S,{overviewText:W,strengthsText:_,risksText:F}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-slate-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-5 bg-blue-500 rounded-full"}),"Biểu đồ To\xe1n"]}),(0,a.jsx)(y,{data:G,stats:i.dashboardStats,subject:"math"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-slate-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-5 bg-pink-500 rounded-full"}),"Biểu đồ Văn"]}),(0,a.jsx)(y,{data:G,stats:i.dashboardStats,subject:"lit"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-slate-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-5 bg-violet-500 rounded-full"}),"Biểu đồ Anh"]}),(0,a.jsx)(y,{data:G,stats:i.dashboardStats,subject:"eng"})]})]}),(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,a.jsx)(E,{leaderboardClass:(null==(t=i.dashboardStats)?void 0:t.leaderboardClass)||{},leaderboardGrade:(null==(s=i.dashboardStats)?void 0:s.leaderboardGrade)||{},currentMhs:i.mhs,month:M}),(null==(n=i.dashboardStats)?void 0:n.nextExamTargets)&&(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5 border-l-4 border-l-amber-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)("div",{className:"p-1.5 bg-amber-50 rounded-lg text-amber-600",children:(0,a.jsx)(c.A,{size:16})}),(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800",children:(()=>{let e=[...i.scores||[]].sort((e,t)=>String(t.month).localeCompare(String(e.month)))[0];if(!e)return"Mục ti\xeau đợt tới";let[t,s]=e.month.split("-").map(Number),a=12===s?1:s+1;return"Mục ti\xeau đợt tới (Th\xe1ng ".concat(a<10?"0"+a:a,"/").concat(12===s?t+1:t,")")})()})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[(0,a.jsxs)("div",{className:"bg-slate-50 rounded-xl p-2 text-center",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500 mb-1",children:"To\xe1n"}),(0,a.jsx)("div",{className:"text-sm font-bold text-blue-600",children:i.dashboardStats.nextExamTargets.math})]}),(0,a.jsxs)("div",{className:"bg-slate-50 rounded-xl p-2 text-center",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500 mb-1",children:"Văn"}),(0,a.jsx)("div",{className:"text-sm font-bold text-pink-600",children:i.dashboardStats.nextExamTargets.lit})]}),(0,a.jsxs)("div",{className:"bg-slate-50 rounded-xl p-2 text-center",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-500 mb-1",children:"Anh"}),(0,a.jsx)("div",{className:"text-sm font-bold text-violet-600",children:i.dashboardStats.nextExamTargets.eng})]})]}),(0,a.jsxs)("div",{className:"text-[11px] text-slate-500 italic leading-relaxed",children:["“",i.dashboardStats.nextExamTargets.message,"”"]})]}),(()=>{var e,t;let s=[...i.scores||[]].sort((e,t)=>String(t.month).localeCompare(String(e.month)))[0],l=(null==(t=i.dashboardStats)||null==(e=t.subjectTargets)?void 0:e[(null==s?void 0:s.month)||""])||null;if(!s||!l)return null;let n=(s.math||0)>=l.math,r=(s.lit||0)>=l.lit,o=(s.eng||0)>=l.eng;if(n||r||o){let e=[n?"To\xe1n":"",r?"Văn":"",o?"Anh":""].filter(Boolean).join(", ");return(0,a.jsxs)("div",{className:"bg-emerald-50 border border-emerald-200 rounded-2xl p-4 flex items-center gap-3 animate-pulse shadow-sm",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-emerald-500 rounded-full flex items-center justify-center text-white shrink-0",children:(0,a.jsx)(x.A,{size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-bold text-emerald-800",children:"Tuyệt vời! \uD83D\uDD25"}),(0,a.jsxs)("div",{className:"text-[11px] text-emerald-700",children:["Bạn đ\xe3 đạt mục ti\xeau m\xf4n ",e," trong th\xe1ng n\xe0y!"]})]})]})}return null})(),(0,a.jsxs)("div",{className:"rounded-2xl bg-gradient-to-r from-indigo-600 to-violet-600 text-white p-5 shadow-sm",children:[(0,a.jsx)("div",{className:"text-sm font-bold mb-2",children:"✨ Lời nhắn từ AI Mentor"}),(0,a.jsxs)("div",{className:"text-sm italic",children:["“",(null==q?void 0:q.messageToStudent)||"Mỗi ng\xe0y tiến bộ 1 ch\xfat l\xe0 đủ.","”"]}),(0,a.jsx)("div",{className:"text-[10px] text-white/60 mt-4 uppercase tracking-wider",children:"DISCLAIMER:"}),(0,a.jsx)("div",{className:"text-[11px] text-white/70",children:(null==q?void 0:q.disclaimer)||"Nhận x\xe9t AI chỉ mang t\xednh tham khảo, gi\xe1o vi\xean sẽ điều chỉnh theo thực tế."})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800 mb-4",children:"Kế hoạch 2 Tuần tới"}),(null==q||null==(r=q.studyPlan)?void 0:r.length)?(0,a.jsx)("div",{className:"space-y-4",children:I.map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100 pb-1",children:t}),(0,a.jsx)("div",{className:"space-y-2",children:s.map((e,t)=>(0,a.jsxs)("div",{className:"bg-slate-50/50 rounded-lg p-3 border border-slate-100/50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"text-[10px] font-bold uppercase px-1.5 py-0.5 rounded bg-white border border-slate-200 text-slate-600",children:e.subject}),(0,a.jsx)("span",{className:"text-[10px] text-slate-400",children:e.duration})]}),(0,a.jsx)("div",{className:"text-xs font-medium text-slate-700 leading-snug",children:e.content})]},t))})]},t)})}):(0,a.jsx)("div",{className:"text-sm text-slate-400 italic py-6 text-center",children:"Chưa c\xf3 kế hoạch."})]}),(0,a.jsx)(d,{})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsx)(C,{selectedTaskMonthSafe:M,selectedDate:f,monthKeys:T,canPrevMonth:X,canNextMonth:$,onSelectMonth:b,onSelectDate:v,onPrevMonth:()=>X&&b(T[V-1]),onNextMonth:()=>$&&b(T[V+1])}),0===D.length?(0,a.jsxs)("div",{className:"text-sm text-slate-400 italic py-6 text-center",children:["Chưa c\xf3 nhiệm vụ cho th\xe1ng ",M,"."]}):(0,a.jsx)("div",{className:"space-y-3",children:D.map(e=>{let t=!!P(e).get(f);return(0,a.jsx)("button",{onClick:()=>J(e),className:"w-full text-left rounded-2xl border p-4 transition ".concat(t?"border-emerald-200 bg-emerald-50/50":"border-slate-200 bg-white hover:bg-slate-50"),children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center ".concat(t?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 text-transparent"),children:(0,a.jsx)(h.A,{size:14})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold ".concat(t?"text-slate-700":"text-slate-800"),children:e.description}),(0,a.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:e.frequency})]})]}),(0,a.jsx)("div",{className:"text-xs text-slate-400",children:f})]})},e.id)})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{size:18,className:"text-indigo-600"}),(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800",children:"Theo d\xf5i Th\xf3i quen (d\xe0i hạn)"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>N("range"),className:"px-3 py-2 rounded-xl text-sm font-semibold border ".concat("range"===j?"bg-indigo-600 text-white border-indigo-600":"bg-white text-slate-700 border-slate-200 hover:bg-slate-50"),children:"7/30/90 ng\xe0y"}),(0,a.jsx)("button",{onClick:()=>N("month"),className:"px-3 py-2 rounded-xl text-sm font-semibold border ".concat("month"===j?"bg-indigo-600 text-white border-indigo-600":"bg-white text-slate-700 border-slate-200 hover:bg-slate-50"),children:"Theo th\xe1ng"}),"range"===j&&(0,a.jsx)(a.Fragment,{children:[7,30,90].map(e=>(0,a.jsxs)("button",{onClick:()=>A(e),className:"px-3 py-2 rounded-xl text-sm font-semibold border ".concat(w===e?"bg-emerald-600 text-white border-emerald-600":"bg-white text-slate-700 border-slate-200 hover:bg-slate-50"),children:[e," ng\xe0y"]},e))})]})]}),0===K.length?(0,a.jsxs)("div",{className:"text-sm text-slate-400 italic py-6 text-center",children:["Chưa c\xf3 nhiệm vụ để theo d\xf5i trong th\xe1ng ",M,"."]}):(0,a.jsx)("div",{className:"space-y-4",children:K.map(e=>{let t=P(e),s=H.reduce((e,s)=>e+ +!!t.get(s),0);return(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-bold text-slate-800",children:e.description}),(0,a.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["Tần suất: ",e.frequency]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:s}),(0,a.jsx)("div",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Tổng tick"})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"flex items-center gap-2 min-w-max",children:H.map(s=>{let l=!!t.get(s);return(0,a.jsx)("button",{onClick:async()=>{await o(e.id,s,!l)},className:"w-10 h-10 rounded-xl border flex items-center justify-center text-xs font-semibold transition ".concat(l?"bg-emerald-100 text-emerald-700 border-emerald-200":"bg-white text-slate-400 border-slate-200 hover:bg-slate-50"),title:s,children:l?(0,a.jsx)(h.A,{size:18}):(0,a.jsx)("span",{className:"text-[10px]",children:function(e){let t=new Date(e);return"".concat(t.getDate(),"/").concat(t.getMonth()+1)}(s)})},s)})})}),(0,a.jsx)("div",{className:"text-[11px] text-slate-500 mt-3",children:"Nếu nhiệm vụ “3 lần/tuần” th\xec trong 1 tuần tick đủ 3 ng\xe0y l\xe0 đạt."})]},e.id)})})]})]})]})}var K=s(8314);function q(e){let{mhs:t}=e,[s,n]=(0,l.useState)(!1),r=async()=>{if(confirm("Reset mật khẩu HS ".concat(t," về DEFAULT_PASSWORD?"))){n(!0);try{let e=await fetch("/api/account/reset-password",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({mhs:t})}),s=await e.json().catch(()=>({}));if(!e.ok||!(null==s?void 0:s.ok))return alert((null==s?void 0:s.error)||"Reset thất bại");alert("Reset OK (NEW_PASSWORD đ\xe3 x\xf3a, quay về DEFAULT_PASSWORD)")}catch(e){alert((null==e?void 0:e.message)||"Network error")}finally{n(!1)}}};return(0,a.jsxs)("button",{onClick:r,disabled:s,className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold disabled:opacity-50",title:"Reset về mật khẩu mặc định",children:[s?(0,a.jsx)(o.A,{className:"animate-spin",size:14}):(0,a.jsx)(K.A,{size:14}),"Reset MK"]})}var W=s(5867),_=s(5229);function F(){let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)(""),[r,i]=(0,l.useState)(""),[d,c]=(0,l.useState)(!1),[x,h]=(0,l.useState)("");(0,l.useEffect)(()=>{if(!e)return;let s=document.body.style.overflow;document.body.style.overflow="hidden";let a=e=>{"Escape"===e.key&&t(!1)};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a),document.body.style.overflow=s}},[e]);let m=()=>{t(!1),h(""),n(""),i(""),c(!1)},u=async()=>{if(h(""),!r.trim())return void h("Vui l\xf2ng nhập mật khẩu mới.");c(!0);try{let e=await fetch("/api/account/admin/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPassword:s,newPassword:r})}),t=await e.json().catch(()=>({}));if(!e.ok||!(null==t?void 0:t.ok))return void h((null==t?void 0:t.error)||"Đổi mật khẩu thất bại");h("✅ Đổi mật khẩu th\xe0nh c\xf4ng"),setTimeout(()=>m(),800)}finally{c(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{type:"button",onClick:()=>t(!0),className:"flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-semibold rounded-xl",title:"Đổi mật khẩu Admin",children:[(0,a.jsx)(W.A,{size:16}),"Đổi MK Admin"]}),e&&(0,a.jsx)("div",{className:"fixed inset-0 z-[200] bg-slate-900/55 backdrop-blur-sm flex items-center justify-center p-4",onMouseDown:e=>{e.target===e.currentTarget&&m()},children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-5 border-b border-slate-100 flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-bold text-slate-800",children:"Đổi mật khẩu Admin"}),(0,a.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Nếu qu\xean mật khẩu: d\xf9ng luồng reset qua email."})]}),(0,a.jsx)("button",{type:"button",onClick:m,className:"p-2 rounded-xl hover:bg-slate-100 text-slate-500",title:"Đ\xf3ng",children:(0,a.jsx)(_.A,{size:18})})]}),(0,a.jsxs)("div",{className:"p-5 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-slate-700 mb-1",children:"Mật khẩu cũ"}),(0,a.jsx)("input",{type:"password",value:s,onChange:e=>n(e.target.value),className:"w-full px-3 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"(nếu bạn c\xf3 d\xf9ng kiểm tra mật khẩu cũ)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-slate-700 mb-1",children:"Mật khẩu mới"}),(0,a.jsx)("input",{type:"password",value:r,onChange:e=>i(e.target.value),className:"w-full px-3 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Nhập mật khẩu mới"})]}),x&&(0,a.jsx)("div",{className:"text-sm px-3 py-2 rounded-xl bg-slate-50 border border-slate-200 text-slate-700",children:x})]}),(0,a.jsxs)("div",{className:"p-5 border-t border-slate-100 flex justify-end gap-2 bg-white",children:[(0,a.jsx)("button",{type:"button",onClick:m,className:"px-4 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold",children:"Hủy"}),(0,a.jsxs)("button",{type:"button",onClick:u,disabled:d,className:"px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-semibold disabled:opacity-50 inline-flex items-center gap-2",children:[d?(0,a.jsx)(o.A,{size:18,className:"animate-spin"}):null,"Đổi mật khẩu"]})]})]})})]})}var I=s(5740),U=s(6651),G=s(1786),J=s(1169),V=s(3341),X=s(2056),$=s(9715),Q=s(534),Y=s(1190),Z=s(6046),ee=s(906);function et(e){return e.toISOString().slice(0,10)}function es(e){return e.toISOString().slice(0,7)}function ea(e){return/^\d{4}-\d{2}$/.test(String(e||"").trim())}function el(e){let t=String(e||"").trim();if(!ea(t))return es(new Date);let[s,a]=t.split("-"),l=parseInt(s,10),n=parseInt(a,10);return 13===(n+=1)&&(n=1,l+=1),"".concat(String(l).padStart(4,"0"),"-").concat(String(n).padStart(2,"0"))}function en(e){return el(function(e){let t=Array.isArray(null==e?void 0:e.scores)?e.scores:[],s=t.length?t[t.length-1]:null,a=String((null==s?void 0:s.month)||"").trim();return ea(a)?a:es(new Date)}(e))}function er(e){let t=new Set;((null==e?void 0:e.scores)||[]).forEach(e=>{let s=String((null==e?void 0:e.month)||"").trim();ea(s)&&(t.add(s),t.add(el(s)))}),((null==e?void 0:e.activeActions)||[]).forEach(e=>{((null==e?void 0:e.ticks)||[]).forEach(e=>{let s=String((null==e?void 0:e.date)||"").slice(0,7);ea(s)&&t.add(s)})});let s=null==e?void 0:e.actionsByMonth;s&&"object"==typeof s&&Object.keys(s).forEach(e=>{let a=String(e||"").trim();ea(a)&&t.add(a);let l=s[e];Array.isArray(l)&&l.forEach(e=>{((null==e?void 0:e.ticks)||[]).forEach(e=>{let s=String((null==e?void 0:e.date)||"").slice(0,7);ea(s)&&t.add(s)})})}),e&&t.add(en(e));let a=Array.from(t);return a.sort(),a}function ei(e){if(!e)return{};let t=null==e?void 0:e.actionsByMonth;return t&&"object"==typeof t?t:{[en(e)]:Array.isArray(null==e?void 0:e.activeActions)?e.activeActions:[]}}async function eo(e,t,s,a){let l=await fetch("/api/admin/save-report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mhs:e,report:t,actions:s,monthKey:a})}),n=await l.json().catch(()=>({}));if(!l.ok||!(null==n?void 0:n.ok))throw Error((null==n?void 0:n.error)||"Save report failed");return n}let ed=e=>{let{students:t,onImportData:s,onUpdateStudentReport:n,onLogout:r}=e,[d,c]=(0,l.useState)(null),[u,g]=(0,l.useState)(null),[p,b]=(0,l.useState)(""),[f,v]=(0,l.useState)("report"),[j,N]=(0,l.useState)(new Set),[w,k]=(0,l.useState)("ALL"),[S,A]=(0,l.useState)("none"),[T,C]=(0,l.useState)(!1),[E,L]=(0,l.useState)(null),z=(null==E?void 0:E.role)==="TEACHER",B=String((null==E?void 0:E.teacherClass)||"").trim();(0,l.useEffect)(()=>{fetch("/api/me").then(e=>e.json()).then(e=>L((null==e?void 0:e.session)||null)).catch(()=>L(null))},[]);let R=(0,l.useMemo)(()=>z&&B?t.filter(e=>String(e.class||"").trim()===B):t,[t,z,B]);(0,l.useEffect)(()=>{z&&N(e=>{let t=new Set;for(let s of e)R.find(e=>e.mhs===s)&&t.add(s);return t})},[z,R]);let[O,P]=(0,l.useState)(null),[H,K]=(0,l.useState)(!1),[W,ea]=(0,l.useState)({overview:"",messageToStudent:"",teacherNotes:""}),el=R.find(e=>e.mhs===u),[ed,ec]=(0,l.useState)("7"),[ex,eh]=(0,l.useState)(es(new Date));(0,l.useEffect)(()=>{if(!el)return;let e=er(el),t=en(el),s=e.length?e[e.length-1]:t;eh(e.includes(t)?t:s)},[null==el?void 0:el.mhs]);let[em,eu]=(0,l.useState)(!1),[eg,ep]=(0,l.useState)(!1),[eb,ef]=(0,l.useState)([]),[ev,ej]=(0,l.useState)(new Set),[eN,ey]=(0,l.useState)(""),[ew,ek]=(0,l.useState)(""),eS=(0,l.useMemo)(()=>Array.from(new Set(R.map(e=>e.class||"").filter(Boolean))).sort(),[R]),eA=(0,l.useMemo)(()=>{let e=p.toLowerCase(),t=R.filter(t=>("ALL"===w||t.class===w)&&(t.name.toLowerCase().includes(e)||t.mhs.toLowerCase().includes(e)||t.class.toLowerCase().includes(e)));return"none"!==S&&(t=t.slice().sort((e,t)=>{let s=e=>{var t;let s=en(e),a=ei(e);return(Array.isArray(null==e||null==(t=e.actionsByMonth)?void 0:t[s])?e.actionsByMonth[s]:Array.isArray(null==a?void 0:a[s])?a[s]:Array.isArray(e.activeActions)?e.activeActions:[]).reduce((e,t)=>e+(Array.isArray(null==t?void 0:t.ticks)?t.ticks:[]).filter(e=>(null==e?void 0:e.completed)&&String((null==e?void 0:e.date)||"").slice(0,7)===s).length,0)},a=s(e),l=s(t);return"desc"===S?l-a:a-l})),t},[R,p,w,S]);(0,l.useEffect)(()=>{el&&el.aiReport&&(ea({overview:el.aiReport.overview,messageToStudent:el.aiReport.messageToStudent,teacherNotes:el.aiReport.teacherNotes}),K(!1))},[el]);let eT=(0,l.useMemo)(()=>ei(el),[null==el?void 0:el.mhs,null==el?void 0:el.activeActions,null==el?void 0:el.scores,null==el?void 0:el.actionsByMonth]),eC=(0,l.useMemo)(()=>{let e=er(el);return e.length?e:[es(new Date)]},[null==el?void 0:el.mhs,null==el?void 0:el.actionsByMonth,null==el?void 0:el.scores,null==el?void 0:el.activeActions]),eM=(0,l.useMemo)(()=>el?en(el):es(new Date),[null==el?void 0:el.mhs,null==el?void 0:el.scores]),eD=(0,l.useMemo)(()=>"month"===ed?ex:eM,[ed,ex,eM]),eE=(0,l.useMemo)(()=>{if(!T)return{class:[],grade:[]};let e=t.map(e=>({name:e.name,class:e.class,score:(e=>{let t=new Set,s=[];return Array.isArray(e.activeActions)&&s.push(...e.activeActions),null==e||e.actionsByMonth,e.actionsByMonth&&"object"==typeof e.actionsByMonth&&Object.values(e.actionsByMonth).forEach(e=>{Array.isArray(e)&&s.push(...e)}),s.forEach(e=>{(e.ticks||[]).forEach(s=>{s.completed&&String(s.date).startsWith(ex)&&t.add(s.date+"-"+e.id)})}),t.size})(e)})).sort((e,t)=>t.score-e.score),s=e.slice(0,10);return{class:"ALL"!==w?e.filter(e=>e.class===w).slice(0,10):[],grade:s}},[t,T,w,ex]),eL=(0,l.useMemo)(()=>"month"===ed?function(e){let[t,s]=e.split("-").map(e=>parseInt(e,10));if(!t||!s)return[];let a=new Date(Date.UTC(t,s-1,1)),l=new Date(Date.UTC(t,s,0)),n=[],r=new Date(a);for(;r<=l;)n.push(et(r)),r.setUTCDate(r.getUTCDate()+1);return n}(ex):function(e){let t=[];for(let s=e-1;s>=0;s--){let e=new Date;e.setDate(e.getDate()-s),t.push(et(e))}return t}("7"===ed?7:"30"===ed?30:90),[ed,ex,eD]),ez=(0,l.useMemo)(()=>{let e=null==eT?void 0:eT[eD];return Array.isArray(e)?e:Array.isArray(null==el?void 0:el.activeActions)?el.activeActions:[]},[eT,eD,null==el?void 0:el.mhs]),eB=(0,l.useMemo)(()=>"month"===ed?"Tiến độ Th\xf3i quen (Th\xe1ng ".concat(ex,") • Nhiệm vụ th\xe1ng ").concat(ex):"30"===ed?"Tiến độ Th\xf3i quen (30 ng\xe0y qua) • Nhiệm vụ th\xe1ng ".concat(eD):"90"===ed?"Tiến độ Th\xf3i quen (90 ng\xe0y qua) • Nhiệm vụ th\xe1ng ".concat(eD):"Tiến độ Th\xf3i quen (7 ng\xe0y qua) • Nhiệm vụ th\xe1ng ".concat(eD),[ed,ex,eD]),eR=async e=>{var t;if(z)return;let a=null==(t=e.target.files)?void 0:t[0];if(!a)return;let l=new FileReader;l.onload=e=>{var t;let a=null==(t=e.target)?void 0:t.result,l=XLSX.read(a,{type:"binary"}),n=new Map;R.forEach(e=>n.set(e.mhs,{...e})),l.SheetNames.forEach(e=>{let t=l.Sheets[e],s=XLSX.utils.sheet_to_json(t,{header:1});for(let t=1;t<s.length;t++){let a=s[t],l=a[1]?String(a[1]).trim():null;if(!l)continue;let r=a[2]?String(a[2]).trim():"Unknown",i=a[3]?String(a[3]).trim():"",o=e=>{if(null==e||""===e)return null;let t=parseFloat(e);return isNaN(t)?null:t},d=o(a[5]),c=o(a[6]),x=o(a[7]);if(null===d&&null===c&&null===x)continue;let h={month:e,math:d,lit:c,eng:x},m=n.get(l);m?(m.name=r,m.class=i):(m={mhs:l,name:r,class:i,scores:[],activeActions:[]},n.set(l,m));let u=m.scores.findIndex(t=>t.month===e);u>=0?m.scores[u]=h:m.scores.push(h)}});let r=Array.from(n.values());s(r),alert("Nhập th\xe0nh c\xf4ng! Đ\xe3 xử l\xfd ".concat(r.length," học sinh qua ").concat(l.SheetNames.length," sheet th\xe1ng."))},l.readAsBinaryString(a)},eO=async e=>{c(e.mhs);try{let t=await i(e),s=en(e),a=(t.actions||[]).map((t,s)=>({id:"".concat(e.mhs,"-").concat(Date.now(),"-").concat(s),description:t.description,frequency:t.frequency,ticks:[]}));await eo(e.mhs,t,a,s),n(e.mhs,t,a)}catch(e){alert((null==e?void 0:e.message)||"Kh\xf4ng thể tạo b\xe1o c\xe1o. Vui l\xf2ng kiểm tra API Key.")}finally{c(null)}},eP=async()=>{if(z)return;let e=eA.filter(e=>j.has(e.mhs));if(0===e.length)return void alert("Bạn chưa chọn học sinh n\xe0o.");if(confirm("Bạn c\xf3 chắc muốn tạo b\xe1o c\xe1o AI cho ".concat(e.length," học sinh đang chọn kh\xf4ng?"))){P({current:0,total:e.length,currentName:""});for(let t=0;t<e.length;t++){let s=e[t];P({current:t+1,total:e.length,currentName:s.name});try{let e=await i(s),t=en(s),a=(e.actions||[]).map((e,t)=>({id:"".concat(s.mhs,"-").concat(Date.now(),"-").concat(t),description:e.description,frequency:e.frequency,ticks:[]}));await eo(s.mhs,e,a,t),n(s.mhs,e,a)}catch(e){console.error("Failed to generate for ".concat(s.mhs),e)}t<e.length-1&&await new Promise(e=>setTimeout(e,2e3))}P(null),alert("Ho\xe0n tất qu\xe1 tr\xecnh tạo b\xe1o c\xe1o h\xe0ng loạt!")}},eH=async()=>{if(!z){eu(!0),ek("");try{var e,t,s;let a=await fetch("/api/sync/sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"new_only"})}),l=await a.json();if(!a.ok||!(null==l?void 0:l.ok))return void alert("Lỗi đồng bộ: ".concat((null==l?void 0:l.error)||"Sync failed"));let n=null!=(e=l.monthsSynced)?e:[],r=null!=(t=l.monthsAll)?t:[];if(n.length>0){alert("Đồng bộ xong: ".concat(null!=(s=l.students)?s:0," HS. Th\xe1ng mới: ").concat(n.join(", "))),window.location.reload();return}ef(r),ej(new Set(r)),ey(""),ek("Kh\xf4ng c\xf3 th\xe1ng mới. Bạn c\xf3 thể chọn th\xe1ng để đồng bộ lại."),ep(!0)}catch(e){alert("Lỗi đồng bộ: ".concat((null==e?void 0:e.message)||"Network error"))}finally{eu(!1)}}},eK=(0,l.useMemo)(()=>{let e=eN.trim().toLowerCase();return e?eb.filter(t=>t.toLowerCase().includes(e)):eb},[eb,eN]),eq=e=>{ej(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},eW=async()=>{if(z)return;let e=Array.from(ev).sort();if(0===e.length)return void alert("Bạn chưa chọn th\xe1ng n\xe0o.");eu(!0);try{var t,s;let a=await fetch("/api/sync/sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"months",selectedMonths:e})}),l=await a.json();if(!a.ok||!(null==l?void 0:l.ok))return void alert("Lỗi đồng bộ: ".concat((null==l?void 0:l.error)||"Sync failed"));ep(!1),alert("Đồng bộ xong: ".concat(null!=(t=l.students)?t:0," HS. Th\xe1ng: ").concat((null!=(s=l.monthsSynced)?s:e).join(", "))),window.location.reload()}catch(e){alert("Lỗi đồng bộ: ".concat((null==e?void 0:e.message)||"Network error"))}finally{eu(!1)}},e_=async()=>{if(!el||!el.aiReport)return;let e={...el.aiReport,overview:W.overview,messageToStudent:W.messageToStudent,teacherNotes:W.teacherNotes},t=en(el);try{await eo(el.mhs,e,ez,t),n(el.mhs,e,ez),K(!1)}catch(e){alert((null==e?void 0:e.message)||"Lưu thất bại")}};return(0,a.jsxs)("div",{className:"min-h-screen bg-[#f8fafc] flex flex-col font-sans relative",children:[O&&(0,a.jsx)("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center animate-in fade-in zoom-in duration-300",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse",children:(0,a.jsx)(I.A,{size:32})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Đang ph\xe2n t\xedch dữ liệu..."}),(0,a.jsxs)("p",{className:"text-slate-500 mb-6",children:["Đang xử l\xfd: ",(0,a.jsx)("span",{className:"font-bold text-indigo-600",children:O.currentName})]}),(0,a.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-4 mb-2 overflow-hidden",children:(0,a.jsx)("div",{className:"bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out",style:{width:"".concat(O.current/O.total*100,"%")}})}),(0,a.jsxs)("div",{className:"flex justify-between text-xs font-semibold text-slate-400 uppercase tracking-wider",children:[(0,a.jsx)("span",{children:"Tiến độ"}),(0,a.jsxs)("span",{children:[O.current," / ",O.total]})]}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mt-4 italic",children:"Vui l\xf2ng kh\xf4ng tắt tr\xecnh duyệt..."})]})}),eg&&!z&&(0,a.jsx)("div",{className:"fixed inset-0 bg-slate-900/55 backdrop-blur-sm z-[120] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-slate-100 flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-bold text-slate-800",children:"Chọn th\xe1ng để đồng bộ"}),(0,a.jsx)("div",{className:"text-sm text-slate-500 mt-1",children:ew||"Chọn 1 hoặc nhiều th\xe1ng để đồng bộ lại điểm từ Google Sheet."})]}),(0,a.jsx)("button",{onClick:()=>ep(!1),className:"p-2 rounded-xl hover:bg-slate-100 text-slate-500",title:"Đ\xf3ng",type:"button",children:(0,a.jsx)(_.A,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(U.A,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),(0,a.jsx)("input",{value:eN,onChange:e=>ey(e.target.value),placeholder:"T\xecm th\xe1ng (vd: 2025-10)...",className:"w-full pl-10 pr-3 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-emerald-500 outline-none text-sm"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>ej(new Set(eb)),className:"px-3 py-2 text-sm font-semibold rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700",type:"button",children:"Chọn tất cả"}),(0,a.jsx)("button",{onClick:()=>ej(new Set),className:"px-3 py-2 text-sm font-semibold rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700",type:"button",children:"Bỏ chọn"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[Array.from(ev).sort().slice(0,12).map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>eq(e),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold bg-emerald-50 text-emerald-700 border border-emerald-100 hover:bg-emerald-100",title:"Bỏ chọn",children:[e,(0,a.jsx)(_.A,{size:14})]},e)),ev.size>12&&(0,a.jsxs)("span",{className:"text-xs text-slate-500 px-2 py-1.5",children:["+",ev.size-12," th\xe1ng nữa"]})]}),(0,a.jsx)("div",{className:"border border-slate-200 rounded-2xl overflow-hidden",children:(0,a.jsx)("div",{className:"max-h-[320px] overflow-y-auto p-3 bg-slate-50",children:(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:eK.map(e=>{let t=ev.has(e);return(0,a.jsxs)("button",{type:"button",onClick:()=>eq(e),className:"flex items-center justify-between px-3 py-2 rounded-xl border text-sm font-semibold transition-all ".concat(t?"bg-white border-emerald-200 text-emerald-700 shadow-sm":"bg-white/70 border-slate-200 text-slate-700 hover:bg-white"),children:[(0,a.jsx)("span",{children:e}),(0,a.jsx)("span",{className:"w-5 h-5 rounded-md border flex items-center justify-center ".concat(t?"bg-emerald-600 border-emerald-600":"bg-white border-slate-300"),children:t&&(0,a.jsx)(h.A,{size:14,className:"text-white"})})]},e)})})})}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["Đ\xe3 chọn: ",(0,a.jsx)("span",{className:"font-bold text-slate-700",children:ev.size})," / ",eb.length," th\xe1ng"]})]}),(0,a.jsxs)("div",{className:"p-6 border-t border-slate-100 flex justify-end gap-2 bg-white",children:[(0,a.jsx)("button",{type:"button",onClick:()=>ep(!1),className:"px-4 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold",children:"Hủy"}),(0,a.jsxs)("button",{type:"button",onClick:eW,disabled:em,className:"px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[em?(0,a.jsx)(o.A,{size:18,className:"animate-spin"}):(0,a.jsx)(G.A,{size:18}),"Đồng bộ th\xe1ng đ\xe3 chọn"]})]})]})}),(0,a.jsxs)("header",{className:"bg-white/90 backdrop-blur-sm border-b border-slate-200/60 px-8 py-5 flex justify-between items-center sticky top-0 z-20 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"bg-indigo-600 p-2.5 rounded-xl text-white shadow-lg shadow-indigo-600/30",children:(0,a.jsx)(J.A,{size:22})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:"Quản l\xfd Học tập"}),z&&B&&(0,a.jsxs)("span",{className:"ml-3 inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-emerald-50 text-emerald-700 border border-emerald-100",children:["Lớp: ",B,(0,a.jsx)("span",{className:"mx-2 text-emerald-300",children:"|"}),"TB Lớp: ",(()=>{let e=R.flatMap(e=>{var t;let s=null==(t=e.scores)?void 0:t[e.scores.length-1];return s?[s.math,s.lit,s.eng].filter(e=>null!=e):[]});return 0===e.length?"N/A":(e.reduce((e,t)=>e+t,0)/e.length).toFixed(1)})()]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative hidden md:block mr-2",children:[(0,a.jsx)(U.A,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),(0,a.jsx)("input",{type:"text",placeholder:"T\xecm học sinh...",value:p,onChange:e=>b(e.target.value),className:"pl-10 pr-4 py-2 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all w-64 text-sm"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{className:"pl-3 pr-8 py-2 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white outline-none text-sm appearance-none cursor-pointer",value:w,onChange:e=>k(e.target.value),children:[(0,a.jsx)("option",{value:"ALL",children:"Tất cả lớp"}),eS.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsx)("div",{className:"absolute right-3 top-2.5 pointer-events-none text-slate-400",children:(0,a.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("polyline",{points:"6 9 12 15 18 9"})})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{className:"pl-3 pr-8 py-2 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white outline-none text-sm appearance-none cursor-pointer",value:S,onChange:e=>A(e.target.value),children:[(0,a.jsx)("option",{value:"none",children:"Sắp xếp: Mặc định"}),(0,a.jsx)("option",{value:"desc",children:"Tick nhiều nhất"}),(0,a.jsx)("option",{value:"asc",children:"Tick \xedt nhất"})]}),(0,a.jsx)("div",{className:"absolute right-3 top-2.5 pointer-events-none text-slate-400",children:(0,a.jsx)(V.A,{size:14})})]}),!z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:eP,disabled:!!O,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-indigo-600 text-white text-sm font-semibold rounded-xl transition-all shadow-md hover:shadow-lg hover:shadow-indigo-500/30 transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",type:"button",children:[(0,a.jsx)(I.A,{size:18}),"AI H\xe0ng loạt"]}),(0,a.jsxs)("button",{onClick:eH,disabled:em||!!O,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold rounded-xl transition-all shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:"Đồng bộ dữ liệu từ Google Sheet (Admin)",type:"button",children:[em?(0,a.jsx)(o.A,{className:"animate-spin",size:18}):(0,a.jsx)(G.A,{size:18}),"Đồng bộ Sheet"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 px-5 py-2 bg-slate-800 hover:bg-slate-900 text-white text-sm font-semibold rounded-xl cursor-pointer transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:[(0,a.jsx)(G.A,{size:18}),"Nhập Excel",(0,a.jsx)("input",{type:"file",accept:".xlsx,.xls",className:"hidden",onChange:eR})]})]}),(0,a.jsx)(F,{}),(0,a.jsx)("button",{onClick:r,className:"text-sm font-semibold text-slate-500 hover:text-red-500 transition-colors px-2 ml-2",type:"button",children:"Đăng xuất"})]})]}),T&&(0,a.jsx)("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-slate-100 bg-white z-10",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[(0,a.jsx)(M.A,{className:"text-yellow-500"})," Bảng Xếp Hạng Khối"]}),(0,a.jsx)("button",{onClick:()=>C(!1),className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-colors",children:(0,a.jsx)(_.A,{size:24})})]}),(0,a.jsxs)("div",{className:"p-8 overflow-y-auto bg-slate-50",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-slate-100 shadow-sm",children:[(0,a.jsxs)("h3",{className:"font-bold text-slate-700 mb-4 flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"text-indigo-500"})," Top Lớp (Th\xe1ng Hiện tại)"]}),(0,a.jsx)("div",{className:"space-y-3",children:0===eE.class.length?(0,a.jsx)("p",{className:"text-slate-400 italic text-sm",children:"Chưa c\xf3 dữ liệu."}):eE.class.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ".concat(0===t?"bg-yellow-100 text-yellow-700":1===t?"bg-slate-200 text-slate-700":"bg-orange-100 text-orange-700"),children:t+1}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-sm text-slate-800",children:e.name}),(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:e.class})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-bold text-indigo-600",children:e.score}),(0,a.jsx)("div",{className:"text-[10px] text-slate-400",children:"Ticks"})]})]},t))})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-slate-100 shadow-sm",children:[(0,a.jsxs)("h3",{className:"font-bold text-slate-700 mb-4 flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"text-emerald-500"})," Top Khối (Th\xe1ng Hiện tại)"]}),(0,a.jsx)("div",{className:"space-y-3",children:0===eE.grade.length?(0,a.jsx)("p",{className:"text-slate-400 italic text-sm",children:"Chưa c\xf3 dữ liệu."}):eE.grade.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ".concat(0===t?"bg-yellow-100 text-yellow-700":1===t?"bg-slate-200 text-slate-700":"bg-orange-100 text-orange-700"),children:t+1}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-sm text-slate-800",children:e.name}),(0,a.jsx)("div",{className:"text-[10px] text-slate-500",children:e.class})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-bold text-emerald-600",children:e.score}),(0,a.jsx)("div",{className:"text-[10px] text-slate-400",children:"Ticks"})]})]},t))})]})]}),(0,a.jsx)("p",{className:"text-center text-slate-400 text-xs mt-6 italic",children:"T\xednh năng xếp hạng to\xe0n trường / nhiều khối sẽ được cập nhật sau."})]})]})}),(0,a.jsx)("main",{className:"flex-1 p-8 max-w-[1400px] mx-auto w-full",children:(0,a.jsx)("div",{className:"bg-white rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-slate-50/50 border-b border-slate-200 text-xs uppercase text-slate-500 font-bold tracking-wider",children:[(0,a.jsx)("th",{className:"px-6 py-5 w-10",children:(0,a.jsx)("input",{type:"checkbox",disabled:z,checked:!z&&eA.length>0&&eA.every(e=>j.has(e.mhs)),onChange:e=>{z||(e.target.checked?N(new Set(eA.map(e=>e.mhs))):N(new Set))},title:z?"Gi\xe1o vi\xean kh\xf4ng d\xf9ng chọn h\xe0ng loạt":"Chọn/Bỏ chọn tất cả học sinh đang hiển thị"})}),(0,a.jsx)("th",{className:"px-6 py-5",children:"MHS"}),(0,a.jsx)("th",{className:"px-6 py-5 w-[90px] text-center",children:"MK"}),(0,a.jsx)("th",{className:"px-6 py-5",children:"Họ v\xe0 T\xean"}),(0,a.jsx)("th",{className:"px-6 py-5",children:"Lớp"}),(0,a.jsx)("th",{className:"px-6 py-5",children:"Điểm TB (Gần nhất)"}),(0,a.jsx)("th",{className:"px-6 py-5",children:"Rủi ro"}),(0,a.jsx)("th",{className:"px-6 py-5 cursor-pointer hover:bg-slate-100 transition-colors group select-none",onClick:()=>A(e=>"desc"===e?"asc":"asc"===e?"none":"desc"),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["Tiến độ Tick","desc"===S&&(0,a.jsx)("span",{className:"text-indigo-600",children:"↓"}),"asc"===S&&(0,a.jsx)("span",{className:"text-indigo-600",children:"↑"}),"none"===S&&(0,a.jsx)("span",{className:"text-slate-300 group-hover:text-slate-400",children:"↕"})]})}),(0,a.jsx)("th",{className:"px-6 py-5 text-right",children:"H\xe0nh động"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-100",children:0===eA.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:9,className:"px-6 py-10 text-center text-slate-400 italic",children:z?"Chưa c\xf3 học sinh trong lớp phụ tr\xe1ch.":"Kh\xf4ng t\xecm thấy học sinh n\xe0o. H\xe3y nhập Excel hoặc Đồng bộ Sheet."})}):eA.map(e=>{var t,s;let l=null==(t=e.scores)?void 0:t[e.scores.length-1],n=[null==l?void 0:l.math,null==l?void 0:l.lit,null==l?void 0:l.eng].filter(e=>null!=e),r=n.length>0?(n.reduce((e,t)=>e+t,0)/n.length).toFixed(1):"N/A",i=en(e),c=ei(e),x=Array.isArray(null==e||null==(s=e.actionsByMonth)?void 0:s[i])?e.actionsByMonth[i]:Array.isArray(null==c?void 0:c[i])?c[i]:Array.isArray(e.activeActions)?e.activeActions:[],h=x.reduce((e,t)=>e+(Array.isArray(null==t?void 0:t.ticks)?t.ticks:[]).filter(e=>(null==e?void 0:e.completed)&&String((null==e?void 0:e.date)||"").slice(0,7)===i).length,0);return(0,a.jsxs)("tr",{className:"hover:bg-indigo-50/30 transition-colors duration-200 group",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("input",{type:"checkbox",disabled:z,checked:!z&&j.has(e.mhs),onChange:t=>{z||N(s=>{let a=new Set(s);return t.target.checked?a.add(e.mhs):a.delete(e.mhs),a})}})}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm font-mono text-slate-500 bg-transparent",children:e.mhs}),(0,a.jsx)("td",{className:"px-6 py-4 text-center",children:(0,a.jsx)(q,{mhs:e.mhs})}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm font-semibold text-slate-800",children:e.name}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.class}),(0,a.jsxs)("td",{className:"px-6 py-4 text-sm text-slate-600",children:[(0,a.jsx)("span",{className:"px-2.5 py-1 rounded-lg font-bold text-xs ".concat("N/A"===r?"bg-slate-100 text-slate-500":Number(r)>=8?"bg-emerald-100 text-emerald-700":Number(r)>=5?"bg-amber-100 text-amber-700":"bg-rose-100 text-rose-700"),children:r}),l&&(0,a.jsxs)("span",{className:"text-[10px] text-slate-400 ml-2",children:["(",l.month,")"]})]}),(0,a.jsx)("td",{className:"px-6 py-4",children:e.aiReport?(0,a.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide border ".concat("Cao"===e.aiReport.riskLevel?"bg-red-50 text-red-600 border-red-100":"Trung b\xecnh"===e.aiReport.riskLevel?"bg-orange-50 text-orange-600 border-orange-100":"bg-emerald-50 text-emerald-600 border-emerald-100"),children:["Cao"===e.aiReport.riskLevel&&(0,a.jsx)(X.A,{size:12}),e.aiReport.riskLevel]}):(0,a.jsx)("span",{className:"text-slate-300 text-xs italic",children:"--"})}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-slate-600",children:x.length>0?(0,a.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-2 max-w-[100px]",title:"".concat(h," tick ho\xe0n th\xe0nh • th\xe1ng nhiệm vụ ").concat(i),children:(0,a.jsx)("div",{className:"bg-indigo-500 h-2 rounded-full transition-all duration-500",style:{width:"".concat(Math.min(5*h,100),"%")}})}):(0,a.jsx)("span",{className:"text-slate-400",children:"-"})}),(0,a.jsx)("td",{className:"px-6 py-4 text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[d===e.mhs?(0,a.jsx)("button",{disabled:!0,className:"px-4 py-2 bg-indigo-50 text-indigo-600 rounded-xl text-xs font-bold flex items-center gap-2",type:"button",children:(0,a.jsx)(o.A,{size:14,className:"animate-spin"})}):(0,a.jsx)("button",{onClick:()=>eO(e),className:"px-4 py-2 bg-white border border-indigo-200 hover:bg-indigo-600 hover:text-white hover:border-indigo-600 text-indigo-600 rounded-xl text-xs font-bold transition-all shadow-sm hover:shadow-md",type:"button",children:e.aiReport?"Tạo lại":"Tạo"}),(0,a.jsx)("button",{onClick:()=>{g(e.mhs),v("report")},className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-xl transition-all",title:"Xem chi tiết",type:"button",children:(0,a.jsx)($.A,{size:20})})]})})]},e.mhs)})})]})})})}),el&&(0,a.jsx)("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-300",children:(0,a.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-3xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-slate-100 bg-white z-10",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:el.name}),(0,a.jsxs)("p",{className:"text-sm text-slate-500 mt-1",children:["MHS: ",(0,a.jsx)("span",{className:"font-mono text-indigo-600",children:el.mhs})," | Lớp: ",el.class]})]}),(0,a.jsx)("button",{onClick:()=>g(null),className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-colors",type:"button",children:(0,a.jsx)(_.A,{size:24})})]}),(0,a.jsxs)("div",{className:"flex border-b border-slate-100 px-6",children:[(0,a.jsx)("button",{onClick:()=>v("report"),className:"py-3 px-4 text-sm font-semibold border-b-2 transition-colors ".concat("report"===f?"border-indigo-600 text-indigo-600":"border-transparent text-slate-500 hover:text-slate-700"),type:"button",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Q.A,{size:16})," B\xe1o c\xe1o AI"]})}),(0,a.jsx)("button",{onClick:()=>v("tracking"),className:"py-3 px-4 text-sm font-semibold border-b-2 transition-colors ".concat("tracking"===f?"border-indigo-600 text-indigo-600":"border-transparent text-slate-500 hover:text-slate-700"),type:"button",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{size:16})," Theo d\xf5i Th\xf3i quen"]})})]}),(0,a.jsxs)("div",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar bg-[#fcfcfc] flex-1",children:["report"===f&&(el.aiReport?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex justify-end mb-2",children:H?(0,a.jsxs)("button",{onClick:e_,className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-500 text-white rounded-lg text-xs font-semibold hover:bg-emerald-600 shadow-md transition-all",type:"button",children:[(0,a.jsx)(Z.A,{size:14})," Lưu"]}):(0,a.jsxs)("button",{onClick:()=>K(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-xs font-semibold hover:bg-slate-200 transition-colors",type:"button",children:[(0,a.jsx)(Y.A,{size:14})," Sửa nội dung"]})}),(0,a.jsxs)("div",{className:"p-5 rounded-2xl border ".concat("Cao"===el.aiReport.riskLevel?"border-red-200 bg-red-50/50":"Trung b\xecnh"===el.aiReport.riskLevel?"border-orange-200 bg-orange-50/50":"border-emerald-200 bg-emerald-50/50"),children:[(0,a.jsx)("h3",{className:"font-bold text-sm uppercase tracking-wide mb-3 ".concat("Cao"===el.aiReport.riskLevel?"text-red-700":"Trung b\xecnh"===el.aiReport.riskLevel?"text-orange-700":"text-emerald-700"),children:"Đ\xe1nh gi\xe1 Tổng quan"}),H?(0,a.jsx)("textarea",{className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-sm text-slate-700 bg-white",rows:3,value:W.overview,onChange:e=>ea({...W,overview:e.target.value})}):(0,a.jsx)("p",{className:"text-sm text-slate-800 leading-relaxed",children:el.aiReport.overview})]}),(0,a.jsxs)("div",{className:"bg-indigo-50/50 p-5 rounded-2xl border border-indigo-100",children:[(0,a.jsx)("h3",{className:"font-bold text-sm uppercase tracking-wide text-indigo-700 mb-3",children:"Lời nhắn cho Học sinh"}),H?(0,a.jsx)("textarea",{className:"w-full p-3 border border-indigo-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-sm text-slate-700 bg-white",rows:3,value:W.messageToStudent,onChange:e=>ea({...W,messageToStudent:e.target.value})}):(0,a.jsxs)("p",{className:"text-sm text-indigo-900 italic",children:['"',el.aiReport.messageToStudent,'"']})]}),(0,a.jsxs)("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 shadow-sm",children:[(0,a.jsxs)("h3",{className:"font-bold text-sm uppercase tracking-wide text-slate-600 mb-3 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full bg-slate-400"}),"Ghi ch\xfa Ri\xeang tư (GV)"]}),H?(0,a.jsx)("textarea",{className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-sm text-slate-700 bg-slate-50",rows:3,value:W.teacherNotes,onChange:e=>ea({...W,teacherNotes:e.target.value})}):(0,a.jsx)("p",{className:"text-sm text-slate-600",children:el.aiReport.teacherNotes})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-sm uppercase tracking-wide text-slate-600 mb-3 ml-1",children:"Kế hoạch Học tập"}),(0,a.jsx)("div",{className:"text-sm text-slate-600 bg-white border border-slate-100 rounded-2xl shadow-sm divide-y divide-slate-50",children:el.aiReport.studyPlan.map((e,t)=>(0,a.jsxs)("div",{className:"p-4 grid grid-cols-4 gap-4",children:[(0,a.jsx)("span",{className:"font-bold text-slate-400 text-xs uppercase pt-1",children:e.day}),(0,a.jsx)("span",{className:"text-indigo-600 font-semibold",children:e.subject}),(0,a.jsx)("span",{className:"col-span-2 text-slate-700",children:e.content})]},t))})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-slate-400",children:[(0,a.jsx)(ee.A,{size:48,className:"mb-4 opacity-50"}),(0,a.jsx)("p",{children:'Chưa c\xf3 b\xe1o c\xe1o AI. H\xe3y nhấn n\xfat "Tạo" ở m\xe0n h\xecnh ch\xednh.'})]})),"score"===f&&el&&(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(y,{data:(()=>{let e={};return t.forEach(t=>{(t.scores||[]).forEach(t=>{if(!t.month)return;e[t.month]||(e[t.month]={math:{total:0,count:0},lit:{total:0,count:0},eng:{total:0,count:0}});let s=e[t.month];"number"==typeof t.math&&(s.math.total+=t.math,s.math.count++),"number"==typeof t.lit&&(s.lit.total+=t.lit,s.lit.count++),"number"==typeof t.eng&&(s.eng.total+=t.eng,s.eng.count++)})}),(el.scores||[]).map(t=>{var s,a,l;let n=e[t.month];return{...t,gradeMath:(null==n||null==(s=n.math)?void 0:s.count)?parseFloat((n.math.total/n.math.count).toFixed(1)):0,gradeLit:(null==n||null==(a=n.lit)?void 0:a.count)?parseFloat((n.lit.total/n.lit.count).toFixed(1)):0,gradeEng:(null==n||null==(l=n.eng)?void 0:l.count)?parseFloat((n.eng.total/n.eng.count).toFixed(1)):0}})})(),stats:{classAvg:0,gradeAvg:0,avgScore:0,targetScore:0,leaderboardClass:{},leaderboardGrade:{},gradeAvgSubjectsByMonth:{}}})}),"tracking"===f&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6",children:[(0,a.jsx)("h3",{className:"font-bold text-slate-800",children:eB}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-white border border-slate-200 rounded-xl p-1 shadow-sm",children:[(0,a.jsx)("button",{type:"button",onClick:()=>ec("7"),className:"px-3 py-1.5 text-xs font-bold rounded-lg ".concat("7"===ed?"bg-indigo-600 text-white":"text-slate-600 hover:bg-slate-100"),children:"7 ng\xe0y"}),(0,a.jsx)("button",{type:"button",onClick:()=>ec("30"),className:"px-3 py-1.5 text-xs font-bold rounded-lg ".concat("30"===ed?"bg-indigo-600 text-white":"text-slate-600 hover:bg-slate-100"),children:"30 ng\xe0y"}),(0,a.jsx)("button",{type:"button",onClick:()=>ec("90"),className:"px-3 py-1.5 text-xs font-bold rounded-lg ".concat("90"===ed?"bg-indigo-600 text-white":"text-slate-600 hover:bg-slate-100"),children:"90 ng\xe0y"}),(0,a.jsx)("button",{type:"button",onClick:()=>ec("month"),className:"px-3 py-1.5 text-xs font-bold rounded-lg ".concat("month"===ed?"bg-indigo-600 text-white":"text-slate-600 hover:bg-slate-100"),children:"Theo th\xe1ng"})]}),"month"===ed&&(0,a.jsx)("select",{value:ex,onChange:e=>eh(e.target.value),className:"ml-1 px-3 py-2 text-sm rounded-xl border border-slate-200 bg-white shadow-sm outline-none",children:eC.slice().sort().reverse().map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]}),0===ez.length?(0,a.jsx)("div",{className:"text-center py-10 text-slate-500 italic bg-slate-50 rounded-xl border border-dashed border-slate-200",children:"Th\xe1ng n\xe0y chưa c\xf3 nhiệm vụ n\xe0o (hoặc học sinh chưa được giao th\xf3i quen)."}):(0,a.jsx)("div",{className:"space-y-6",children:ez.map(e=>{let t=function(e){let t=new Map;return((null==e?void 0:e.ticks)||[]).forEach(e=>t.set(String(null==e?void 0:e.date),!!(null==e?void 0:e.completed))),t}(e),s=eL.reduce((e,s)=>e+ +!!t.get(s),0);return(0,a.jsxs)("div",{className:"bg-white border border-slate-100 rounded-2xl p-5 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-700",children:e.description}),(0,a.jsx)("span",{className:"text-xs font-medium text-slate-400 bg-slate-100 px-2 py-0.5 rounded mt-1 inline-block",children:e.frequency})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"text-2xl font-bold text-indigo-600",children:s}),(0,a.jsx)("p",{className:"text-[10px] text-slate-400 uppercase tracking-wide font-bold",children:"Tick (trong kỳ)"})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"min-w-[700px] flex items-center justify-between gap-2",children:eL.map(e=>{let s=!!t.get(e),l=new Date(e),n="".concat(l.getDate(),"/").concat(l.getMonth()+1);return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1",children:[(0,a.jsx)("div",{className:"w-full h-2 rounded-full transition-all duration-500 ".concat(s?"bg-emerald-500":"bg-slate-100")}),(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-medium transition-all ".concat(s?"bg-emerald-100 text-emerald-700":"bg-slate-50 text-slate-400 border border-slate-100"),title:e,children:s?(0,a.jsx)(h.A,{size:16}):(0,a.jsx)("span",{className:"text-[10px]",children:n})})]},e)})})})]},e.id)})})]})]})]})})]})};function ec(e){let{onLogin:t}=e,[s,n]=(0,l.useState)(""),[r,i]=(0,l.useState)(""),[o,d]=(0,l.useState)(null),[c,x]=(0,l.useState)(!1),h=async e=>{e.preventDefault(),d(null),x(!0);try{await t(s,r)}catch(e){d((null==e?void 0:e.message)||"Đăng nhập thất bại")}finally{x(!1)}};return(0,a.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-6",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow p-6",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-slate-800",children:"Đăng nhập"}),(0,a.jsx)("div",{className:"text-sm text-slate-500 mt-1",children:" Gi\xe1o vi\xean / Học sinh"}),(0,a.jsxs)("form",{onSubmit:h,className:"mt-6 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-slate-700 mb-1",children:"T\xe0i khoản"}),(0,a.jsx)("input",{className:"w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-200",value:s,onChange:e=>n(e.target.value),placeholder:"gv... / MHS",autoComplete:"username"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-slate-700 mb-1",children:"Mật khẩu"}),(0,a.jsx)("input",{className:"w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-200",value:r,onChange:e=>i(e.target.value),placeholder:"••••••••",type:"password",autoComplete:"current-password"})]}),o?(0,a.jsx)("div",{className:"text-sm text-red-600",children:o}):null,(0,a.jsx)("button",{disabled:c,className:"w-full rounded-xl bg-slate-900 text-white py-2 font-semibold hover:bg-slate-800 disabled:opacity-60",type:"submit",children:c?"Đang đăng nhập...":"Đăng nhập"})]})]})})}function ex(){let[e,t]=(0,l.useState)(null),[s,n]=(0,l.useState)(!0),[i,o]=(0,l.useState)([]),[d,c]=(0,l.useState)(null),x=(0,l.useMemo)(()=>e?"STUDENT"===e.role?"STUDENT":"TEACHER":"LOGIN",[e]);async function h(){n(!0);try{let e=await fetch("/api/me",{credentials:"include"}).then(e=>e.json());if((null==e?void 0:e.ok)&&(null==e?void 0:e.session)){let s={username:String(e.session.username||"admin"),name:e.session.name||"User",role:e.session.role};if(s.teacherClass=e.session.teacherClass,t(s),"STUDENT"===s.role){let e=await r.getStudentMe(s.username);c(e)}else{let e=await r.getAllStudents();o(e)}}else t(null),o([]),c(null)}catch(e){t(null),o([]),c(null)}finally{n(!1)}}(0,l.useEffect)(()=>{h()},[]);let m=async(e,s)=>{let a=await r.login(e,s);if(!a.success||!a.user)throw Error(a.error||"Đăng nhập thất bại");t(a.user),"STUDENT"===a.user.role?c(await r.getStudentMe(a.user.username)):o(await r.getAllStudents())},u=async()=>{try{await r.logout()}finally{t(null),o([]),c(null)}},g=async e=>{await r.importExcel(e),o(await r.getAllStudents())},p=async(e,t,s,a)=>{await r.saveReport(e,t,s,a),o(a=>a.map(a=>String(a.mhs).trim()!==String(e).trim()?a:{...a,aiReport:t,activeActions:s}))},b=async(t,s,a)=>{if(e&&"STUDENT"===e.role&&d){c(e=>e?function(e,t,s,a){let l=e=>(Array.isArray(e)?e:[]).map(e=>e&&e.id===t?{...e,ticks:function(e,t,s){let a=(Array.isArray(e)?[...e]:[]).filter(e=>String((null==e?void 0:e.date)||"")!==t);return s&&a.push({date:t,completed:!0}),a}(e.ticks,s,a)}:e),n={...e};if(n.activeActions=l(n.activeActions),n.actionsByMonth&&"object"==typeof n.actionsByMonth){let e={...n.actionsByMonth};for(let t of Object.keys(e))e[t]=l(e[t]);n.actionsByMonth=e}return n}(e,t,s,a):e);try{let l=await r.tick(e.username,t,s,a);if(null==l?void 0:l.student)c(l.student);else{let t=await r.getStudentMe(e.username);c(t)}}catch(t){c(await r.getStudentMe(e.username))}}};return s?(0,a.jsx)("div",{className:"p-6 text-slate-600",children:"Đang tải..."}):"LOGIN"===x?(0,a.jsx)(ec,{onLogin:m}):"STUDENT"===x?d?(0,a.jsx)(H,{student:d,onLogout:u,onUpdateAction:b}):(0,a.jsx)("div",{className:"p-6 text-slate-600",children:"Đang tải dữ liệu học sinh..."}):(0,a.jsx)(ed,{students:i,onImportData:g,onUpdateStudentReport:p,onLogout:u})}}},e=>{e.O(0,[55,441,255,358],()=>e(e.s=1389)),_N_E=e.O()}]);