(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{43205:(e,t,s)=>{"use strict";s.d(t,{default:()=>te});var l=s(95155),a=s(12115);async function n(e,t){let s=await fetch(e,{credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},...t});if(!s.ok)throw Error(await s.text().catch(()=>"")||"HTTP ".concat(s.status));return await s.json()}let r={async login(e,t){try{let s=await n("/api/login",{method:"POST",body:JSON.stringify({username:e,password:t})});if(!s.ok)return{success:!1,error:s.error||"Đăng nhập thất bại"};return{success:!0,user:s.user}}catch(e){return{success:!1,error:(null==e?void 0:e.message)||"Lỗi kết nối server"}}},async logout(){await n("/api/logout",{method:"POST"})},getAllStudents:async()=>(await n("/api/admin/get-students")).students||[],async getStudentMe(e){let t=await n("/api/student/me");return{...t.student,stats:t.stats}},importExcel:async e=>(await n("/api/admin/save-students",{method:"POST",body:JSON.stringify({students:e})}),{success:!0}),saveReport:async(e,t,s,l)=>(await n("/api/admin/save-report",{method:"POST",body:JSON.stringify({mhs:e,report:t,actions:s,monthKey:l})}),{success:!0}),async tick(e,t,s,l){let a="",r="",i=!1;return"boolean"==typeof l?(a=String(null!=t?t:"").trim(),r=String(null!=s?s:"").trim(),i=!!l):(a=String(null!=e?e:"").trim(),r=String(null!=t?t:"").trim(),i=!!s),{success:!0,student:(await n("/api/student/tick",{method:"POST",body:JSON.stringify({actionId:a,date:r,completed:i})})).student}},generateStudentReport:async e=>n("/api/ai/generate-report",{method:"POST",body:JSON.stringify({student:e})}),syncSheet:async e=>n("/api/sync/sheets",{method:"POST",body:JSON.stringify(e||{mode:"new_only"})}),addStudent:async e=>n("/api/admin/add-student",{method:"POST",body:JSON.stringify(e)}),addTeacher:async e=>n("/api/admin/add-teacher",{method:"POST",body:JSON.stringify(e)}),getUsers:async()=>n("/api/admin/users"),deleteStudent:async e=>n("/api/admin/delete-student",{method:"POST",body:JSON.stringify({mhs:e})}),updateStudent:async(e,t)=>n("/api/admin/update-student",{method:"POST",body:JSON.stringify({mhs:e,...t})})},i=r.generateStudentReport;var o=s(35299);function d(){let[e,t]=(0,a.useState)(""),[s,n]=(0,a.useState)(""),[r,i]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),x=async()=>{if(!e||!s)return alert("Nhập đủ mật khẩu hiện tại + mật khẩu mới");if(s!==r)return alert("Mật khẩu mới nhập lại kh\xf4ng khớp");c(!0);try{let l=await fetch("/api/account/change-password",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:s})}),a=await l.json().catch(()=>({}));if(!l.ok||!(null==a?void 0:a.ok))return alert((null==a?void 0:a.error)||"Đổi mật khẩu thất bại");t(""),n(""),i(""),alert("Đổi mật khẩu th\xe0nh c\xf4ng")}catch(e){alert((null==e?void 0:e.message)||"Network error")}finally{c(!1)}};return(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,l.jsx)("div",{className:"text-sm font-bold text-slate-800 mb-3",children:"Đổi mật khẩu"}),(0,l.jsxs)("div",{className:"grid gap-3",children:[(0,l.jsx)("input",{type:"password",value:e,onChange:e=>t(e.target.value),placeholder:"Mật khẩu hiện tại",className:"px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500"}),(0,l.jsx)("input",{type:"password",value:s,onChange:e=>n(e.target.value),placeholder:"Mật khẩu mới",className:"px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500"}),(0,l.jsx)("input",{type:"password",value:r,onChange:e=>i(e.target.value),placeholder:"Nhập lại mật khẩu mới",className:"px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500"}),(0,l.jsxs)("button",{onClick:x,disabled:d,className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white font-semibold disabled:opacity-50",children:[d?(0,l.jsx)(o.A,{className:"animate-spin",size:18}):null,"Lưu mật khẩu mới"]})]})]})}var c=s(1524),x=s(47937),h=s(95740),m=s(38104),u=s(5917),p=s(30814),g=s(26265),b=s(35161),f=s(68425),j=s(47734),v=s(73697),N=s(33420),y=s(57095),w=s(94621);let S={math:{label:"To\xe1n",color:"#3b82f6",gradient:["#3b82f6","#60a5fa"]},lit:{label:"Văn",color:"#ec4899",gradient:["#ec4899","#f472b6"]},eng:{label:"Anh",color:"#8b5cf6",gradient:["#8b5cf6","#a78bfa"]}};function k(e){let{data:t,stats:s,subject:n}=e,r=(0,a.useMemo)(()=>[...t].sort((e,t)=>String(e.month).localeCompare(String(t.month))),[t]);if(!r||0===r.length)return(0,l.jsx)("div",{className:"flex flex-col items-center justify-center h-[250px] text-slate-400 bg-slate-50/50 rounded-2xl border border-dashed border-slate-200",children:(0,l.jsx)("p",{className:"font-medium",children:"Chưa c\xf3 dữ liệu điểm."})});let i=n?S[n]:null;return(0,l.jsx)("div",{className:"w-full h-[280px]",children:(0,l.jsx)(g.u,{width:"100%",height:"100%",children:(0,l.jsxs)(b.X,{data:r,margin:{top:20,right:20,bottom:0,left:-20},children:[(0,l.jsx)("defs",{children:n&&(0,l.jsxs)("linearGradient",{id:"color".concat(n),x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,l.jsx)("stop",{offset:"5%",stopColor:null==i?void 0:i.color,stopOpacity:.2}),(0,l.jsx)("stop",{offset:"95%",stopColor:null==i?void 0:i.color,stopOpacity:0})]})}),(0,l.jsx)(f.d,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),(0,l.jsx)(j.W,{dataKey:"month",tick:{fontSize:11,fill:"#64748b",fontWeight:600},axisLine:!1,tickLine:!1,dy:10}),(0,l.jsx)(v.h,{domain:[0,10],tick:{fontSize:11,fill:"#64748b"},axisLine:!1,tickLine:!1,dx:-10,padding:{top:10,bottom:0}}),(0,l.jsx)(N.m,{content:(0,l.jsx)(e=>{let{active:t,payload:s,label:a}=e;return t&&s&&s.length?(0,l.jsxs)("div",{className:"bg-white/90 backdrop-blur-md border border-slate-200 shadow-xl rounded-xl p-3 text-xs",children:[(0,l.jsx)("p",{className:"font-bold text-slate-700 mb-2 uppercase tracking-wider",children:a}),s.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1 last:mb-0",children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),(0,l.jsxs)("span",{className:"font-medium text-slate-600",children:[e.name,": ",(0,l.jsx)("span",{className:"font-bold text-slate-800",children:e.value})]})]},t))]}):null},{}),cursor:{fill:"#f1f5f9",radius:8}}),n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(y.N1,{type:"monotone",dataKey:"math"===n?"targetMath":"lit"===n?"targetLit":"targetEng",name:"Mục ti\xeau",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"4 4",dot:!1,activeDot:!1}),(0,l.jsx)(w.Gk,{type:"monotone",dataKey:"math"===n?"gradeMath":"lit"===n?"gradeLit":"gradeEng",name:"TB Khối",stroke:"none",fill:"#94a3b8",fillOpacity:.1}),(0,l.jsx)(y.N1,{type:"monotone",dataKey:n,name:"Điểm ".concat(null==i?void 0:i.label),stroke:null==i?void 0:i.color,strokeWidth:3,dot:e=>{let{cx:t,cy:s,payload:a}=e,r=a[n],o=a["math"===n?"targetMath":"lit"===n?"targetLit":"targetEng"];return"number"==typeof r&&"number"==typeof o&&r>=o?(0,l.jsx)("svg",{x:t-10,y:s-10,width:20,height:20,viewBox:"0 0 24 24",fill:"#EAB308",stroke:"#EAB308",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,l.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}):(0,l.jsx)("circle",{cx:t,cy:s,r:4,stroke:null==i?void 0:i.color,strokeWidth:2,fill:"#fff"})},activeDot:{r:6,strokeWidth:0,fill:null==i?void 0:i.color},animationDuration:1500})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(y.N1,{type:"monotone",dataKey:"math",stroke:"#3b82f6",strokeWidth:2,dot:!1}),(0,l.jsx)(y.N1,{type:"monotone",dataKey:"lit",stroke:"#ec4899",strokeWidth:2,dot:!1}),(0,l.jsx)(y.N1,{type:"monotone",dataKey:"eng",stroke:"#8b5cf6",strokeWidth:2,dot:!1})]})]})})})}var A=s(84926);function C(e){let{student:t,streak:s,onLogout:a}=e;return(0,l.jsx)("header",{className:"sticky top-0 z-50 px-4 sm:px-8 py-4",children:(0,l.jsx)("div",{className:"mx-auto max-w-[1400px]",children:(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-white/50 shadow-lg shadow-slate-200/20 rounded-2xl px-6 py-3 flex items-center justify-between transition-all hover:bg-white/90",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-600 to-blue-600 flex items-center justify-center text-white shadow-lg shadow-indigo-600/20",children:(0,l.jsx)("span",{className:"font-bold text-lg",children:t.name.charAt(0)})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-lg font-bold text-slate-800 tracking-tight leading-none",children:t.name}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs font-medium text-slate-500 mt-1",children:[(0,l.jsxs)("span",{className:"bg-slate-100 px-2 py-0.5 rounded-md",children:["Lớp ",t.class]}),(0,l.jsx)("span",{className:"text-slate-300",children:"•"}),(0,l.jsx)("span",{className:"font-mono text-indigo-500",children:t.mhs})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[s>0&&(0,l.jsxs)("div",{className:"hidden sm:flex items-center gap-2 bg-orange-50 border border-orange-100 text-orange-600 px-3 py-1.5 rounded-xl animate-in fade-in zoom-in",children:[(0,l.jsx)("div",{className:"p-1 bg-orange-100 rounded-lg",children:(0,l.jsx)(h.A,{size:14,className:"animate-pulse"})}),(0,l.jsxs)("div",{className:"text-sm font-bold",children:[s," ng\xe0y li\xean tiếp \uD83D\uDD25"]})]}),(0,l.jsx)("div",{className:"h-8 w-px bg-slate-200 mx-2 hidden sm:block"}),(0,l.jsxs)("button",{onClick:a,className:"flex items-center gap-2 text-sm font-semibold text-slate-500 hover:text-red-600 hover:bg-red-50 px-3 py-2 rounded-xl transition-all",children:[(0,l.jsx)(A.A,{size:18}),(0,l.jsx)("span",{className:"hidden sm:inline",children:"Đăng xuất"})]})]})]})})})}var T=s(52472),D=s(77801);function M(e){let{overviewText:t,strengthsText:s,risksText:a}=e;return(0,l.jsxs)("div",{className:"grid md:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"group relative bg-white/70 backdrop-blur-xl border border-white/50 p-6 rounded-[2rem] shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-lg transition-all overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:(0,l.jsx)(c.A,{size:80,className:"text-blue-600 transform rotate-12"})}),(0,l.jsxs)("div",{className:"relative z-10",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center mb-4",children:(0,l.jsx)(c.A,{size:20})}),(0,l.jsx)("div",{className:"text-sm font-bold text-slate-800 uppercase tracking-wide opacity-60 mb-2",children:"Tổng quan"}),(0,l.jsx)("div",{className:"text-sm font-medium text-slate-700 leading-relaxed text-justify",children:t})]})]}),(0,l.jsxs)("div",{className:"group relative bg-white/70 backdrop-blur-xl border border-white/50 p-6 rounded-[2rem] shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-lg transition-all overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:(0,l.jsx)(T.A,{size:80,className:"text-emerald-600 transform -rotate-12"})}),(0,l.jsxs)("div",{className:"relative z-10",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-emerald-50 text-emerald-600 flex items-center justify-center mb-4",children:(0,l.jsx)(T.A,{size:20})}),(0,l.jsx)("div",{className:"text-sm font-bold text-slate-800 uppercase tracking-wide opacity-60 mb-2",children:"Điểm mạnh"}),(0,l.jsx)("div",{className:"text-sm font-medium text-slate-700 leading-relaxed",children:s})]})]}),(0,l.jsxs)("div",{className:"group relative bg-white/70 backdrop-blur-xl border border-white/50 p-6 rounded-[2rem] shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-lg transition-all overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:(0,l.jsx)(D.A,{size:80,className:"text-orange-600 transform rotate-6"})}),(0,l.jsxs)("div",{className:"relative z-10",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-orange-50 text-orange-600 flex items-center justify-center mb-4",children:(0,l.jsx)(D.A,{size:20})}),(0,l.jsx)("div",{className:"text-sm font-bold text-slate-800 uppercase tracking-wide opacity-60 mb-2",children:"Cần lưu \xfd"}),(0,l.jsx)("div",{className:"text-sm font-medium text-slate-700 leading-relaxed",children:a})]})]})]})}var E=s(90368),L=s(27937);function z(e){let{selectedTaskMonthSafe:t,selectedDate:s,monthKeys:a,canPrevMonth:n,canNextMonth:r,onSelectMonth:i,onSelectDate:o,onPrevMonth:d,onNextMonth:c}=e;return(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-bold text-slate-800",children:"Th\xf3i quen H\xe0ng ng\xe0y"}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:["Nhiệm vụ theo th\xe1ng: ",(0,l.jsx)("b",{children:t})," (th\xe1ng sau c\xf3 thể kh\xe1c)."]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,l.jsx)("button",{onClick:d,disabled:!n,className:"p-2 rounded-xl border border-slate-200 bg-white disabled:opacity-40",title:"Th\xe1ng trước",children:(0,l.jsx)(E.A,{size:18})}),(0,l.jsx)("select",{value:t,onChange:e=>i(e.target.value),className:"px-3 py-2 rounded-xl border border-slate-200 bg-white text-sm font-semibold text-slate-700",children:a.map(e=>(0,l.jsx)("option",{value:e,children:e},e))}),(0,l.jsx)("button",{onClick:c,disabled:!r,className:"p-2 rounded-xl border border-slate-200 bg-white disabled:opacity-40",title:"Th\xe1ng sau",children:(0,l.jsx)(L.A,{size:18})}),(0,l.jsx)("input",{type:"date",value:s,onChange:e=>o(e.target.value),className:"px-3 py-2 rounded-xl border border-slate-200 text-sm bg-white"})]})]})}var R=s(6613),O=s(76378);function H(e){let{leaderboardClass:t,leaderboardGrade:s,currentMhs:n,month:r}=e,[i,o]=(0,a.useState)("class"),d="class"===i?t:s,c=(null==d?void 0:d[r])||[];return(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(R.A,{className:"text-indigo-600",size:20}),(0,l.jsx)("div",{className:"text-sm font-bold text-slate-800",children:"Bảng Xếp Hạng"})]}),(0,l.jsxs)("span",{className:"text-[10px] bg-indigo-100 text-indigo-700 font-mono px-2 py-0.5 rounded-full w-fit",children:["Th\xe1ng ",r]})]}),(0,l.jsxs)("div",{className:"flex bg-slate-100 p-1 rounded-xl",children:[(0,l.jsx)("button",{onClick:()=>o("class"),className:"px-3 py-1.5 rounded-lg text-xs font-bold transition ".concat("class"===i?"bg-white text-indigo-600 shadow-sm":"text-slate-500 hover:text-slate-600"),children:"Lớp"}),(0,l.jsx)("button",{onClick:()=>o("grade"),className:"px-3 py-1.5 rounded-lg text-xs font-bold transition ".concat("grade"===i?"bg-white text-indigo-600 shadow-sm":"text-slate-500 hover:text-slate-600"),children:"Khối"})]})]}),(0,l.jsx)("div",{className:"space-y-3",children:0===c.length?(0,l.jsxs)("div",{className:"text-center py-4 text-xs text-slate-400 italic",children:["Chưa c\xf3 dữ liệu th\xe1ng ",r,"."]}):c.map(e=>{var t,s;let a=e.id===n;return(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-xl border ".concat(1===(t=e.rank)?"bg-yellow-50 border-yellow-200":2===t?"bg-slate-50 border-slate-200":3===t?"bg-orange-50 border-orange-200":"bg-white border-slate-100"," ").concat(a?"ring-2 ring-indigo-500 ring-offset-2":""),children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-8 flex justify-center",children:1===(s=e.rank)?(0,l.jsx)(R.A,{size:20,className:"text-yellow-500"}):2===s?(0,l.jsx)(O.A,{size:20,className:"text-gray-400"}):3===s?(0,l.jsx)(T.A,{size:20,className:"text-orange-500"}):(0,l.jsx)("span",{className:"text-sm font-bold text-slate-500 w-5 text-center",children:s})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[e.name,a&&(0,l.jsx)("span",{className:"text-[10px] bg-indigo-600 text-white px-1.5 rounded",children:"Bạn"})]}),(0,l.jsx)("div",{className:"text-[10px] text-slate-500",children:e.class})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-sm font-bold text-slate-800",children:e.score}),(0,l.jsx)("div",{className:"text-[10px] text-slate-400 uppercase",children:"Ticks"})]})]},e.id)})}),(0,l.jsxs)("div",{className:"mt-4 text-[11px] text-slate-400 text-center",children:["* Top 3 học sinh chăm chỉ nhất th\xe1ng ",r,"."]})]})}function I(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(l)}function B(e){return I(e).slice(0,7)}function G(e){var t,s;let l=Array.isArray(e)?e:[],a=null==(s=l[l.length-1])||null==(t=s.month)?void 0:t.trim();return a&&/^\d{4}-\d{2}$/.test(a)?a:B(new Date)}function _(e){let t=e.actionsByMonth;return t&&"object"==typeof t?t:{}}function F(e){let t=new Map;return(e.ticks||[]).forEach(e=>t.set(String(e.date),!!e.completed)),t}function P(e){var t,s,n,r;let{student:i,onUpdateAction:o,onLogout:g}=e,b=(0,a.useMemo)(()=>(function(e){let t=String(e||"").trim();if(!/^\d{4}-\d{2}$/.test(t))return B(new Date);let[s,l]=t.split("-"),a=Number(s),n=Number(l);return a&&n?(13===(n+=1)&&(n=1,a+=1),"".concat(String(a).padStart(4,"0"),"-").concat(String(n).padStart(2,"0"))):B(new Date)})(G(i.scores)),[i.scores]),[f,j]=(0,a.useState)(()=>B(new Date)),[v,N]=(0,a.useState)(()=>I(new Date)),[y,w]=(0,a.useState)("range"),[S,A]=(0,a.useState)(30),T=(0,a.useMemo)(()=>Array.from(new Set([...(i.scores||[]).map(e=>String(e.month||"").trim()).filter(e=>/^\d{4}-\d{2}$/.test(e)),...Object.keys(_(i)).filter(e=>/^\d{4}-\d{2}$/.test(e)),b,B(new Date)])).sort((e,t)=>e.localeCompare(t)),[i,b]),D=(0,a.useMemo)(()=>{if(T.includes(f))return f;let e=B(new Date);return T.includes(e)?e:b},[f,T,b]);(0,a.useEffect)(()=>{let e=I(new Date);v.slice(0,7)!==D&&(e.startsWith(D)?N(e):N("".concat(D,"-01")))},[D]),(0,a.useEffect)(()=>{let e=new Date;j(B(e)),N(I(e))},[]);let E=(0,a.useMemo)(()=>(function(e,t){let s=_(e),l=null==s?void 0:s[t];return Array.isArray(l)&&l.length?l:Array.isArray(e.activeActions)?e.activeActions:[]})(i,D),[i,D]),L=i.aiReport,R=(0,a.useMemo)(()=>{let e=Array.isArray(null==L?void 0:L.studyPlan)?L.studyPlan:[],t=new Map;for(let s of e){let e=String(s.day||"").trim()||"Kh\xe1c";t.has(e)||t.set(e,[]),t.get(e).push(s)}return Array.from(t.entries())},[L]),O=(0,a.useMemo)(()=>(function(e){let t,s=new Set;if(Object.values(_(e)).forEach(e=>{e.forEach(e=>{var t;null==(t=e.ticks)||t.forEach(e=>{e.completed&&s.add(String(e.date))})})}),Array.isArray(e.activeActions)&&e.activeActions.forEach(e=>{var t;null==(t=e.ticks)||t.forEach(e=>{e.completed&&s.add(String(e.date))})}),0===s.size)return 0;let l=new Date,a=I(l),n=new Date(l);n.setDate(n.getDate()-1);let r=I(n);if(s.has(a))t=l;else{if(!s.has(r))return 0;t=n}let i=0;for(let e=0;e<3650;e++){let e=I(t);if(s.has(e))i++,t.setDate(t.getDate()-1);else break}return i})(i),[i]),P=(0,a.useMemo)(()=>{var e,t;let s=i.scores||[],l=(null==(e=i.dashboardStats)?void 0:e.gradeAvgSubjectsByMonth)||{},a=(null==(t=i.dashboardStats)?void 0:t.subjectTargets)||{};return s.map(e=>{let t=l[e.month]||{},s=a[e.month]||{};return{...e,gradeMath:t.math||0,gradeLit:t.lit||0,gradeEng:t.eng||0,targetMath:s.math||0,targetLit:s.lit||0,targetEng:s.eng||0}})},[i.scores,i.dashboardStats]),U=async e=>{let t=!!F(e).get(v);await o(e.id,v,!t)},K=T.indexOf(D);return(0,l.jsxs)("div",{className:"min-h-screen font-sans bg-fixed bg-gradient-to-br from-indigo-50 via-white to-sky-50 text-slate-800",children:[(0,l.jsxs)("div",{className:"fixed inset-0 pointer-events-none z-0 opacity-40",children:[(0,l.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-indigo-200/40 rounded-full blur-[120px] animate-pulse-slow"}),(0,l.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-cyan-200/40 rounded-full blur-[120px] animate-pulse-slow delay-1000"})]}),(0,l.jsxs)("div",{className:"relative z-10 flex flex-col min-h-screen",children:[(0,l.jsx)(C,{student:i,onLogout:g,streak:O}),(0,l.jsxs)("main",{className:"max-w-[1400px] mx-auto w-full px-4 sm:px-6 py-8 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[(0,l.jsx)(M,{overviewText:(null==L?void 0:L.overview)||"Dữ liệu mới nhất th\xe1ng ".concat(G(i.scores),"."),strengthsText:(null==L?void 0:L.strengths)&&L.strengths[0]||"C\xf3 dữ liệu đầy đủ.",risksText:(null==L?void 0:L.risks)&&L.risks[0]||"Cần duy tr\xec đều đặn."}),(0,l.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-8",children:[(0,l.jsxs)("div",{className:"xl:col-span-8 space-y-8",children:[(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"group bg-white/70 backdrop-blur-xl border border-white/50 shadow-[0_8px_30px_rgb(0,0,0,0.04)] rounded-3xl p-6 transition-all hover:shadow-[0_8px_30px_rgb(99,102,241,0.1)] hover:scale-[1.01]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 shadow-lg shadow-blue-500/30 flex items-center justify-center text-white",children:(0,l.jsx)(c.A,{size:20})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-lg font-bold text-slate-800",children:"To\xe1n học"}),(0,l.jsx)("div",{className:"text-xs text-slate-500 font-medium tracking-wide",children:"MATH PROGRESS"})]})]}),(0,l.jsx)(k,{data:P,stats:i.dashboardStats,subject:"math"})]}),(0,l.jsxs)("div",{className:"group bg-white/70 backdrop-blur-xl border border-white/50 shadow-[0_8px_30px_rgb(0,0,0,0.04)] rounded-3xl p-6 transition-all hover:shadow-[0_8px_30px_rgb(236,72,153,0.1)] hover:scale-[1.01]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-pink-500 to-rose-500 shadow-lg shadow-pink-500/30 flex items-center justify-center text-white",children:(0,l.jsx)(x.A,{size:20})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-lg font-bold text-slate-800",children:"Ngữ Văn"}),(0,l.jsx)("div",{className:"text-xs text-slate-500 font-medium tracking-wide",children:"LITERATURE"})]})]}),(0,l.jsx)(k,{data:P,stats:i.dashboardStats,subject:"lit"})]}),(0,l.jsxs)("div",{className:"md:col-span-2 group bg-white/70 backdrop-blur-xl border border-white/50 shadow-[0_8px_30px_rgb(0,0,0,0.04)] rounded-3xl p-6 transition-all hover:shadow-[0_8px_30px_rgb(139,92,246,0.1)] hover:scale-[1.01]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-500 shadow-lg shadow-violet-500/30 flex items-center justify-center text-white",children:(0,l.jsx)(h.A,{size:20})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-lg font-bold text-slate-800",children:"Tiếng Anh"}),(0,l.jsx)("div",{className:"text-xs text-slate-500 font-medium tracking-wide",children:"ENGLISH"})]})]}),(0,l.jsx)("div",{className:"h-[250px] w-full",children:(0,l.jsx)(k,{data:P,stats:i.dashboardStats,subject:"eng"})})]})]}),(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-white/60 shadow-xl shadow-slate-200/40 rounded-[2rem] p-8 relative overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-100/30 rounded-full blur-[80px] -mr-16 -mt-16 pointer-events-none"}),(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-8 relative z-10",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-2xl font-bold text-slate-800 tracking-tight mb-2",children:"Nhiệm vụ H\xe0ng ng\xe0y"}),(0,l.jsx)("p",{className:"text-slate-500 text-sm",children:"Ho\xe0n th\xe0nh c\xe1c mục ti\xeau nhỏ để đạt kết quả lớn."})]}),(0,l.jsx)(z,{selectedTaskMonthSafe:D,selectedDate:v,monthKeys:T,canPrevMonth:K>0,canNextMonth:K<T.length-1,onSelectMonth:j,onSelectDate:N,onPrevMonth:()=>K>0&&j(T[K-1]),onNextMonth:()=>K<T.length-1&&j(T[K+1])})]}),0===E.length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50",children:[(0,l.jsx)(m.A,{size:48,className:"text-slate-300 mb-4"}),(0,l.jsx)("div",{className:"text-slate-500 font-medium",children:"Chưa c\xf3 nhiệm vụ cho th\xe1ng n\xe0y"}),(0,l.jsx)("div",{className:"text-sm text-slate-400 mt-1",children:"H\xe3y tận hưởng thời gian nghỉ ngơi!"})]}):(0,l.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:E.map(e=>{let t=!!F(e).get(v);return(0,l.jsxs)("button",{onClick:()=>U(e),className:"group relative flex items-center justify-between p-5 rounded-2xl border transition-all duration-300 ".concat(t?"bg-gradient-to-r from-emerald-50 to-emerald-100/50 border-emerald-200 shadow-sm":"bg-white border-slate-100 hover:border-indigo-200 hover:shadow-md hover:-translate-y-0.5"),children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-500 ".concat(t?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/30 rotate-0":"bg-slate-100 text-slate-300 group-hover:bg-indigo-50 group-hover:text-indigo-400 rotate-12 group-hover:rotate-0"),children:(0,l.jsx)(u.A,{size:24,strokeWidth:3,className:t?"scale-100 opacity-100 transition-all":"scale-50 opacity-0"})}),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("div",{className:"font-bold transition-colors ".concat(t?"text-slate-800":"text-slate-600 group-hover:text-indigo-900"),children:e.description}),(0,l.jsx)("div",{className:"text-xs font-medium mt-1 ".concat(t?"text-emerald-600":"text-slate-400"),children:e.frequency})]})]}),(0,l.jsx)("div",{className:"text-[10px] font-bold text-slate-300 bg-white/50 px-2 py-1 rounded-lg backdrop-blur-sm",children:v.split("-").slice(1).reverse().join("/")})]},e.id)})})]})]}),(0,l.jsxs)("div",{className:"xl:col-span-4 space-y-8",children:[(0,l.jsxs)("div",{className:"relative group overflow-hidden rounded-[2rem] bg-gradient-to-br from-[#4f46e5] to-[#7c3aed] text-white p-8 shadow-2xl shadow-indigo-500/30",children:[(0,l.jsx)("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full blur-[50px] -mr-10 -mt-10 animate-pulse-slow"}),(0,l.jsxs)("div",{className:"relative z-10",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)(h.A,{size:20,className:"text-yellow-300"}),(0,l.jsx)("h3",{className:"text-lg font-bold tracking-wide",children:"AI Mentor Nhắn Nhủ"})]}),(0,l.jsxs)("div",{className:"text-lg font-medium leading-relaxed italic opacity-90",children:['"',(null==L?void 0:L.messageToStudent)||"Mỗi ng\xe0y tiến bộ 1 ch\xfat l\xe0 đủ.",'"']}),(0,l.jsx)("div",{className:"mt-8 pt-4 border-t border-white/20 flex items-center gap-2",children:(0,l.jsx)("span",{className:"text-[10px] uppercase font-bold tracking-wider opacity-60",children:"Insight by Gemini"})})]})]}),(0,l.jsx)(H,{leaderboardClass:(null==(t=i.dashboardStats)?void 0:t.leaderboardClass)||{},leaderboardGrade:(null==(s=i.dashboardStats)?void 0:s.leaderboardGrade)||{},currentMhs:i.mhs,month:D}),(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-white/60 p-6 rounded-3xl shadow-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)("div",{className:"p-2.5 bg-slate-100 text-slate-600 rounded-xl",children:(0,l.jsx)(m.A,{size:20})}),(0,l.jsx)("div",{className:"font-bold text-slate-800",children:"Kế hoạch 2 Tuần"})]}),(null==L||null==(n=L.studyPlan)?void 0:n.length)?(0,l.jsxs)("div",{className:"space-y-4",children:[R.slice(0,3).map(e=>{let[t,s]=e;return(0,l.jsxs)("div",{className:"relative pl-4 border-l-2 border-slate-100",children:[(0,l.jsx)("div",{className:"absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full bg-indigo-500 ring-4 ring-white"}),(0,l.jsx)("div",{className:"text-xs font-bold text-indigo-600 uppercase mb-2",children:t}),(0,l.jsx)("div",{className:"space-y-2",children:s.map((e,t)=>(0,l.jsxs)("div",{className:"text-sm text-slate-600 bg-slate-50 p-2 rounded-lg border border-slate-100",children:[(0,l.jsxs)("span",{className:"font-bold text-slate-800 mr-2",children:["[",e.subject,"]"]}),e.content]},t))})]},t)}),R.length>3&&(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("button",{className:"text-xs font-bold text-indigo-600 hover:underline",children:"Xem th\xeam..."})})]}):(0,l.jsx)("div",{className:"text-sm text-slate-400 italic text-center py-4",children:"Chưa c\xf3 kế hoạch."})]}),(null==(r=i.dashboardStats)?void 0:r.nextExamTargets)&&(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-white/60 p-6 rounded-3xl shadow-lg relative overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute top-0 left-0 w-2 h-full bg-gradient-to-b from-amber-400 to-orange-500"}),(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)("div",{className:"p-2.5 bg-orange-100 text-orange-600 rounded-xl",children:(0,l.jsx)(p.A,{size:20})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-bold text-slate-800",children:"Mục ti\xeau Tiếp theo"}),(0,l.jsx)("div",{className:"text-xs text-slate-500",children:"Next Exam Targets"})]})]}),(0,l.jsx)("div",{className:"grid grid-cols-3 gap-3",children:[{l:"To\xe1n",v:i.dashboardStats.nextExamTargets.math,c:"text-blue-600 bg-blue-50"},{l:"Văn",v:i.dashboardStats.nextExamTargets.lit,c:"text-pink-600 bg-pink-50"},{l:"Anh",v:i.dashboardStats.nextExamTargets.eng,c:"text-violet-600 bg-violet-50"}].map(e=>(0,l.jsxs)("div",{className:"".concat(e.c," p-3 rounded-2xl text-center flex flex-col items-center justify-center min-h-[80px]"),children:[(0,l.jsx)("span",{className:"text-[10px] font-bold uppercase opacity-60 mb-1",children:e.l}),(0,l.jsx)("span",{className:"text-2xl font-black tracking-tight",children:e.v})]},e.l))})]}),(0,l.jsx)(d,{})]})]})]})]})]})}var U=s(91169),K=s(86651),W=s(93341),V=s(21786),q=s(55867),J=s(65229);function X(){let[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(""),[r,i]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),[x,h]=(0,a.useState)("");(0,a.useEffect)(()=>{if(!e)return;let s=document.body.style.overflow;document.body.style.overflow="hidden";let l=e=>{"Escape"===e.key&&t(!1)};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l),document.body.style.overflow=s}},[e]);let m=()=>{t(!1),h(""),n(""),i(""),c(!1)},u=async()=>{if(h(""),!r.trim())return void h("Vui l\xf2ng nhập mật khẩu mới.");c(!0);try{let e=await fetch("/api/account/admin/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPassword:s,newPassword:r})}),t=await e.json().catch(()=>({}));if(!e.ok||!(null==t?void 0:t.ok))return void h((null==t?void 0:t.error)||"Đổi mật khẩu thất bại");h("✅ Đổi mật khẩu th\xe0nh c\xf4ng"),setTimeout(()=>m(),800)}finally{c(!1)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{type:"button",onClick:()=>t(!0),className:"flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-semibold rounded-xl",title:"Đổi mật khẩu Admin",children:[(0,l.jsx)(q.A,{size:16}),"Đổi MK Admin"]}),e&&(0,l.jsx)("div",{className:"fixed inset-0 z-[200] bg-slate-900/55 backdrop-blur-sm flex items-center justify-center p-4",onMouseDown:e=>{e.target===e.currentTarget&&m()},children:(0,l.jsxs)("div",{className:"bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden",children:[(0,l.jsxs)("div",{className:"p-5 border-b border-slate-100 flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-lg font-bold text-slate-800",children:"Đổi mật khẩu Admin"}),(0,l.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Nếu qu\xean mật khẩu: d\xf9ng luồng reset qua email."})]}),(0,l.jsx)("button",{type:"button",onClick:m,className:"p-2 rounded-xl hover:bg-slate-100 text-slate-500",title:"Đ\xf3ng",children:(0,l.jsx)(J.A,{size:18})})]}),(0,l.jsxs)("div",{className:"p-5 space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-slate-700 mb-1",children:"Mật khẩu cũ"}),(0,l.jsx)("input",{type:"password",value:s,onChange:e=>n(e.target.value),className:"w-full px-3 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"(nếu bạn c\xf3 d\xf9ng kiểm tra mật khẩu cũ)"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-slate-700 mb-1",children:"Mật khẩu mới"}),(0,l.jsx)("input",{type:"password",value:r,onChange:e=>i(e.target.value),className:"w-full px-3 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Nhập mật khẩu mới"})]}),x&&(0,l.jsx)("div",{className:"text-sm px-3 py-2 rounded-xl bg-slate-50 border border-slate-200 text-slate-700",children:x})]}),(0,l.jsxs)("div",{className:"p-5 border-t border-slate-100 flex justify-end gap-2 bg-white",children:[(0,l.jsx)("button",{type:"button",onClick:m,className:"px-4 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold",children:"Hủy"}),(0,l.jsxs)("button",{type:"button",onClick:u,disabled:d,className:"px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-semibold disabled:opacity-50 inline-flex items-center gap-2",children:[d?(0,l.jsx)(o.A,{size:18,className:"animate-spin"}):null,"Đổi mật khẩu"]})]})]})})]})}function Y(e){let{searchTerm:t,onSearchChange:s,filterClass:a,onFilterClassChange:n,uniqueClasses:r,sortTicks:i,onSortTicksChange:d,isTeacher:c,teacherClass:x,visibleStudents:m,onLogout:u,onBulkGenerate:p,onSyncSheet:g,onFileUpload:b,onAddStudent:f,isSyncing:j,isBulkProcessing:v}=e;return(0,l.jsx)("header",{className:"sticky top-0 z-30 px-6 py-4",children:(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-white/50 shadow-lg shadow-slate-200/30 rounded-[2rem] px-8 py-4 flex flex-col md:flex-row md:items-center justify-between gap-4 transition-all",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center text-white shadow-lg shadow-indigo-500/20",children:(0,l.jsx)(U.A,{size:24})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-slate-800 tracking-tight",children:"Quản l\xfd Học tập"}),c&&x&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,l.jsxs)("div",{className:"px-2 py-0.5 rounded-md bg-emerald-50 border border-emerald-100 text-xs font-bold text-emerald-700",children:["Lớp ",x]}),(0,l.jsxs)("div",{className:"text-xs text-slate-400 font-medium",children:["Sĩ số: ",(0,l.jsx)("span",{className:"text-slate-600",children:m.length})]})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,l.jsxs)("div",{className:"relative group",children:[(0,l.jsx)(K.A,{className:"absolute left-3 top-2.5 text-slate-400 group-focus-within:text-indigo-500 transition-colors",size:18}),(0,l.jsx)("input",{type:"text",placeholder:"T\xecm học sinh...",value:t,onChange:e=>s(e.target.value),className:"pl-10 pr-4 py-2 border border-slate-200/80 rounded-xl bg-slate-50/50 focus:bg-white focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 outline-none transition-all w-48 lg:w-64 text-sm"})]}),!c&&(0,l.jsx)("div",{className:"relative",children:(0,l.jsxs)("select",{className:"pl-3 pr-8 py-2 border border-slate-200/80 rounded-xl bg-slate-50/50 focus:bg-white outline-none text-sm appearance-none cursor-pointer",value:a,onChange:e=>n(e.target.value),children:[(0,l.jsx)("option",{value:"ALL",children:"Tất cả lớp"}),r.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("select",{className:"pl-3 pr-8 py-2 border border-slate-200/80 rounded-xl bg-slate-50/50 focus:bg-white outline-none text-sm appearance-none cursor-pointer",value:i,onChange:e=>d(e.target.value),children:[(0,l.jsx)("option",{value:"none",children:"Sắp xếp: Mặc định"}),(0,l.jsx)("option",{value:"desc",children:"Tick nhiều nhất"}),(0,l.jsx)("option",{value:"asc",children:"Tick \xedt nhất"})]}),(0,l.jsx)("div",{className:"absolute right-3 top-2.5 pointer-events-none text-slate-400",children:(0,l.jsx)(W.A,{size:14})})]}),(0,l.jsx)("div",{className:"w-px h-8 bg-slate-200 mx-1 hidden lg:block"}),!c&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{onClick:p,disabled:v,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-700 hover:to-indigo-700 text-white text-sm font-bold rounded-xl shadow-md hover:shadow-lg shadow-indigo-500/20 transform hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,l.jsx)(h.A,{size:16}),(0,l.jsx)("span",{className:"hidden xl:inline",children:"AI H\xe0ng loạt"})]}),(0,l.jsxs)("button",{onClick:g,disabled:j||v,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-bold rounded-xl shadow-md shadow-emerald-500/20 transform hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Đồng bộ Sheet",children:[j?(0,l.jsx)(o.A,{className:"animate-spin",size:16}):(0,l.jsx)(V.A,{size:16}),(0,l.jsx)("span",{className:"hidden xl:inline",children:"Đồng bộ"})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-900 text-white text-sm font-bold rounded-xl cursor-pointer shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all",children:[(0,l.jsx)(V.A,{size:16}),(0,l.jsx)("span",{className:"hidden xl:inline",children:"Excel"}),(0,l.jsx)("input",{type:"file",accept:".xlsx,.xls",className:"hidden",onChange:b})]}),f&&(0,l.jsxs)("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white text-sm font-bold rounded-xl shadow-md hover:shadow-lg shadow-pink-500/20 transform hover:-translate-y-0.5 transition-all",children:[(0,l.jsx)(U.A,{size:16}),(0,l.jsx)("span",{className:"hidden xl:inline",children:"Th\xeam HS"})]})]}),(0,l.jsx)(X,{}),(0,l.jsx)("button",{onClick:u,className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all",title:"Đăng xuất",children:(0,l.jsx)(A.A,{size:20})})]})]})})}function Q(e){let{progress:t}=e;return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center",children:(0,l.jsxs)("div",{className:"bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center animate-in fade-in zoom-in duration-300",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse",children:(0,l.jsx)(h.A,{size:32})}),(0,l.jsx)("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Đang ph\xe2n t\xedch dữ liệu..."}),(0,l.jsxs)("p",{className:"text-slate-500 mb-6",children:["Đang xử l\xfd: ",(0,l.jsx)("span",{className:"font-bold text-indigo-600",children:t.currentName})]}),(0,l.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-4 mb-2 overflow-hidden",children:(0,l.jsx)("div",{className:"bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out",style:{width:"".concat(t.current/t.total*100,"%")}})}),(0,l.jsxs)("div",{className:"flex justify-between text-xs font-semibold text-slate-400 uppercase tracking-wider",children:[(0,l.jsx)("span",{children:"Tiến độ"}),(0,l.jsxs)("span",{children:[t.current," / ",t.total]})]}),(0,l.jsx)("p",{className:"text-xs text-slate-400 mt-4 italic",children:"Vui l\xf2ng kh\xf4ng tắt tr\xecnh duyệt..."})]})}):null}function $(e){let{isOpen:t,onClose:s,syncHint:a,syncMonthSearch:n,onSyncMonthSearchChange:r,syncMonthsAll:i,syncSelectedMonths:d,onToggleMonth:c,onSelectAll:x,onClearAll:h,onSubmit:m,isSyncing:p,isTeacher:g}=e;if(!t||g)return null;let b=(()=>{let e=n.trim().toLowerCase();return e?i.filter(t=>t.toLowerCase().includes(e)):i})();return(0,l.jsx)("div",{className:"fixed inset-0 bg-slate-900/55 backdrop-blur-sm z-[120] flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden",children:[(0,l.jsxs)("div",{className:"p-6 border-b border-slate-100 flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-lg font-bold text-slate-800",children:"Chọn th\xe1ng để đồng bộ"}),(0,l.jsx)("div",{className:"text-sm text-slate-500 mt-1",children:a||"Chọn 1 hoặc nhiều th\xe1ng để đồng bộ lại điểm từ Google Sheet."})]}),(0,l.jsx)("button",{onClick:s,className:"p-2 rounded-xl hover:bg-slate-100 text-slate-500",title:"Đ\xf3ng",type:"button",children:(0,l.jsx)(J.A,{size:20})})]}),(0,l.jsxs)("div",{className:"p-6 space-y-4",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[(0,l.jsxs)("div",{className:"flex-1 relative",children:[(0,l.jsx)(K.A,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),(0,l.jsx)("input",{value:n,onChange:e=>r(e.target.value),placeholder:"T\xecm th\xe1ng (vd: 2025-10)...",className:"w-full pl-10 pr-3 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-emerald-500 outline-none text-sm"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:x,className:"px-3 py-2 text-sm font-semibold rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700",type:"button",children:"Chọn tất cả"}),(0,l.jsx)("button",{onClick:h,className:"px-3 py-2 text-sm font-semibold rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700",type:"button",children:"Bỏ chọn"})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[Array.from(d).sort().slice(0,12).map(e=>(0,l.jsxs)("button",{type:"button",onClick:()=>c(e),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold bg-emerald-50 text-emerald-700 border border-emerald-100 hover:bg-emerald-100",title:"Bỏ chọn",children:[e,(0,l.jsx)(J.A,{size:14})]},e)),d.size>12&&(0,l.jsxs)("span",{className:"text-xs text-slate-500 px-2 py-1.5",children:["+",d.size-12," th\xe1ng nữa"]})]}),(0,l.jsx)("div",{className:"border border-slate-200 rounded-2xl overflow-hidden",children:(0,l.jsx)("div",{className:"max-h-[320px] overflow-y-auto p-3 bg-slate-50",children:(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:b.map(e=>{let t=d.has(e);return(0,l.jsxs)("button",{type:"button",onClick:()=>c(e),className:"flex items-center justify-between px-3 py-2 rounded-xl border text-sm font-semibold transition-all ".concat(t?"bg-white border-emerald-200 text-emerald-700 shadow-sm":"bg-white/70 border-slate-200 text-slate-700 hover:bg-white"),children:[(0,l.jsx)("span",{children:e}),(0,l.jsx)("span",{className:"w-5 h-5 rounded-md border flex items-center justify-center ".concat(t?"bg-emerald-600 border-emerald-600":"bg-white border-slate-300"),children:t&&(0,l.jsx)(u.A,{size:14,className:"text-white"})})]},e)})})})}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:["Đ\xe3 chọn: ",(0,l.jsx)("span",{className:"font-bold text-slate-700",children:d.size})," / ",i.length," ","th\xe1ng"]})]}),(0,l.jsxs)("div",{className:"p-6 border-t border-slate-100 flex justify-end gap-2 bg-white",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold",children:"Hủy"}),(0,l.jsxs)("button",{type:"button",onClick:m,disabled:p,className:"px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[p?(0,l.jsx)(o.A,{size:18,className:"animate-spin"}):(0,l.jsx)(V.A,{size:18}),"Đồng bộ th\xe1ng đ\xe3 chọn"]})]})]})})}var Z=s(52056),ee=s(89715),et=s(37772),es=s(48314);function el(e){let{mhs:t}=e,[s,n]=(0,a.useState)(!1),r=async()=>{if(confirm("Reset mật khẩu HS ".concat(t," về DEFAULT_PASSWORD?"))){n(!0);try{let e=await fetch("/api/account/reset-password",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({mhs:t})}),s=await e.json().catch(()=>({}));if(!e.ok||!(null==s?void 0:s.ok))return alert((null==s?void 0:s.error)||"Reset thất bại");alert("Reset OK (NEW_PASSWORD đ\xe3 x\xf3a, quay về DEFAULT_PASSWORD)")}catch(e){alert((null==e?void 0:e.message)||"Network error")}finally{n(!1)}}};return(0,l.jsxs)("button",{onClick:r,disabled:s,className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold disabled:opacity-50",title:"Reset về mật khẩu mặc định",children:[s?(0,l.jsx)(o.A,{className:"animate-spin",size:14}):(0,l.jsx)(es.A,{size:14}),"Reset MK"]})}function ea(e){return/^\d{4}-\d{2}$/.test(String(e||"").trim())}function en(e){return e.toISOString().slice(0,7)}function er(e){return function(e){let t=String(e||"").trim();if(!ea(t))return en(new Date);let[s,l]=t.split("-"),a=parseInt(s,10),n=parseInt(l,10);return 13===(n+=1)&&(n=1,a+=1),"".concat(String(a).padStart(4,"0"),"-").concat(String(n).padStart(2,"0"))}(function(e){let t=Array.isArray(null==e?void 0:e.scores)?e.scores:[],s=t.length?t[t.length-1]:null,l=String((null==s?void 0:s.month)||"").trim();return ea(l)?l:en(new Date)}(e))}function ei(e){let{students:t,selectedMhs:s,isTeacher:a,onSelectAll:n,onSelectStudent:r,sortTicks:i,onSortTicks:d,onGenerateAI:x,onViewStudent:m,loadingMhs:u,onStudentAction:p}=e;return(0,l.jsx)("div",{className:"bg-white/70 backdrop-blur-xl border border-white/50 rounded-[2rem] shadow-[0_8px_30px_rgb(0,0,0,0.04)] overflow-hidden",children:(0,l.jsx)("div",{className:"overflow-x-auto custom-scrollbar",children:(0,l.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-slate-50/50 border-b border-slate-200/60 text-xs uppercase text-slate-500 font-bold tracking-wider",children:[(0,l.jsx)("th",{className:"px-6 py-5 w-10",children:(0,l.jsx)("input",{type:"checkbox",disabled:a,checked:!a&&t.length>0&&t.every(e=>s.has(e.mhs)),onChange:e=>n(e.target.checked),title:a?"Gi\xe1o vi\xean kh\xf4ng d\xf9ng chọn h\xe0ng loạt":"Chọn/Bỏ chọn tất cả học sinh đang hiển thị",className:"rounded-md border-slate-300 text-indigo-600 focus:ring-indigo-500"})}),(0,l.jsx)("th",{className:"px-6 py-5",children:(0,l.jsx)("div",{className:"flex items-center gap-2",children:"MHS"})}),(0,l.jsx)("th",{className:"px-6 py-5 w-[90px] text-center",children:"MK"}),(0,l.jsx)("th",{className:"px-6 py-5",children:"Họ v\xe0 T\xean"}),(0,l.jsx)("th",{className:"px-6 py-5",children:"Lớp"}),(0,l.jsx)("th",{className:"px-6 py-5",children:(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(c.A,{size:14}),"Điểm TB"]})}),(0,l.jsx)("th",{className:"px-6 py-5",children:"Rủi ro"}),(0,l.jsx)("th",{className:"px-6 py-5 cursor-pointer hover:bg-white/50 transition-colors group select-none",onClick:d,children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:["Tiến độ Tick","desc"===i&&(0,l.jsx)("span",{className:"text-indigo-600",children:"↓"}),"asc"===i&&(0,l.jsx)("span",{className:"text-indigo-600",children:"↑"}),"none"===i&&(0,l.jsx)("span",{className:"text-slate-300 group-hover:text-slate-400",children:"↕"})]})}),(0,l.jsx)("th",{className:"px-6 py-5 text-right",children:"H\xe0nh động"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-100/60",children:0===t.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:9,className:"px-6 py-20 text-center text-slate-400 italic",children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center",children:(0,l.jsx)(Z.A,{size:24,className:"text-slate-300"})}),(0,l.jsx)("div",{children:a?"Chưa c\xf3 học sinh trong lớp phụ tr\xe1ch.":"Kh\xf4ng t\xecm thấy học sinh n\xe0o. H\xe3y nhập Excel hoặc Đồng bộ Sheet."})]})})}):t.map(e=>{var t,n,i,d,c;let g=null==(t=e.scores)?void 0:t[e.scores.length-1],b=[null==g?void 0:g.math,null==g?void 0:g.lit,null==g?void 0:g.eng].filter(e=>null!=e),f=b.length>0?(b.reduce((e,t)=>e+t,0)/b.length).toFixed(1):"N/A",j=er(e),v=function(e){if(!e)return{};let t=null==e?void 0:e.actionsByMonth;return t&&"object"==typeof t?t:{[er(e)]:Array.isArray(null==e?void 0:e.activeActions)?e.activeActions:[]}}(e),N=Array.isArray(null==e||null==(n=e.actionsByMonth)?void 0:n[j])?e.actionsByMonth[j]:Array.isArray(null==v?void 0:v[j])?v[j]:Array.isArray(e.activeActions)?e.activeActions:[],y=N.reduce((e,t)=>e+(Array.isArray(null==t?void 0:t.ticks)?t.ticks:[]).filter(e=>(null==e?void 0:e.completed)&&String((null==e?void 0:e.date)||"").slice(0,7)===j).length,0);return(0,l.jsxs)("tr",{className:"hover:bg-indigo-50/40 transition-colors duration-200 group",children:[(0,l.jsx)("td",{className:"px-6 py-5",children:(0,l.jsx)("input",{type:"checkbox",disabled:a,checked:!a&&s.has(e.mhs),onChange:t=>r(e.mhs,t.target.checked),className:"rounded-md border-slate-300 text-indigo-600 focus:ring-indigo-500"})}),(0,l.jsx)("td",{className:"px-6 py-5 text-sm font-mono text-slate-500 font-medium",children:e.mhs}),(0,l.jsx)("td",{className:"px-6 py-5 text-center",children:(0,l.jsx)(el,{mhs:e.mhs})}),(0,l.jsxs)("td",{className:"px-6 py-5 text-sm font-bold text-slate-700",children:[e.name,g&&(0,l.jsx)("div",{className:"text-[10px] text-slate-400 font-normal mt-0.5",children:g.month})]}),(0,l.jsx)("td",{className:"px-6 py-5 text-sm text-slate-600",children:(0,l.jsx)("span",{className:"bg-slate-100 px-2 py-1 rounded-md text-xs font-semibold",children:e.class})}),(0,l.jsx)("td",{className:"px-6 py-5 text-sm text-slate-600",children:"N/A"!==f?(0,l.jsx)("div",{className:"flex items-center gap-2 cursor-help",title:"To\xe1n: ".concat(null!=(i=null==g?void 0:g.math)?i:"-"," | Văn: ").concat(null!=(d=null==g?void 0:g.lit)?d:"-"," | Anh: ").concat(null!=(c=null==g?void 0:g.eng)?c:"-"),children:(0,l.jsx)("span",{className:"w-8 h-8 flex items-center justify-center rounded-lg font-bold text-xs shadow-sm bg-gradient-to-br ".concat(Number(f)>=8?"from-emerald-400 to-emerald-600 text-white":Number(f)>=5?"from-amber-400 to-amber-600 text-white":"from-rose-400 to-rose-600 text-white"),children:f})}):(0,l.jsx)("span",{className:"text-slate-300 text-xs italic",children:"N/A"})}),(0,l.jsx)("td",{className:"px-6 py-5",children:e.aiReport?(0,l.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide border shadow-sm ".concat("Cao"===e.aiReport.riskLevel?"bg-rose-50 text-rose-600 border-rose-100":"Trung b\xecnh"===e.aiReport.riskLevel?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100"),children:["Cao"===e.aiReport.riskLevel&&(0,l.jsx)(Z.A,{size:12}),e.aiReport.riskLevel]}):(0,l.jsx)("span",{className:"text-slate-300 text-xs italic",children:"--"})}),(0,l.jsx)("td",{className:"px-6 py-5 text-sm text-slate-600",children:N.length>0?(0,l.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-2.5 max-w-[100px] shadow-inner overflow-hidden",title:"".concat(y," tick ho\xe0n th\xe0nh"),children:(0,l.jsx)("div",{className:"bg-indigo-500 h-full rounded-full transition-all duration-700 ease-out shimmer",style:{width:"".concat(Math.min(5*y,100),"%")}})}):(0,l.jsx)("span",{className:"text-slate-400 text-xs",children:"-"})}),(0,l.jsx)("td",{className:"px-6 py-5 text-right",children:(0,l.jsxs)("div",{className:"flex items-center justify-end gap-2 opacity-60 group-hover:opacity-100 transition-all",children:[u===e.mhs?(0,l.jsx)("button",{disabled:!0,className:"px-3 py-2 bg-indigo-50 text-indigo-600 rounded-xl text-xs font-bold flex items-center gap-2",type:"button",children:(0,l.jsx)(o.A,{size:14,className:"animate-spin"})}):(0,l.jsxs)("button",{onClick:()=>x(e),className:"px-3 py-2 bg-white/50 border border-slate-200 hover:bg-indigo-600 hover:text-white hover:border-indigo-600 text-slate-600 rounded-xl text-xs font-bold transition-all shadow-sm hover:shadow-lg hover:-translate-y-0.5 flex items-center gap-1",type:"button",title:"Tạo b\xe1o c\xe1o AI",children:[(0,l.jsx)(h.A,{size:14}),e.aiReport?"Tạo lại":"Tạo AI"]}),(0,l.jsx)("button",{onClick:()=>m(e.mhs),className:"p-2 bg-white/50 border border-slate-200 text-slate-500 hover:text-indigo-600 hover:border-indigo-200 hover:bg-indigo-50 rounded-xl transition-all shadow-sm hover:shadow-lg hover:-translate-y-0.5",title:"Xem chi tiết",type:"button",children:(0,l.jsx)(ee.A,{size:18})}),p&&!a&&(0,l.jsx)("button",{onClick:()=>p(e.mhs),className:"p-2 bg-white/50 border border-slate-200 text-slate-500 hover:text-amber-600 hover:border-amber-200 hover:bg-amber-50 rounded-xl transition-all shadow-sm hover:shadow-lg hover:-translate-y-0.5",title:"Quản l\xfd HS",type:"button",children:(0,l.jsx)(et.A,{size:18})})]})})]},e.mhs)})})]})})})}var eo=s(80534),ed=s(50906),ec=s(21190),ex=s(46046);function eh(e){return e.toISOString().slice(0,10)}function em(e){return e.toISOString().slice(0,7)}function eu(e){return/^\d{4}-\d{2}$/.test(String(e||"").trim())}function ep(e){let t=String(e||"").trim();if(!eu(t))return em(new Date);let[s,l]=t.split("-"),a=parseInt(s,10),n=parseInt(l,10);return 13===(n+=1)&&(n=1,a+=1),"".concat(String(a).padStart(4,"0"),"-").concat(String(n).padStart(2,"0"))}function eg(e){return ep(function(e){let t=Array.isArray(null==e?void 0:e.scores)?e.scores:[],s=t.length?t[t.length-1]:null,l=String((null==s?void 0:s.month)||"").trim();return eu(l)?l:em(new Date)}(e))}function eb(e){let t=new Set;((null==e?void 0:e.scores)||[]).forEach(e=>{let s=String((null==e?void 0:e.month)||"").trim();eu(s)&&(t.add(s),t.add(ep(s)))});let s=null==e?void 0:e.actionsByMonth;s&&"object"==typeof s&&Object.keys(s).forEach(e=>{eu(e)&&t.add(e)}),e&&t.add(eg(e));let l=Array.from(t);return l.sort(),l}function ef(e){if(!e)return{};let t=null==e?void 0:e.actionsByMonth;return t&&"object"==typeof t?t:{[eg(e)]:Array.isArray(null==e?void 0:e.activeActions)?e.activeActions:[]}}function ej(e){var t,s,n;let{student:r,students:i,onClose:o,onUpdateReport:d,persistReport:c}=e,[x,h]=(0,a.useState)("report"),[p,g]=(0,a.useState)(!1),[b,f]=(0,a.useState)({overview:(null==(t=r.aiReport)?void 0:t.overview)||"",messageToStudent:(null==(s=r.aiReport)?void 0:s.messageToStudent)||"",teacherNotes:(null==(n=r.aiReport)?void 0:n.teacherNotes)||""}),[j,v]=(0,a.useState)("7"),[N,y]=(0,a.useState)(em(new Date));(0,a.useEffect)(()=>{let e=eb(r),t=eg(r);e.length&&e[e.length-1],y(t)},[r.mhs]),(0,a.useEffect)(()=>{r.aiReport&&f({overview:r.aiReport.overview,messageToStudent:r.aiReport.messageToStudent,teacherNotes:r.aiReport.teacherNotes})},[r.aiReport]);let w=async()=>{if(!r.aiReport)return;let e={...r.aiReport,overview:b.overview,messageToStudent:b.messageToStudent,teacherNotes:b.teacherNotes},t=ef(r)[eg(r)]||[];try{let s=eg(r);await c(r.mhs,e,t,s),d(r.mhs,e,t),g(!1)}catch(e){alert("Lỗi lưu: "+e.message)}},S=eg(r),A="month"===j?N:S,C=(0,a.useMemo)(()=>{let e=ef(r)[A];return Array.isArray(e)?e:Array.isArray(r.activeActions)?r.activeActions:[]},[r,A]),T=(0,a.useMemo)(()=>{if("month"===j)return function(e){let[t,s]=e.split("-").map(e=>parseInt(e,10));if(!t||!s)return[];let l=new Date(Date.UTC(t,s-1,1)),a=new Date(Date.UTC(t,s,0)),n=[],r=new Date(l);for(;r<=a;)n.push(eh(r)),r.setUTCDate(r.getUTCDate()+1);return n}(N);var e="7"===j?7:"30"===j?30:90;let t=[];for(let s=e-1;s>=0;s--){let e=new Date;e.setDate(e.getDate()-s),t.push(eh(e))}return t},[j,N]),D=(0,a.useMemo)(()=>"month"===j?"Tiến độ (Th\xe1ng ".concat(N,") • Nhiệm vụ T.").concat(N):"Tiến độ (".concat(j," ng\xe0y qua) • Nhiệm vụ T.").concat(A),[j,N,A]),M=(0,a.useMemo)(()=>r.scores||[],[r.scores]);return(0,l.jsx)("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-300",children:(0,l.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-slate-100 bg-white z-10",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:r.name}),(0,l.jsxs)("p",{className:"text-sm text-slate-500 mt-1",children:["MHS: ",(0,l.jsx)("span",{className:"font-mono text-indigo-600",children:r.mhs})," | Lớp: ",r.class]})]}),(0,l.jsx)("button",{onClick:o,className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-colors",children:(0,l.jsx)(J.A,{size:24})})]}),(0,l.jsxs)("div",{className:"flex border-b border-slate-100 px-6",children:[(0,l.jsx)(ev,{label:"B\xe1o c\xe1o AI",icon:(0,l.jsx)(eo.A,{size:16}),active:"report"===x,onClick:()=>h("report")}),(0,l.jsx)(ev,{label:"Theo d\xf5i Th\xf3i quen",icon:(0,l.jsx)(m.A,{size:16}),active:"tracking"===x,onClick:()=>h("tracking")}),(0,l.jsx)(ev,{label:"Biểu đồ Điểm",icon:(0,l.jsx)(ed.A,{size:16}),active:"score"===x,onClick:()=>h("score")})]}),(0,l.jsxs)("div",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar bg-[#fcfcfc] flex-1",children:["report"===x&&(r.aiReport?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"flex justify-end",children:p?(0,l.jsxs)("button",{onClick:w,className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-500 text-white rounded-lg text-xs font-semibold hover:bg-emerald-600",children:[(0,l.jsx)(ex.A,{size:14})," Lưu"]}):(0,l.jsxs)("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-xs font-semibold hover:bg-slate-200",children:[(0,l.jsx)(ec.A,{size:14})," Sửa nội dung"]})}),(0,l.jsxs)("div",{className:"p-5 rounded-2xl border ".concat("Cao"===r.aiReport.riskLevel?"border-red-200 bg-red-50/50":"border-emerald-200 bg-emerald-50/50"),children:[(0,l.jsx)("h3",{className:"font-bold text-sm uppercase tracking-wide mb-3",children:"Đ\xe1nh gi\xe1 Tổng quan"}),p?(0,l.jsx)("textarea",{className:"w-full p-3 border rounded-xl",rows:3,value:b.overview,onChange:e=>f({...b,overview:e.target.value})}):(0,l.jsx)("p",{className:"text-sm text-slate-800",children:r.aiReport.overview})]}),(0,l.jsxs)("div",{className:"bg-indigo-50/50 p-5 rounded-2xl border border-indigo-100",children:[(0,l.jsx)("h3",{className:"font-bold text-sm uppercase tracking-wide text-indigo-700 mb-3",children:"Lời nhắn cho Học sinh"}),p?(0,l.jsx)("textarea",{className:"w-full p-3 border rounded-xl",rows:3,value:b.messageToStudent,onChange:e=>f({...b,messageToStudent:e.target.value})}):(0,l.jsxs)("p",{className:"text-sm text-indigo-900 italic",children:['"',r.aiReport.messageToStudent,'"']})]}),(0,l.jsxs)("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 shadow-sm",children:[(0,l.jsx)("h3",{className:"font-bold text-sm uppercase tracking-wide text-slate-600 mb-3 flex items-center gap-2",children:"Ghi ch\xfa Ri\xeang tư (GV)"}),p?(0,l.jsx)("textarea",{className:"w-full p-3 border rounded-xl bg-slate-50",rows:3,value:b.teacherNotes,onChange:e=>f({...b,teacherNotes:e.target.value})}):(0,l.jsx)("p",{className:"text-sm text-slate-600",children:r.aiReport.teacherNotes})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-bold text-sm uppercase tracking-wide text-slate-600 mb-3 ml-1",children:"Kế hoạch Học tập"}),(0,l.jsx)("div",{className:"text-sm text-slate-600 bg-white border border-slate-100 rounded-2xl shadow-sm divide-y divide-slate-50",children:(r.aiReport.studyPlan||[]).map((e,t)=>(0,l.jsxs)("div",{className:"p-4 grid grid-cols-4 gap-4",children:[(0,l.jsx)("span",{className:"font-bold text-slate-400 text-xs uppercase pt-1",children:e.day}),(0,l.jsx)("span",{className:"text-indigo-600 font-semibold",children:e.subject}),(0,l.jsx)("span",{className:"col-span-2 text-slate-700",children:e.content})]},t))})]})]}):(0,l.jsx)("div",{className:"text-center py-12 text-slate-400",children:"Chưa c\xf3 b\xe1o c\xe1o AI."})),"score"===x&&(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(k,{data:M,stats:{classAvg:0,gradeAvg:0,avgScore:0,targetScore:0,leaderboardClass:{},leaderboardGrade:{},gradeAvgSubjectsByMonth:{}}})}),"tracking"===x&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6",children:[(0,l.jsx)("h3",{className:"font-bold text-slate-800",children:D}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"flex items-center gap-1 bg-white border border-slate-200 rounded-xl p-1 shadow-sm",children:["7","30","90","month"].map(e=>(0,l.jsx)("button",{onClick:()=>v(e),className:"px-3 py-1.5 text-xs font-bold rounded-lg ".concat(j===e?"bg-indigo-600 text-white":"text-slate-600 hover:bg-slate-100"),children:"month"===e?"Theo th\xe1ng":"".concat(e," ng\xe0y")},e))}),"month"===j&&(0,l.jsx)("select",{value:N,onChange:e=>y(e.target.value),className:"ml-1 px-3 py-2 text-sm rounded-xl border border-slate-200 bg-white shadow-sm outline-none",children:eb(r).slice().sort().reverse().map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]})]}),0===C.length?(0,l.jsx)("div",{className:"text-center py-10 text-slate-500 italic bg-slate-50 rounded-xl border border-dashed border-slate-200",children:"Th\xe1ng n\xe0y chưa c\xf3 nhiệm vụ n\xe0o."}):(0,l.jsx)("div",{className:"space-y-6",children:C.map(e=>{let t=function(e){let t=new Map;return((null==e?void 0:e.ticks)||[]).forEach(e=>t.set(String(null==e?void 0:e.date),!!(null==e?void 0:e.completed))),t}(e),s=T.reduce((e,s)=>e+ +!!t.get(s),0);return(0,l.jsxs)("div",{className:"bg-white border border-slate-100 rounded-2xl p-5 shadow-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold text-slate-700",children:e.description}),(0,l.jsx)("span",{className:"text-xs font-medium text-slate-400 bg-slate-100 px-2 py-0.5 rounded mt-1 inline-block",children:e.frequency})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("span",{className:"text-2xl font-bold text-indigo-600",children:s}),(0,l.jsx)("p",{className:"text-[10px] text-slate-400 uppercase tracking-wide font-bold",children:"Tick"})]})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsx)("div",{className:"min-w-[700px] flex items-center justify-between gap-2",children:T.map(e=>{let s=!!t.get(e),a=new Date(e),n="".concat(a.getDate(),"/").concat(a.getMonth()+1);return(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1",children:[(0,l.jsx)("div",{className:"w-full h-2 rounded-full transition-all ".concat(s?"bg-emerald-500":"bg-slate-100")}),(0,l.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-medium ".concat(s?"bg-emerald-100 text-emerald-700":"bg-slate-50 text-slate-400 border border-slate-100"),title:e,children:s?(0,l.jsx)(u.A,{size:16}):(0,l.jsx)("span",{className:"text-[10px]",children:n})})]},e)})})})]},e.id)})})]})]})]})})}function ev(e){let{label:t,icon:s,active:a,onClick:n}=e;return(0,l.jsx)("button",{onClick:n,className:"py-3 px-4 text-sm font-semibold border-b-2 transition-colors ".concat(a?"border-indigo-600 text-indigo-600":"border-transparent text-slate-500 hover:text-slate-700"),children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[s," ",t]})})}var eN=s(6132),ey=s(98128),ew=s(14989),eS=s(69386);function ek(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return"".concat(t,"-").concat(s)}function eA(e){let{students:t,teacherClass:s}=e,[n,r]=(0,a.useState)(ek(new Date)),i=(0,a.useMemo)(()=>{let e=new Set,s=new Date;e.add(ek(s));let l=new Date(s.getFullYear(),s.getMonth()-1,1);return e.add(ek(l)),t.forEach(t=>{var s;return null==(s=t.scores)?void 0:s.forEach(t=>e.add(t.month))}),Array.from(e).sort().reverse()},[t]),o=(0,a.useMemo)(()=>{let e=[];t.forEach(t=>{var s,l,a,r,i,o;let d=t.scores.find(e=>e.month===n);if(!d)return;let c=null!=(s=d.math)?s:0,x=null!=(l=d.lit)?l:0,h=null!=(a=d.eng)?a:0,m=(c+x+h)/3,u=[],p=null;m<4&&m>0?(p="DANGER",u.push("TB < 4.0 (".concat(m.toFixed(1),")"))):m>=4&&m<5&&(p=p||"WARNING",u.push("TB thấp (".concat(m.toFixed(1),")")));let g=t.scores.findIndex(e=>e.month===n);if(g>0){let e=t.scores[g-1],s=((null!=(r=e.math)?r:0)+(null!=(i=e.lit)?i:0)+(null!=(o=e.eng)?o:0))/3;s-m>1.5&&(p=p||"WARNING",u.push("Tụt điểm (-".concat((s-m).toFixed(1),")")))}if(c>0&&c<5||x>0&&x<5||h>0&&h<5){p||(p="NOTICE");let e=[];c>0&&c<5&&e.push("To\xe1n: ".concat(c)),x>0&&x<5&&e.push("Văn: ".concat(x)),h>0&&h<5&&e.push("Anh: ".concat(h)),e.length&&u.push(e.join(", "))}p&&u.length&&e.push({student:t,avgScore:m,level:p,reasons:u})});let s={DANGER:0,WARNING:1,NOTICE:2};return e.sort((e,t)=>s[e.level]-s[t.level]||e.avgScore-t.avgScore)},[t,n]),d=(0,a.useMemo)(()=>{let e=[];return t.forEach(t=>{var s,l,a,r,i,o;let d=t.scores.findIndex(e=>e.month===n);if(d<=0)return;let c=t.scores[d],x=t.scores[d-1],h=((null!=(s=c.math)?s:0)+(null!=(l=c.lit)?l:0)+(null!=(a=c.eng)?a:0))/3,m=((null!=(r=x.math)?r:0)+(null!=(i=x.lit)?i:0)+(null!=(o=x.eng)?o:0))/3;m>0&&e.push({student:t,delta:h-m,prevAvg:m,currAvg:h})}),e.sort((e,t)=>t.delta-e.delta).slice(0,5)},[t,n]),x=(0,a.useMemo)(()=>{let e=[],s=[],l=[];t.forEach(t=>{let a=t.scores.find(e=>e.month===n);a&&("number"==typeof a.math&&e.push(a.math),"number"==typeof a.lit&&s.push(a.lit),"number"==typeof a.eng&&l.push(a.eng))});let a=e=>e.length?e.reduce((e,t)=>e+t,0)/e.length:0,r=e=>e>=7.5?"bg-emerald-500 text-white":e>=5?"bg-yellow-400 text-slate-800":"bg-red-500 text-white";return[{subject:"To\xe1n",avg:parseFloat(a(e).toFixed(1)),color:r(a(e))},{subject:"Văn",avg:parseFloat(a(s).toFixed(1)),color:r(a(s))},{subject:"Anh",avg:parseFloat(a(l).toFixed(1)),color:r(a(l))}]},[t,n]),h=(0,a.useMemo)(()=>x.map(e=>({name:e.subject,avgScore:e.avg,fill:e.avg>=7.5?"#10b981":e.avg>=5?"#eab308":"#ef4444"})),[x]);return(0,l.jsxs)("div",{className:"space-y-6 animate-in fade-in",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 bg-white/80 backdrop-blur-xl p-4 rounded-2xl border border-white/60 shadow-lg",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"text-xl font-bold text-slate-800",children:["\uD83D\uDCCA B\xe1o c\xe1o Lớp ",s]}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"Ph\xe2n t\xedch học lực v\xe0 tiến bộ của học sinh"})]}),(0,l.jsxs)("select",{value:n,onChange:e=>r(e.target.value),className:"border border-slate-200 rounded-lg px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500 bg-white shadow-sm",children:[i.map(e=>(0,l.jsx)("option",{value:e,children:e},e)),0===i.length&&(0,l.jsx)("option",{value:ek(new Date),children:ek(new Date)})]})]}),(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl p-6 rounded-2xl border-2 border-red-200 shadow-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,l.jsx)(eN.A,{className:"text-red-600",size:24}),(0,l.jsxs)("h3",{className:"text-lg font-bold text-red-800",children:["\uD83D\uDEA8 Cảnh b\xe1o Học lực (Th\xe1ng ",n,")"]})]}),(0,l.jsx)("div",{className:"overflow-y-auto max-h-[300px]",children:(0,l.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,l.jsx)("thead",{className:"bg-red-50 text-red-900 sticky top-0",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-3 rounded-tl-lg",children:"Học sinh"}),(0,l.jsx)("th",{className:"p-3",children:"Điểm TB"}),(0,l.jsx)("th",{className:"p-3",children:"Mức độ"}),(0,l.jsx)("th",{className:"p-3 rounded-tr-lg",children:"L\xfd do"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-100",children:0===o.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:4,className:"p-4 text-center text-slate-500",children:"✅ Kh\xf4ng c\xf3 học sinh n\xe0o trong mức cảnh b\xe1o."})}):o.map((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,l.jsx)("td",{className:"p-3 font-medium",children:e.student.name}),(0,l.jsx)("td",{className:"p-3 font-bold",children:e.avgScore.toFixed(1)}),(0,l.jsx)("td",{className:"p-3",children:(0,l.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("DANGER"===e.level?"bg-red-600 text-white":"WARNING"===e.level?"bg-orange-500 text-white":"bg-yellow-400 text-slate-800"),children:"DANGER"===e.level?"\uD83D\uDD34 Nguy hiểm":"WARNING"===e.level?"\uD83D\uDFE0 Theo d\xf5i":"\uD83D\uDFE1 Ch\xfa \xfd"})}),(0,l.jsx)("td",{className:"p-3 text-xs text-slate-600",children:e.reasons.join(" \xb7 ")})]},t))})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl p-6 rounded-2xl border border-slate-200 shadow-lg",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-700 mb-4",children:"\uD83D\uDCDA Điểm TB theo M\xf4n"}),(0,l.jsx)("div",{className:"flex justify-center gap-4 mb-4",children:x.map(e=>(0,l.jsxs)("div",{className:"".concat(e.color," rounded-2xl p-4 text-center min-w-[80px]"),children:[(0,l.jsx)("div",{className:"text-xs font-bold opacity-80 uppercase mb-1",children:e.subject}),(0,l.jsx)("div",{className:"text-3xl font-black",children:e.avg>0?e.avg:"-"})]},e.subject))}),(0,l.jsx)("div",{className:"h-[200px] w-full",children:(0,l.jsx)(g.u,{width:"100%",height:"100%",children:(0,l.jsxs)(ey.E,{data:h,layout:"vertical",margin:{top:10,right:20,left:0,bottom:0},children:[(0,l.jsx)(f.d,{strokeDasharray:"3 3",horizontal:!0,vertical:!1}),(0,l.jsx)(j.W,{type:"number",domain:[0,10],axisLine:!1,tickLine:!1}),(0,l.jsx)(v.h,{type:"category",dataKey:"name",axisLine:!1,tickLine:!1,width:40}),(0,l.jsx)(N.m,{}),(0,l.jsx)(ew.yP,{dataKey:"avgScore",radius:[0,8,8,0],barSize:30,children:h.map((e,t)=>(0,l.jsx)(eS.f,{fill:e.fill},"cell-".concat(t)))})]})})})]}),(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl p-6 rounded-2xl border border-emerald-200 shadow-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,l.jsx)(c.A,{className:"text-emerald-600"}),(0,l.jsx)("h3",{className:"text-lg font-bold text-emerald-800",children:"\uD83D\uDCC8 Top 5 Bứt ph\xe1"})]}),0===d.length?(0,l.jsx)("p",{className:"text-slate-500 text-center py-4",children:"Kh\xf4ng đủ dữ liệu để so s\xe1nh."}):(0,l.jsx)("div",{className:"space-y-3",children:d.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-emerald-50 rounded-xl",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-emerald-600 text-white flex items-center justify-center font-bold text-sm",children:t+1}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("div",{className:"font-medium text-slate-800",children:e.student.name})}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("div",{className:"font-bold ".concat(e.delta>=0?"text-emerald-600":"text-red-600"),children:[e.delta>=0?"+":"",e.delta.toFixed(1)]}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:[e.prevAvg.toFixed(1)," → ",e.currAvg.toFixed(1)]})]})]},t))})]})]})]})}var eC=s(72372);function eT(e){return(function(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(l)})(e).slice(0,7)}function eD(e){return/^\d{4}-\d{2}$/.test(String(e||"").trim())}function eM(e){return function(e){let t=String(e||"").trim();if(!eD(t))return eT(new Date);let[s,l]=t.split("-"),a=parseInt(s,10),n=parseInt(l,10);return 13===(n+=1)&&(n=1,a+=1),"".concat(String(a).padStart(4,"0"),"-").concat(String(n).padStart(2,"0"))}(function(e){let t=Array.isArray(null==e?void 0:e.scores)?e.scores:[],s=t.length?t[t.length-1]:null,l=String((null==s?void 0:s.month)||"").trim();return eD(l)?l:eT(new Date)}(e))}async function eE(e,t,s,l){let a=await fetch("/api/admin/save-report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mhs:e,report:t,actions:s,monthKey:l})}),n=await a.json().catch(()=>({}));if(!a.ok||!(null==n?void 0:n.ok))throw Error((null==n?void 0:n.error)||"Save report failed");return n}let eL=e=>{let{students:t,onImportData:s,onUpdateStudentReport:n,onLogout:r}=e,[o,d]=(0,a.useState)(null),[c,x]=(0,a.useState)(null),h=t.find(e=>e.mhs===c),[m,u]=(0,a.useState)(""),[p,g]=(0,a.useState)(new Set),[b,f]=(0,a.useState)("ALL"),[j,v]=(0,a.useState)("none"),[N,y]=(0,a.useState)("STUDENTS"),[w,S]=(0,a.useState)(null),k=(null==w?void 0:w.role)==="TEACHER",A=String((null==w?void 0:w.teacherClass)||"").trim();(0,a.useEffect)(()=>{fetch("/api/me").then(e=>e.json()).then(e=>S((null==e?void 0:e.session)||null)).catch(()=>S(null))},[]);let C=(0,a.useMemo)(()=>k&&A?t.filter(e=>String(e.class||"").trim()===A):t,[t,k,A]);(0,a.useEffect)(()=>{k&&g(e=>{let t=new Set;for(let s of e)C.find(e=>e.mhs===s)&&t.add(s);return t})},[k,C]);let T=(0,a.useMemo)(()=>Array.from(new Set(C.map(e=>e.class||"").filter(Boolean))).sort(),[C]),D=(0,a.useMemo)(()=>{let e=m.toLowerCase(),t=C.filter(t=>("ALL"===b||t.class===b)&&(t.name.toLowerCase().includes(e)||t.mhs.toLowerCase().includes(e)||t.class.toLowerCase().includes(e)));return"none"!==j&&(t=t.slice().sort((e,t)=>{let s=e=>{let t=eM(e);return((function(e){if(!e)return{};let t=null==e?void 0:e.actionsByMonth;return t&&"object"==typeof t?t:{[eM(e)]:Array.isArray(null==e?void 0:e.activeActions)?e.activeActions:[]}})(e)[t]||[]).reduce((e,s)=>e+(Array.isArray(null==s?void 0:s.ticks)?s.ticks:[]).filter(e=>(null==e?void 0:e.completed)&&String((null==e?void 0:e.date)||"").slice(0,7)===t).length,0)},l=s(e),a=s(t);return"desc"===j?a-l:l-a})),t},[C,m,b,j]),[M,E]=(0,a.useState)(null),L=async e=>{d(e.mhs);try{let t=await i(e),s=eM(e),l=(t.actions||[]).map((t,s)=>({id:"".concat(e.mhs,"-").concat(Date.now(),"-").concat(s),description:t.description,frequency:t.frequency,ticks:[]}));await eE(e.mhs,t,l,s),n(e.mhs,t,l)}catch(e){alert((null==e?void 0:e.message)||"Lỗi tạo b\xe1o c\xe1o")}finally{d(null)}},z=async()=>{if(k)return;let e=D.filter(e=>p.has(e.mhs));if(!e.length)return void alert("Chưa chọn học sinh");if(confirm("Tạo b\xe1o c\xe1o cho ".concat(e.length," học sinh?"))){E({current:0,total:e.length,currentName:""});for(let t=0;t<e.length;t++){let s=e[t];E({current:t+1,total:e.length,currentName:s.name});try{await L(s)}catch(e){}t<e.length-1&&await new Promise(e=>setTimeout(e,2e3))}E(null),alert("Ho\xe0n tất!")}},[R,O]=(0,a.useState)(!1),[H,I]=(0,a.useState)(!1),[B,G]=(0,a.useState)([]),[_,F]=(0,a.useState)(new Set),[P,K]=(0,a.useState)(""),[W,V]=(0,a.useState)(""),q=async()=>{if(!k){O(!0);try{let e=await fetch("/api/sync/sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"new_only"})}),t=await e.json();t.monthsSynced&&t.monthsSynced.length>0?(alert("Đồng bộ xong ".concat(t.students," HS")),window.location.reload()):(G(t.monthsAll||[]),F(new Set(t.monthsAll)),V("Kh\xf4ng c\xf3 th\xe1ng mới. Chọn th\xe1ng để đồng bộ lại."),I(!0))}catch(e){alert("Lỗi kết nối")}finally{O(!1)}}},J=async()=>{if(_.size){O(!0);try{let e=await fetch("/api/sync/sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"months",selectedMonths:Array.from(_)})}),t=await e.json();t.ok?(alert("Đồng bộ xong ".concat(t.students," HS")),window.location.reload()):alert(t.error)}catch(e){alert("Lỗi kết nối")}finally{O(!1),I(!1)}}},X=async e=>{var t;if(k)return;let l=null==(t=e.target.files)?void 0:t[0];if(!l)return;let a=new FileReader;a.onload=e=>{var t;let l=null==(t=e.target)?void 0:t.result,a=XLSX.read(l,{type:"binary"}),n=new Map;C.forEach(e=>n.set(e.mhs,{...e})),a.SheetNames.forEach(e=>{let t=a.Sheets[e],s=XLSX.utils.sheet_to_json(t,{header:1});for(let t=1;t<s.length;t++){let l=s[t],a=l[1]?String(l[1]).trim():null;if(!a)continue;let r=l[2]?String(l[2]).trim():"Unknown",i=l[3]?String(l[3]).trim():"",o=e=>{if(null==e||""===e)return null;let t=parseFloat(e);return isNaN(t)?null:t},d=o(l[5]),c=o(l[6]),x=o(l[7]);if(null===d&&null===c&&null===x)continue;let h={month:e,math:d,lit:c,eng:x},m=n.get(a);m?(m.name=r,m.class=i):(m={mhs:a,name:r,class:i,scores:[],activeActions:[]},n.set(a,m));let u=m.scores.findIndex(t=>t.month===e);u>=0?m.scores[u]=h:m.scores.push(h)}});let r=Array.from(n.values());s(r),alert("Nhập xong ".concat(r.length," HS"))},a.readAsBinaryString(l)};return(0,l.jsxs)("div",{className:"min-h-screen font-sans bg-fixed bg-gradient-to-br from-indigo-50 via-white to-sky-50 relative",children:[(0,l.jsxs)("div",{className:"fixed inset-0 pointer-events-none z-0 opacity-40",children:[(0,l.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-indigo-200/40 rounded-full blur-[120px]"}),(0,l.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-sky-200/40 rounded-full blur-[120px]"})]}),(0,l.jsxs)("div",{className:"relative z-10 flex flex-col min-h-screen",children:[(0,l.jsx)(Q,{progress:M}),(0,l.jsx)($,{isOpen:H,onClose:()=>I(!1),syncHint:W,syncMonthSearch:P,onSyncMonthSearchChange:K,syncMonthsAll:B,syncSelectedMonths:_,onToggleMonth:e=>F(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s}),onSelectAll:()=>F(new Set(B)),onClearAll:()=>F(new Set),onSubmit:J,isSyncing:R,isTeacher:k}),(0,l.jsx)(Y,{searchTerm:m,onSearchChange:u,filterClass:b,onFilterClassChange:f,uniqueClasses:T,sortTicks:j,onSortTicksChange:v,isTeacher:k,teacherClass:A,visibleStudents:C,onLogout:r,onBulkGenerate:z,onSyncSheet:q,onFileUpload:X,isSyncing:R,isBulkProcessing:!!M}),(0,l.jsxs)("main",{className:"flex-1 px-4 sm:px-6 py-6 max-w-[1600px] mx-auto w-full animate-in fade-in duration-500",children:[(0,l.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,l.jsxs)("button",{onClick:()=>y("STUDENTS"),className:"flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ".concat("STUDENTS"===N?"bg-indigo-600 text-white shadow-lg":"bg-white/80 text-slate-600 hover:bg-slate-100"),children:[(0,l.jsx)(U.A,{size:18}),(0,l.jsx)("span",{children:"Danh s\xe1ch HS"})]}),(0,l.jsxs)("button",{onClick:()=>y("ANALYTICS"),className:"flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ".concat("ANALYTICS"===N?"bg-indigo-600 text-white shadow-lg":"bg-white/80 text-slate-600 hover:bg-slate-100"),children:[(0,l.jsx)(eC.A,{size:18}),(0,l.jsx)("span",{children:"B\xe1o c\xe1o lớp"})]})]}),"STUDENTS"===N?(0,l.jsx)(ei,{students:D,selectedMhs:p,isTeacher:k,onSelectAll:e=>g(e?new Set(D.map(e=>e.mhs)):new Set),onSelectStudent:(e,t)=>g(s=>{let l=new Set(s);return t?l.add(e):l.delete(e),l}),sortTicks:j,onSortTicks:()=>v(e=>"desc"===e?"asc":"asc"===e?"none":"desc"),onGenerateAI:L,onViewStudent:x,loadingMhs:o}):(0,l.jsx)(eA,{students:C,teacherClass:A||"Tất cả"})]}),h&&(0,l.jsx)(ej,{student:h,students:t,onClose:()=>x(null),onUpdateReport:n,persistReport:eE})]})]})};var ez=s(9540),eR=s(59384),eO=s(12203),eH=s(89442),eI=s(89559),eB=s(11010),eG=s(71360),e_=s(67485),eF=s(68202),eP=s(77545),eU=s(73850),eK=s(37665);function eW(e){return(function(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(l)})(e).slice(0,7)}function eV(e){return/^\d{4}-\d{2}$/.test(String(e||"").trim())}function eq(e){return function(e){let t=String(e||"").trim();if(!eV(t))return eW(new Date);let[s,l]=t.split("-"),a=parseInt(s,10),n=parseInt(l,10);return 13===(n+=1)&&(n=1,a+=1),"".concat(String(a).padStart(4,"0"),"-").concat(String(n).padStart(2,"0"))}(function(e){let t=Array.isArray(null==e?void 0:e.scores)?e.scores:[],s=t.length?t[t.length-1]:null,l=String((null==s?void 0:s.month)||"").trim();return eV(l)?l:eW(new Date)}(e))}function eJ(e){if(!e)return{};let t=null==e?void 0:e.actionsByMonth;return t&&"object"==typeof t?t:{[eq(e)]:Array.isArray(null==e?void 0:e.activeActions)?e.activeActions:[]}}async function eX(e,t,s,l){let a=await fetch("/api/admin/save-report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mhs:e,report:t,actions:s,monthKey:l})}),n=await a.json().catch(()=>({}));if(!a.ok||!(null==n?void 0:n.ok))throw Error((null==n?void 0:n.error)||"Save report failed");return n}function eY(e,t){let s=(Array.isArray(e.activeActions)?e.activeActions:[]).reduce((e,s)=>e+(Array.isArray(s.ticks)?s.ticks.filter(e=>e.completed&&e.date&&e.date.startsWith(t)).length:0),0);if(s>0)return s;let l=eJ(e);return l&&l[t]&&Array.isArray(l[t])?l[t].reduce((e,t)=>e+(Array.isArray(t.ticks)?t.ticks.filter(e=>e.completed).length:0),0):0}function eQ(e){let{user:t,students:s,onLogout:n,onImportData:r,onUpdateStudentReport:i}=e,[o,d]=(0,a.useState)("DASHBOARD"),[c,x]=(0,a.useState)(!1);return(0,l.jsxs)("div",{className:"min-h-screen bg-slate-50 flex flex-col md:flex-row",children:[(0,l.jsxs)("div",{className:"md:hidden bg-white p-4 flex items-center justify-between border-b border-slate-200 sticky top-0 z-20",children:[(0,l.jsx)("div",{className:"font-bold text-lg bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Portal"}),(0,l.jsx)("button",{onClick:()=>x(!0),className:"p-2 text-slate-600",children:(0,l.jsx)(ez.A,{size:24})})]}),c&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 z-30 md:hidden",onClick:()=>x(!1)}),(0,l.jsxs)("aside",{className:"fixed md:sticky top-0 h-screen w-64 bg-slate-900 text-white flex flex-col z-40 transition-transform duration-300 ".concat(c?"translate-x-0":"-translate-x-full md:translate-x-0"),children:[(0,l.jsxs)("div",{className:"p-6 border-b border-slate-800 flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Admin Portal"}),(0,l.jsx)("div",{className:"text-sm text-slate-400 mt-1",children:"DeepDashboard"})]}),(0,l.jsx)("button",{className:"md:hidden text-slate-400",onClick:()=>x(!1),children:(0,l.jsx)(J.A,{size:20})})]}),(0,l.jsxs)("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:[(0,l.jsx)(eZ,{icon:(0,l.jsx)(eR.A,{size:20}),label:"Tổng quan",active:"DASHBOARD"===o,onClick:()=>{d("DASHBOARD"),x(!1)}}),(0,l.jsx)(eZ,{icon:(0,l.jsx)(U.A,{size:20}),label:"Quản l\xfd Người d\xf9ng",active:"USERS"===o,onClick:()=>{d("USERS"),x(!1)}}),(0,l.jsx)(eZ,{icon:(0,l.jsx)(eO.A,{size:20}),label:"Quản l\xfd Lớp học",active:"CLASSES"===o,onClick:()=>{d("CLASSES"),x(!1)}}),(0,l.jsx)(eZ,{icon:(0,l.jsx)(eC.A,{size:20}),label:"B\xe1o c\xe1o & Thống k\xea",active:"ANALYTICS"===o,onClick:()=>{d("ANALYTICS"),x(!1)}}),(0,l.jsx)("div",{className:"pt-4 mt-4 border-t border-slate-700",children:(0,l.jsx)(eZ,{icon:(0,l.jsx)(eH.A,{size:20}),label:"Chế độ Gi\xe1o vi\xean",active:"TEACHER_MODE"===o,onClick:()=>{d("TEACHER_MODE"),x(!1)}})})]}),(0,l.jsxs)("div",{className:"p-4 border-t border-slate-800",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4 px-2",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-white",children:t.name.charAt(0)}),(0,l.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,l.jsx)("div",{className:"text-sm font-medium truncate",children:t.name}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Administrator"})]})]}),(0,l.jsxs)("button",{onClick:n,className:"w-full flex items-center gap-2 text-slate-400 hover:text-red-400 hover:bg-slate-800 p-2 rounded-lg transition-colors",children:[(0,l.jsx)(A.A,{size:18}),(0,l.jsx)("span",{children:"Đăng xuất"})]})]})]}),(0,l.jsx)("main",{className:"flex-1 overflow-x-hidden min-h-screen bg-slate-50 relative",children:"TEACHER_MODE"===o?(0,l.jsx)(e$,{students:s,onImportData:r,onUpdateStudentReport:i,user:t}):"ANALYTICS"===o?(0,l.jsx)(e3,{students:s}):(0,l.jsxs)("div",{className:"p-4 md:p-8",children:["DASHBOARD"===o&&(0,l.jsx)(e0,{students:s}),"USERS"===o&&(0,l.jsx)(e1,{}),"CLASSES"===o&&(0,l.jsx)(e5,{students:s})]})})]})}function e$(e){let{students:t,onImportData:s,onUpdateStudentReport:n,user:r}=e,[o,d]=(0,a.useState)(null),[c,x]=(0,a.useState)(null),h=t.find(e=>e.mhs===c),[m,u]=(0,a.useState)(null),[p,g]=(0,a.useState)(""),[b,f]=(0,a.useState)(new Set),[j,v]=(0,a.useState)("ALL"),[N,y]=(0,a.useState)("none"),[w,S]=(0,a.useState)(!1),k=(0,a.useMemo)(()=>t,[t]),A=(0,a.useMemo)(()=>Array.from(new Set(k.map(e=>e.class||"").filter(Boolean))).sort(),[k]),C=(0,a.useMemo)(()=>{let e=p.toLowerCase(),t=k.filter(t=>("ALL"===j||t.class===j)&&(t.name.toLowerCase().includes(e)||t.mhs.toLowerCase().includes(e)||t.class.toLowerCase().includes(e)));return"none"!==N&&(t=t.slice().sort((e,t)=>{let s=e=>{let t=eq(e);return(eJ(e)[t]||[]).reduce((e,s)=>e+(Array.isArray(null==s?void 0:s.ticks)?s.ticks:[]).filter(e=>(null==e?void 0:e.completed)&&String((null==e?void 0:e.date)||"").slice(0,7)===t).length,0)},l=s(e),a=s(t);return"desc"===N?a-l:l-a})),t},[k,p,j,N]),[T,D]=(0,a.useState)(null),M=async e=>{d(e.mhs);try{let t=await i(e),s=eq(e),l=(t.actions||[]).map((t,s)=>({id:"".concat(e.mhs,"-").concat(Date.now(),"-").concat(s),description:t.description,frequency:t.frequency,ticks:[]}));await eX(e.mhs,t,l,s),n(e.mhs,t,l)}catch(e){alert((null==e?void 0:e.message)||"Lỗi tạo b\xe1o c\xe1o")}finally{d(null)}},E=async()=>{let e=C.filter(e=>b.has(e.mhs));if(!e.length)return void alert("Chưa chọn học sinh");if(confirm("Tạo b\xe1o c\xe1o cho ".concat(e.length," học sinh?"))){D({current:0,total:e.length,currentName:""});for(let t=0;t<e.length;t++){let s=e[t];D({current:t+1,total:e.length,currentName:s.name});try{await M(s)}catch(e){}t<e.length-1&&await new Promise(e=>setTimeout(e,2e3))}D(null),alert("Ho\xe0n tất!")}},[L,z]=(0,a.useState)(!1),[R,O]=(0,a.useState)(!1),[H,I]=(0,a.useState)([]),[B,G]=(0,a.useState)(new Set),[_,F]=(0,a.useState)(""),[P,U]=(0,a.useState)(""),K=async()=>{z(!0);try{let e=await fetch("/api/sync/sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"new_only"})}),t=await e.json();t.monthsSynced&&t.monthsSynced.length>0?(alert("Đồng bộ xong ".concat(t.students," HS")),window.location.reload()):(I(t.monthsAll||[]),G(new Set(t.monthsAll)),U("Kh\xf4ng c\xf3 th\xe1ng mới. Chọn th\xe1ng để đồng bộ lại."),O(!0))}catch(e){alert("Lỗi kết nối")}finally{z(!1)}},W=async()=>{if(B.size){z(!0);try{let e=await fetch("/api/sync/sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"months",selectedMonths:Array.from(B)})}),t=await e.json();t.ok?(alert("Đồng bộ xong ".concat(t.students," HS")),window.location.reload()):alert(t.error)}catch(e){alert("Lỗi kết nối")}finally{z(!1),O(!1)}}},V=async e=>{var l;let a=null==(l=e.target.files)?void 0:l[0];if(!a)return;let n=new FileReader;n.onload=e=>{var l;let a=null==(l=e.target)?void 0:l.result,n=XLSX.read(a,{type:"binary"}),r=new Map;t.forEach(e=>r.set(e.mhs,{...e})),n.SheetNames.forEach(e=>{let t=n.Sheets[e],s=XLSX.utils.sheet_to_json(t,{header:1});for(let t=1;t<s.length;t++){let l=s[t],a=l[1]?String(l[1]).trim():null;if(!a)continue;let n=l[2]?String(l[2]).trim():"Unknown",i=l[3]?String(l[3]).trim():"",o=e=>{if(null==e||""===e)return null;let t=parseFloat(e);return isNaN(t)?null:t},d=o(l[5]),c=o(l[6]),x=o(l[7]);if(null===d&&null===c&&null===x)continue;let h={month:e,math:d,lit:c,eng:x},m=r.get(a);m?(m.name=n,m.class=i):(m={mhs:a,name:n,class:i,scores:[],activeActions:[]},r.set(a,m));let u=m.scores.findIndex(t=>t.month===e);u>=0?m.scores[u]=h:m.scores.push(h)}});let i=Array.from(r.values());s(i),alert("Nhập xong ".concat(i.length," HS"))},n.readAsBinaryString(a)};return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(Q,{progress:T}),(0,l.jsx)($,{isOpen:R,onClose:()=>O(!1),syncHint:P,syncMonthSearch:_,onSyncMonthSearchChange:F,syncMonthsAll:H,syncSelectedMonths:B,onToggleMonth:e=>G(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s}),onSelectAll:()=>G(new Set(H)),onClearAll:()=>G(new Set),onSubmit:W,isSyncing:L,isTeacher:!1}),(0,l.jsx)(Y,{searchTerm:p,onSearchChange:g,filterClass:j,onFilterClassChange:v,uniqueClasses:A,sortTicks:N,onSortTicksChange:y,isTeacher:!1,teacherClass:"",visibleStudents:k,onLogout:()=>{},onBulkGenerate:E,onSyncSheet:K,onFileUpload:V,onAddStudent:()=>S(!0),isSyncing:L,isBulkProcessing:!!T}),(0,l.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,l.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4 flex items-center gap-2",children:[(0,l.jsx)(eN.A,{size:20,className:"text-yellow-600"}),(0,l.jsx)("span",{className:"text-yellow-800 font-medium text-sm",children:'Bạn đang xem ở chế độ "Gi\xe1o vi\xean". Những thay đổi ở đ\xe2y sẽ ảnh hưởng trực tiếp đến dữ liệu học sinh.'})]}),(0,l.jsx)(ei,{students:C,selectedMhs:b,isTeacher:!1,onSelectAll:e=>f(e?new Set(C.map(e=>e.mhs)):new Set),onSelectStudent:(e,t)=>f(s=>{let l=new Set(s);return t?l.add(e):l.delete(e),l}),sortTicks:N,onSortTicks:()=>y(e=>"desc"===e?"asc":"asc"===e?"none":"desc"),onGenerateAI:M,onViewStudent:x,loadingMhs:o,onStudentAction:u})]}),h&&(0,l.jsx)(ej,{student:h,students:t,onClose:()=>x(null),onUpdateReport:n,persistReport:eX}),w&&(0,l.jsx)(e8,{onClose:()=>S(!1)}),m&&(0,l.jsx)(e7,{mhs:m,student:t.find(e=>e.mhs===m),onClose:()=>u(null)})]})}function eZ(e){let{icon:t,label:s,active:a,onClick:n}=e;return(0,l.jsxs)("button",{onClick:n,className:"w-full flex items-center gap-3 p-3 rounded-lg transition-all ".concat(a?"bg-blue-600 text-white shadow-lg shadow-blue-900/50":"text-slate-400 hover:bg-slate-800 hover:text-white"),children:[t," ",(0,l.jsx)("span",{className:"font-medium",children:s})]})}function e0(e){let{students:t}=e,s=t.length,n=new Set(t.map(e=>e.class)).size,[i,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)(""),x=async()=>{if(!i){o(!0),c("");try{var e;let t=await r.syncSheet({mode:"new_only"});t.ok?c("✅ Đồng bộ th\xe0nh c\xf4ng! + ".concat((null==(e=t.newMonthsDetected)?void 0:e.length)||0," th\xe1ng mới.")):c("❌ Lỗi: "+(t.error||"Kh\xf4ng x\xe1c định"))}catch(e){c("❌ Lỗi kết nối: "+e.message)}finally{o(!1)}}};return(0,l.jsxs)("div",{className:"space-y-6 max-w-5xl mx-auto",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-800",children:"Tổng quan hệ thống"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,l.jsx)(e6,{label:"Tổng Học sinh",value:s,color:"blue"}),(0,l.jsx)(e6,{label:"Lớp học hoạt động",value:n,color:"purple"}),(0,l.jsx)(e6,{label:"Gi\xe1o vi\xean",value:"--",color:"emerald"})]}),(0,l.jsx)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200",children:(0,l.jsxs)("div",{className:"flex items-start gap-4",children:[(0,l.jsx)("div",{className:"bg-blue-50 p-3 rounded-full text-blue-600",children:(0,l.jsx)(eI.A,{size:24,className:i?"animate-spin":""})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:"Đồng bộ dữ liệu nhanh"}),(0,l.jsxs)("p",{className:"text-slate-500 mb-4 text-sm",children:["Cập nhật nhanh từ Google Sheets. Để sử dụng đầy đủ chức năng AI/Excel, vui l\xf2ng chuyển sang tab ",(0,l.jsx)("strong",{children:"Chế độ Gi\xe1o vi\xean"}),"."]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:x,disabled:i,className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:i?"Đang xử l\xfd...":"Đồng bộ ngay"}),d&&(0,l.jsx)("span",{className:"text-sm font-medium ".concat(d.startsWith("❌")?"text-red-600":"text-emerald-600"),children:d})]})]})]})})]})}function e1(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!1),i=(0,a.useCallback)(async()=>{n(!0);try{let e=await r.getUsers();e&&e.ok&&e.users?t(e.users):console.error("Failed to fetch users:",e.error)}catch(e){console.error(e)}finally{n(!1)}},[]);(0,a.useEffect)(()=>{i()},[i]);let[o,d]=(0,a.useState)(!1),[c,x]=(0,a.useState)(null);return(0,l.jsxs)("div",{className:"space-y-6 max-w-5xl mx-auto",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-800",children:"Quản l\xfd Người d\xf9ng (Sheet)"}),(0,l.jsx)("button",{onClick:i,disabled:s,className:"p-2 bg-slate-100 hover:bg-slate-200 rounded-full text-slate-600 transition-colors",title:"Tải lại danh s\xe1ch",children:(0,l.jsx)(eI.A,{size:18,className:s?"animate-spin":""})})]}),(0,l.jsxs)("button",{onClick:()=>{x(null),d(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl font-medium transition-colors flex items-center gap-2",children:[(0,l.jsx)(U.A,{size:18}),(0,l.jsx)("span",{children:"Th\xeam User"})]})]}),(0,l.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 flex items-start gap-3",children:[(0,l.jsx)(eN.A,{className:"text-blue-600 shrink-0 mt-0.5",size:20}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-bold text-blue-800 text-sm",children:"Lưu \xfd về Đồng bộ"}),(0,l.jsx)("p",{className:"text-blue-700 text-sm mt-1",children:"Dữ liệu th\xeam ở đ\xe2y l\xe0 tạm thời. H\xe3y cập nhật Google Sheets để dữ liệu kh\xf4ng bị mất khi Deploy lại."})]})]}),(0,l.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-left",children:[(0,l.jsx)("thead",{className:"bg-slate-50 border-b border-slate-100",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600",children:"T\xean"}),(0,l.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600",children:"Username"}),(0,l.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600",children:"Role"}),(0,l.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600 text-right",children:"Action"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-100",children:e.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,l.jsx)("td",{className:"px-6 py-4",children:e.name}),(0,l.jsx)("td",{className:"px-6 py-4 text-slate-500",children:e.username}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("ADMIN"===e.role?"bg-purple-100 text-purple-700":"bg-emerald-100 text-emerald-700"),children:e.role})}),(0,l.jsxs)("td",{className:"px-6 py-4 text-right space-x-2",children:[(0,l.jsx)("button",{onClick:()=>{alert("Vui l\xf2ng chỉnh sửa trực tiếp tr\xean Google Sheet.")},className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:(0,l.jsx)(eB.A,{size:16})}),(0,l.jsx)("button",{onClick:()=>{var t;return t=e.username,void(confirm("X\xf3a ".concat(t,"?"))&&alert("Chức năng x\xf3a chưa được hỗ trợ với Google Sheets (vui l\xf2ng x\xf3a trực tiếp tr\xean Sheet)."))},className:"p-2 text-red-600 hover:bg-red-50 rounded",children:(0,l.jsx)(eG.A,{size:16})})]})]},e.username))})]})})}),o&&(0,l.jsx)(e2,{user:c,onClose:()=>d(!1),onSave:()=>{d(!1),x(null),setTimeout(i,2e3)}})]})}function e2(e){let{user:t,onClose:s,onSave:n}=e,[i,o]=(0,a.useState)((null==t?void 0:t.name)||""),[d,c]=(0,a.useState)((null==t?void 0:t.username)||""),[x,h]=(0,a.useState)((null==t?void 0:t.role)||"TEACHER");return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4 text-slate-800",children:t?"Sửa User (Local)":"Th\xeam Gi\xe1o vi\xean (Google Sheet)"}),!t&&(0,l.jsx)("div",{className:"bg-blue-50 text-blue-800 p-3 rounded-lg mb-4 text-sm",children:'Th\xeam v\xe0o Google Sheet: "Teachers". Hệ thống sẽ tự động cập nhật sau khi tải lại trang.'}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"T\xean Gi\xe1o vi\xean"}),(0,l.jsx)("input",{value:i,onChange:e=>o(e.target.value),className:"w-full border rounded-lg px-3 py-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Username (T\xe0i khoản)"}),(0,l.jsx)("input",{value:d,onChange:e=>c(e.target.value),disabled:!!t,className:"w-full border rounded-lg px-3 py-2 disabled:bg-slate-100"})]}),!t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Lớp Chủ nhiệm (VD: 10A1)"}),(0,l.jsx)("input",{placeholder:"Nhập lớp...",className:"w-full border rounded-lg px-3 py-2",id:"new_teacher_class"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Mật khẩu mặc định"}),(0,l.jsx)("input",{type:"text",placeholder:"VD: 123456",className:"w-full border rounded-lg px-3 py-2",id:"new_teacher_pass",defaultValue:"123456"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Ghi ch\xfa (T\xf9y chọn)"}),(0,l.jsx)("textarea",{className:"w-full border rounded-lg px-3 py-2",id:"new_teacher_note"})]})]}),t&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Role"}),(0,l.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"w-full border rounded-lg px-3 py-2",children:[(0,l.jsx)("option",{value:"TEACHER",children:"Gi\xe1o vi\xean"}),(0,l.jsx)("option",{value:"ADMIN",children:"Admin"})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,l.jsx)("button",{onClick:s,className:"text-slate-500",children:"Hủy"}),(0,l.jsx)("button",{onClick:async()=>{if(t)n({username:d,name:i,role:x});else{let e=document.getElementById("new_teacher_class").value,t=document.getElementById("new_teacher_pass").value,l=document.getElementById("new_teacher_note").value;if(!d||!i||!t)return void alert("Thiếu th\xf4ng tin bắt buộc!");let a=document.getElementById("btn-save-user");a&&(a.innerText="Đang lưu...");try{let a=await r.addTeacher({name:i,username:d,teacherClass:e,password:t,note:l});a&&a.ok?(alert("Đ\xe3 th\xeam gi\xe1o vi\xean v\xe0o Google Sheet! Vui l\xf2ng đợi 1 ch\xfat rồi tải lại trang để thấy thay đổi."),s()):alert("Lỗi: "+(a.error||"Unknown"))}catch(e){alert("Lỗi kết nối: "+e.message)}a&&(a.innerText="Lưu")}},id:"btn-save-user",className:"bg-blue-600 text-white px-4 py-2 rounded-lg",children:"Lưu"})]})]})})}function e5(e){let{students:t}=e,s=(0,a.useMemo)(()=>{let e=new Map;return t.forEach(t=>{let s=t.class||"Kh\xf4ng c\xf3 lớp";e.set(s,(e.get(s)||0)+1)}),Array.from(e.entries()).map(e=>{let[t,s]=e;return{id:t,name:t,teacherId:"",studentCount:s}}).sort((e,t)=>e.name.localeCompare(t.name))},[t]),[n,r]=(0,a.useState)(!1);return(0,l.jsxs)("div",{className:"space-y-6 max-w-5xl mx-auto",children:[(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-800",children:"Quản l\xfd Lớp học"})}),(0,l.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:(0,l.jsxs)("table",{className:"w-full text-left",children:[(0,l.jsx)("thead",{className:"bg-slate-50 border-b",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-4",children:"Lớp"}),(0,l.jsx)("th",{className:"px-6 py-4",children:"GVCN"}),(0,l.jsx)("th",{className:"px-6 py-4 text-right",children:"Sĩ số"})]})}),(0,l.jsx)("tbody",{className:"divide-y",children:s.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,l.jsx)("td",{className:"px-6 py-4 font-medium",children:e.name}),(0,l.jsx)("td",{className:"px-6 py-4 text-slate-500",children:e.teacherId||"—"}),(0,l.jsx)("td",{className:"px-6 py-4 text-right",children:(0,l.jsxs)("span",{className:"bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-bold",children:[e.studentCount," HS"]})})]},e.id))})]})}),n&&(0,l.jsx)(e4,{onClose:()=>r(!1),onSave:()=>{alert("Để th\xeam lớp mới, vui l\xf2ng th\xeam học sinh v\xe0o lớp đ\xf3 tr\xean Google Sheets."),r(!1)}})]})}function e4(e){let{onClose:t,onSave:s}=e,[n,r]=(0,a.useState)(""),[i,o]=(0,a.useState)("");return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Th\xeam lớp"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:"T\xean"}),(0,l.jsx)("input",{value:n,onChange:e=>r(e.target.value),className:"w-full border rounded-lg px-3 py-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:"GVCN"}),(0,l.jsx)("input",{value:i,onChange:e=>o(e.target.value),className:"w-full border rounded-lg px-3 py-2"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,l.jsx)("button",{onClick:t,className:"text-slate-500",children:"Hủy"}),(0,l.jsx)("button",{onClick:()=>s({id:n,name:n,teacherId:i,studentCount:0}),className:"bg-purple-600 text-white px-4 py-2 rounded-lg",children:"Tạo"})]})]})})}function e6(e){let{label:t,value:s,color:a}=e;return(0,l.jsxs)("div",{className:"p-6 rounded-2xl border ".concat({blue:"bg-blue-50 text-blue-700 border-blue-100",purple:"bg-purple-50 text-purple-700 border-purple-100",emerald:"bg-emerald-50 text-emerald-700 border-emerald-100"}[a]),children:[(0,l.jsx)("div",{className:"text-sm font-medium opacity-80",children:t}),(0,l.jsx)("div",{className:"text-4xl font-bold mt-2",children:s})]})}function e3(e){let{students:t}=e,s=(0,a.useMemo)(()=>{let e=new Map,s=new Set;return t.forEach(t=>{t.scores.forEach(t=>{let l=t.month;if(!eV(l))return;s.add(l),e.has(l)||e.set(l,{math:[],lit:[],eng:[]});let a=e.get(l);"number"==typeof t.math&&a.math.push(t.math),"number"==typeof t.lit&&a.lit.push(t.lit),"number"==typeof t.eng&&a.eng.push(t.eng)})}),Array.from(s).sort().map(t=>{let s=e.get(t),l=[...s.math,...s.lit,...s.eng];return{month:t,avgScore:parseFloat((l.length?l.reduce((e,t)=>e+t,0)/l.length:0).toFixed(2)),maxScore:l.length?Math.max(...l):0,minScore:l.length?Math.min(...l):0}})},[t]),[n,r]=(0,a.useState)(eW(new Date)),i=(0,a.useMemo)(()=>{let e=new Set,s=new Date;e.add(eW(s));let l=new Date(s.getFullYear(),s.getMonth()-1,1);return e.add(eW(l)),t.forEach(t=>{var s;return null==(s=t.scores)?void 0:s.forEach(t=>e.add(t.month))}),Array.from(e).sort().reverse()},[t]),o=(0,a.useMemo)(()=>{let e=[];t.forEach(t=>{var s,l,a,r,i,o;let d=t.scores.find(e=>e.month===n);if(!d)return;let c=null!=(s=d.math)?s:0,x=null!=(l=d.lit)?l:0,h=null!=(a=d.eng)?a:0,m=(c+x+h)/3,u=[],p=null;m<4&&m>0?(p="DANGER",u.push("TB < 4.0 (".concat(m.toFixed(1),")"))):m>=4&&m<5&&(p=p||"WARNING",u.push("TB thấp (".concat(m.toFixed(1),")")));let g=t.scores.findIndex(e=>e.month===n);if(g>0){let e=t.scores[g-1],s=((null!=(r=e.math)?r:0)+(null!=(i=e.lit)?i:0)+(null!=(o=e.eng)?o:0))/3;s-m>1.5&&(p=p||"WARNING",u.push("Tụt điểm (-".concat((s-m).toFixed(1),")")))}if(c>0&&c<5||x>0&&x<5||h>0&&h<5){p||(p="NOTICE");let e=[];c>0&&c<5&&e.push("To\xe1n: ".concat(c)),x>0&&x<5&&e.push("Văn: ".concat(x)),h>0&&h<5&&e.push("Anh: ".concat(h)),e.length&&u.push(e.join(", "))}p&&u.length&&e.push({student:t,avgScore:m,level:p,reasons:u})});let s={DANGER:0,WARNING:1,NOTICE:2};return e.sort((e,t)=>s[e.level]-s[t.level]||e.avgScore-t.avgScore)},[t,n]),d=(0,a.useMemo)(()=>{let e=[],s=new Map;return t.forEach(t=>{var l,a,r,i,o,d;let c=t.scores.findIndex(e=>e.month===n);if(c<=0)return;let x=t.scores[c],h=t.scores[c-1],m=((null!=(l=x.math)?l:0)+(null!=(a=x.lit)?a:0)+(null!=(r=x.eng)?r:0))/3,u=((null!=(i=h.math)?i:0)+(null!=(o=h.lit)?o:0)+(null!=(d=h.eng)?d:0))/3,p=m-u;if(u>0){e.push({student:t,delta:p,prevAvg:u,currAvg:m});let l=t.class||"Unknown";s.has(l)||s.set(l,{totalDelta:0,count:0});let a=s.get(l);a.totalDelta+=p,a.count++}}),{topImprovers:e.sort((e,t)=>t.delta-e.delta).slice(0,5),classData:Array.from(s.entries()).map(e=>{let[t,s]=e;return{name:t,avgDelta:parseFloat((s.totalDelta/s.count).toFixed(2))}}).sort((e,t)=>t.avgDelta-e.avgDelta)}},[t,n]),c=(0,a.useMemo)(()=>{let e=new Map;t.forEach(t=>{let s=t.scores.find(e=>e.month===n);if(!s)return;let l=t.class||"Unknown";e.has(l)||e.set(l,{math:[],lit:[],eng:[]});let a=e.get(l);"number"==typeof s.math&&a.math.push(s.math),"number"==typeof s.lit&&a.lit.push(s.lit),"number"==typeof s.eng&&a.eng.push(s.eng)});let s=Array.from(e.keys()).sort(),l={Toán:"math",Văn:"lit",Anh:"eng"},a=["To\xe1n","Văn","Anh"].map(t=>{let a=l[t];return{subject:t,cells:s.map(t=>{var s;let l=(null==(s=e.get(t))?void 0:s[a])||[],n=l.length?l.reduce((e,t)=>e+t,0)/l.length:0;return{class:t,avg:parseFloat(n.toFixed(1)),color:n>=7.5?"bg-emerald-500 text-white":n>=5?"bg-yellow-400 text-slate-800":"bg-red-500 text-white"}})}});return{classes:s,grid:a}},[t,n]),x=(0,a.useMemo)(()=>{let e=new Map;return t.forEach(t=>{let s=t.class||"Unknown";e.has(s)||e.set(s,{totalTicks:0,studentCount:0});let l=e.get(s);l.studentCount++;let a=eY(t,n);l.totalTicks+=a}),Array.from(e.entries()).map(e=>{let[t,s]=e;return{name:t,totalTicks:s.totalTicks,avgTicks:parseFloat((s.totalTicks/s.studentCount).toFixed(1))}}).sort((e,t)=>t.avgTicks-e.avgTicks)},[t,n]),h=(0,a.useMemo)(()=>{let e=[];return t.forEach(t=>{let s=t.scores.find(e=>e.month===n);if(s){let l=s.math||0,a=(l+(s.lit||0)+(s.eng||0))/3;a<5&&a>0&&e.push({student:t,reason:"Điểm TB thấp (".concat(a.toFixed(1),")"),type:"ACADEMIC"});let r=t.scores.findIndex(e=>e.month===n);if(r>0){let s=t.scores[r-1],l=((s.math||0)+(s.lit||0)+(s.eng||0))/3;l-a>1.5&&e.push({student:t,reason:"Tụt điểm nhanh (-".concat((l-a).toFixed(1),")"),type:"ACADEMIC"})}}5>eY(t,n)&&e.push({student:t,reason:"Rất \xedt hoạt động (Ticks < 5)",type:"ENGAGEMENT"})}),e},[t,n]),m=(0,a.useMemo)(()=>t.map(e=>{let t=eY(e,n),s=e.scores.find(e=>e.month===n),l=s?((s.math||0)+(s.lit||0)+(s.eng||0))/3:0;return 0===l&&0===t?null:{x:t,y:parseFloat(l.toFixed(1)),name:e.name,class:e.class,mhs:e.mhs}}).filter(Boolean),[t,n]);return(0,l.jsxs)("div",{className:"p-4 md:p-8 space-y-8 animate-in fade-in",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-2",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-800",children:"B\xe1o c\xe1o & Thống k\xea"}),(0,l.jsxs)("select",{value:n,onChange:e=>r(e.target.value),className:"border border-slate-200 rounded-lg px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 bg-white shadow-sm",children:[i.map(e=>(0,l.jsx)("option",{value:e,children:e},e)),0===i.length&&(0,l.jsx)("option",{value:eW(new Date),children:eW(new Date)})]})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border-2 border-red-200",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,l.jsx)(eN.A,{className:"text-red-600",size:24}),(0,l.jsx)("h3",{className:"text-lg font-bold text-red-800",children:"\uD83D\uDEA8 Cảnh b\xe1o Học lực (Chỉ x\xe9t Điểm số)"})]}),(0,l.jsx)("div",{className:"overflow-y-auto max-h-[350px]",children:(0,l.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,l.jsx)("thead",{className:"bg-red-50 text-red-900 sticky top-0",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-3 rounded-tl-lg",children:"Học sinh"}),(0,l.jsx)("th",{className:"p-3",children:"Lớp"}),(0,l.jsx)("th",{className:"p-3",children:"Điểm TB"}),(0,l.jsx)("th",{className:"p-3",children:"Mức độ"}),(0,l.jsx)("th",{className:"p-3 rounded-tr-lg",children:"L\xfd do"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-100",children:0===o.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:5,className:"p-4 text-center text-slate-500",children:"✅ Kh\xf4ng c\xf3 học sinh n\xe0o trong mức cảnh b\xe1o học lực."})}):o.map((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,l.jsx)("td",{className:"p-3 font-medium",children:e.student.name}),(0,l.jsx)("td",{className:"p-3 text-slate-500",children:e.student.class}),(0,l.jsx)("td",{className:"p-3 font-bold",children:e.avgScore.toFixed(1)}),(0,l.jsx)("td",{className:"p-3",children:(0,l.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("DANGER"===e.level?"bg-red-600 text-white":"WARNING"===e.level?"bg-orange-500 text-white":"bg-yellow-400 text-slate-800"),children:"DANGER"===e.level?"\uD83D\uDD34 Nguy hiểm":"WARNING"===e.level?"\uD83D\uDFE0 Theo d\xf5i":"\uD83D\uDFE1 Ch\xfa \xfd"})}),(0,l.jsx)("td",{className:"p-3 text-xs text-slate-600",children:e.reasons.join(" \xb7 ")})]},t))})]})})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200",children:[(0,l.jsxs)("h3",{className:"text-lg font-bold text-slate-700 mb-4",children:["\uD83D\uDD25 Bản đồ Nhiệt M\xf4n học (Th\xe1ng ",n,")"]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-center text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-3 text-left font-semibold text-slate-600",children:"M\xf4n"}),c.classes.map(e=>(0,l.jsx)("th",{className:"p-3 font-semibold text-slate-600",children:e},e))]})}),(0,l.jsx)("tbody",{children:c.grid.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"p-3 text-left font-medium text-slate-700",children:e.subject}),e.cells.map(e=>(0,l.jsx)("td",{className:"p-2",children:(0,l.jsx)("div",{className:"rounded-lg px-3 py-2 font-bold text-sm ".concat(e.color),children:e.avg>0?e.avg:"-"})},e.class))]},e.subject))})]})}),(0,l.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-4 text-xs text-slate-500",children:[(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"w-4 h-4 rounded bg-emerald-500"})," Giỏi (≥7.5)"]}),(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"w-4 h-4 rounded bg-yellow-400"})," Kh\xe1 (5.0-7.5)"]}),(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"w-4 h-4 rounded bg-red-500"})," Yếu (<5.0)"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-emerald-200",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-emerald-800 mb-4",children:"\uD83D\uDCC8 Top 5 Học sinh Bứt ph\xe1"}),0===d.topImprovers.length?(0,l.jsx)("p",{className:"text-slate-500 text-center py-4",children:"Kh\xf4ng đủ dữ liệu để so s\xe1nh."}):(0,l.jsx)("div",{className:"space-y-3",children:d.topImprovers.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-emerald-50 rounded-xl",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-emerald-600 text-white flex items-center justify-center font-bold text-sm",children:t+1}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"font-medium text-slate-800",children:e.student.name}),(0,l.jsx)("div",{className:"text-xs text-slate-500",children:e.student.class})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("div",{className:"font-bold text-emerald-600",children:["+",e.delta.toFixed(1)]}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:[e.prevAvg.toFixed(1)," → ",e.currAvg.toFixed(1)]})]})]},t))})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-700 mb-4",children:"\uD83C\uDFEB Đ\xe0 Tiến bộ theo Lớp"}),(0,l.jsx)("div",{className:"h-[280px] w-full",children:(0,l.jsx)(g.u,{width:"100%",height:"100%",children:(0,l.jsxs)(ey.E,{data:d.classData,margin:{top:10,right:20,left:0,bottom:0},children:[(0,l.jsx)(f.d,{vertical:!1,strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,l.jsx)(j.W,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#64748b"},dy:10}),(0,l.jsx)(v.h,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b"}}),(0,l.jsx)(N.m,{cursor:{fill:"#f1f5f9"},contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>[void 0!==e&&e>0?"+".concat(e):null!=e?e:0,"TB Tăng/Giảm"]}),(0,l.jsx)(ew.yP,{dataKey:"avgDelta",name:"TB Tăng/Giảm",radius:[4,4,0,0],barSize:40,children:d.classData.map((e,t)=>(0,l.jsx)(eS.f,{fill:e.avgDelta>=0?"#10b981":"#ef4444"},"cell-".concat(t)))})]})})})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-orange-100",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,l.jsx)(eN.A,{className:"text-orange-600"}),(0,l.jsxs)("h3",{className:"text-lg font-bold text-slate-700",children:["Cảnh b\xe1o sớm Tổng hợp (Th\xe1ng ",n,")"]})]}),(0,l.jsx)("div",{className:"overflow-y-auto max-h-[400px]",children:(0,l.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,l.jsx)("thead",{className:"bg-orange-50 text-orange-900 sticky top-0",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-3 rounded-tl-lg",children:"Học sinh"}),(0,l.jsx)("th",{className:"p-3",children:"Lớp"}),(0,l.jsx)("th",{className:"p-3 rounded-tr-lg",children:"Vấn đề"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-100",children:0===h.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:3,className:"p-4 text-center text-slate-500",children:"Kh\xf4ng c\xf3 học sinh n\xe0o trong mức cảnh b\xe1o. Tốt!"})}):h.map((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,l.jsx)("td",{className:"p-3 font-medium",children:e.student.name}),(0,l.jsx)("td",{className:"p-3 text-slate-500",children:e.student.class}),(0,l.jsx)("td",{className:"p-3",children:(0,l.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("ACADEMIC"===e.type?"bg-red-100 text-red-700":"bg-orange-100 text-orange-700"),children:e.reason})})]},t))})]})})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-700 mb-4",children:"Ma trận Tương quan: Th\xf3i quen vs Điểm số"}),(0,l.jsx)("div",{className:"h-[400px] w-full",children:(0,l.jsx)(g.u,{width:"100%",height:"100%",children:(0,l.jsxs)(e_.t,{margin:{top:20,right:20,bottom:20,left:0},children:[(0,l.jsx)(f.d,{strokeDasharray:"3 3"}),(0,l.jsx)(j.W,{type:"number",dataKey:"x",name:"Tasks Completed",unit:" ticks",label:{value:"Số Tick (Chăm chỉ)",position:"insideBottom",offset:-10}}),(0,l.jsx)(v.h,{type:"number",dataKey:"y",name:"Avg Score",unit:" đ",label:{value:"Điểm TB",angle:-90,position:"insideLeft"},domain:[0,10]}),(0,l.jsx)(N.m,{cursor:{strokeDasharray:"3 3"},content:e=>{let{active:t,payload:s}=e;if(t&&s&&s.length){let e=s[0].payload;return(0,l.jsxs)("div",{className:"bg-white p-2 border border-slate-200 shadow-lg rounded text-xs",children:[(0,l.jsxs)("strong",{children:[e.name," (",e.class,")"]}),(0,l.jsxs)("div",{children:["Tick: ",e.x," | Điểm: ",e.y]})]})}return null}}),(0,l.jsx)(eF.e_,{x:20,stroke:"#94a3b8",strokeDasharray:"3 3"}),(0,l.jsx)(eF.e_,{y:6.5,stroke:"#94a3b8",strokeDasharray:"3 3"}),(0,l.jsx)(eP.Xl,{name:"Students",data:m,fill:"#8884d8",children:m.map((e,t)=>{let s="#94a3b8";return e.x>20&&e.y>=7&&(s="#10b981"),e.x<10&&e.y<5&&(s="#ef4444"),e.x>20&&e.y<6&&(s="#f59e0b"),e.x<10&&e.y>=7&&(s="#8b5cf6"),(0,l.jsx)(eS.f,{fill:s},"cell-".concat(t))})})]})})})]})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-700 mb-4",children:"Biến động Điểm số (TB Khối)"}),(0,l.jsx)("div",{className:"h-[300px] w-full",children:(0,l.jsx)(g.u,{width:"100%",height:"100%",children:(0,l.jsxs)(eU.Q,{data:s,margin:{top:10,right:30,left:0,bottom:0},children:[(0,l.jsx)("defs",{children:(0,l.jsxs)("linearGradient",{id:"colorAvg",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,l.jsx)("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),(0,l.jsx)("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),(0,l.jsx)(j.W,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fill:"#64748b"},dy:10}),(0,l.jsx)(v.h,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b"},domain:[0,10]}),(0,l.jsx)(f.d,{vertical:!1,strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,l.jsx)(N.m,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),(0,l.jsx)(w.Gk,{type:"monotone",dataKey:"avgScore",name:"Điểm TB",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorAvg)",strokeWidth:3}),(0,l.jsx)(y.N1,{type:"monotone",dataKey:"maxScore",name:"Cao nhất",stroke:"#10b981",strokeWidth:2,dot:!1,strokeDasharray:"5 5"}),(0,l.jsx)(y.N1,{type:"monotone",dataKey:"minScore",name:"Thấp nhất",stroke:"#ef4444",strokeWidth:2,dot:!1,strokeDasharray:"5 5"}),(0,l.jsx)(eK.s,{wrapperStyle:{paddingTop:"20px"}})]})})})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-700",children:"Mức độ Chăm chỉ theo Lớp (Ticks)"}),(0,l.jsxs)("select",{value:n,onChange:e=>r(e.target.value),className:"border border-slate-200 rounded-lg px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-blue-500",children:[i.map(e=>(0,l.jsx)("option",{value:e,children:e},e)),0===i.length&&(0,l.jsx)("option",{value:eW(new Date),children:eW(new Date)})]})]}),(0,l.jsx)("div",{className:"h-[300px] w-full",children:(0,l.jsx)(g.u,{width:"100%",height:"100%",children:(0,l.jsxs)(ey.E,{data:x,margin:{top:10,right:30,left:0,bottom:0},children:[(0,l.jsx)(f.d,{vertical:!1,strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,l.jsx)(j.W,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#64748b"},dy:10}),(0,l.jsx)(v.h,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b"}}),(0,l.jsx)(N.m,{cursor:{fill:"#f1f5f9"},contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),(0,l.jsx)(ew.yP,{dataKey:"avgTicks",name:"TB Ticks/HS",fill:"#8b5cf6",radius:[4,4,0,0],barSize:40}),(0,l.jsx)(eK.s,{wrapperStyle:{paddingTop:"20px"}})]})})}),(0,l.jsx)("div",{className:"mt-4 text-center text-sm text-slate-500 italic",children:"* Dữ liệu dựa tr\xean tổng số nhiệm vụ (ticks) ho\xe0n th\xe0nh của lớp chia cho sĩ số."})]})]})}function e8(e){let{onClose:t}=e,[s,n]=(0,a.useState)(""),[i,o]=(0,a.useState)(""),[d,c]=(0,a.useState)(""),[x,h]=(0,a.useState)(!1),m=async()=>{if(!s||!i||!d)return void alert("Vui l\xf2ng điền đủ th\xf4ng tin!");h(!0);try{let e=await r.addStudent({mhs:s,name:i,className:d});e&&e.ok?(alert("Đ\xe3 th\xeam học sinh v\xe0o Google Sheet! Vui l\xf2ng đợi 1 ch\xfat rồi bấm n\xfat 'Đồng bộ' để cập nhật danh s\xe1ch."),t()):alert("Lỗi: "+(e.error||"Unknown"))}catch(e){alert("Lỗi kết nối: "+e.message)}h(!1)};return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4 text-slate-800",children:"Th\xeam Học sinh (Google Sheet)"}),(0,l.jsx)("div",{className:"bg-blue-50 text-blue-800 p-3 rounded-lg mb-4 text-sm",children:'Học sinh sẽ được th\xeam v\xe0o sheet. Bạn cần bấm n\xfat "Đồng bộ" sau khi th\xeam để hiển thị tr\xean hệ thống.'}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"M\xe3 Học sinh (MHS)"}),(0,l.jsx)("input",{value:s,onChange:e=>n(e.target.value),placeholder:"HS001",className:"w-full border rounded-lg px-3 py-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Họ v\xe0 T\xean"}),(0,l.jsx)("input",{value:i,onChange:e=>o(e.target.value),placeholder:"Nguyễn Văn A",className:"w-full border rounded-lg px-3 py-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Lớp"}),(0,l.jsx)("input",{value:d,onChange:e=>c(e.target.value),placeholder:"10A1",className:"w-full border rounded-lg px-3 py-2"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,l.jsx)("button",{onClick:t,className:"text-slate-500",children:"Hủy"}),(0,l.jsx)("button",{onClick:m,disabled:x,className:"bg-blue-600 text-white px-4 py-2 rounded-lg disabled:opacity-50",children:x?"Đang lưu...":"Lưu"})]})]})})}function e7(e){let{mhs:t,student:s,onClose:n}=e,[i,o]=(0,a.useState)((null==s?void 0:s.class)||""),[d,c]=(0,a.useState)(!1),[x,h]=(0,a.useState)(null),m=async()=>{if(!i.trim())return void alert("Vui l\xf2ng nhập lớp mới!");c(!0);try{let e=await r.updateStudent(t,{newClass:i.trim()});e&&e.ok?(alert("Đ\xe3 chuyển lớp! Vui l\xf2ng bấm Đồng bộ để cập nhật danh s\xe1ch."),n()):alert("Lỗi: "+(e.error||"Unknown"))}catch(e){alert("Lỗi kết nối: "+e.message)}c(!1)},u=async()=>{if(confirm("Bạn c\xf3 chắc chắn muốn X\xd3A học sinh ".concat((null==s?void 0:s.name)||t,"? H\xe0nh động n\xe0y kh\xf4ng thể ho\xe0n t\xe1c!"))){c(!0);try{let e=await r.deleteStudent(t);e&&e.ok?(alert("Đ\xe3 x\xf3a học sinh! Vui l\xf2ng bấm Đồng bộ để cập nhật danh s\xe1ch."),n()):alert("Lỗi: "+(e.error||"Unknown"))}catch(e){alert("Lỗi kết nối: "+e.message)}c(!1)}};return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4 text-slate-800",children:"Quản l\xfd Học sinh"}),(0,l.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg mb-4",children:[(0,l.jsxs)("div",{className:"text-sm text-slate-600",children:["M\xe3 HS: ",(0,l.jsx)("span",{className:"font-mono font-bold",children:t})]}),s&&(0,l.jsx)("div",{className:"text-lg font-bold text-slate-800",children:s.name}),s&&(0,l.jsxs)("div",{className:"text-sm text-slate-500",children:["Lớp hiện tại: ",s.class]})]}),!x&&(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)("button",{onClick:()=>h("move"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-xl font-medium transition-colors",children:"Chuyển lớp"}),(0,l.jsx)("button",{onClick:()=>h("delete"),className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded-xl font-medium transition-colors",children:"X\xf3a học sinh"}),(0,l.jsx)("button",{onClick:n,className:"w-full text-slate-500 py-2",children:"Hủy"})]}),"move"===x&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Lớp mới"}),(0,l.jsx)("input",{value:i,onChange:e=>o(e.target.value),placeholder:"VD: 10A2",className:"w-full border rounded-lg px-3 py-2"})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,l.jsx)("button",{onClick:()=>h(null),className:"text-slate-500",children:"Quay lại"}),(0,l.jsx)("button",{onClick:m,disabled:d,className:"bg-blue-600 text-white px-4 py-2 rounded-lg disabled:opacity-50",children:d?"Đang xử l\xfd...":"X\xe1c nhận"})]})]}),"delete"===x&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 p-4 rounded-lg text-red-800 text-sm",children:[(0,l.jsx)("strong",{children:"Cảnh b\xe1o:"})," H\xe0nh động n\xe0y sẽ x\xf3a học sinh khỏi Google Sheets v\xe0 KH\xd4NG THỂ ho\xe0n t\xe1c!"]}),(0,l.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,l.jsx)("button",{onClick:()=>h(null),className:"text-slate-500",children:"Quay lại"}),(0,l.jsx)("button",{onClick:u,disabled:d,className:"bg-red-600 text-white px-4 py-2 rounded-lg disabled:opacity-50",children:d?"Đang xử l\xfd...":"X\xf3a học sinh"})]})]})]})})}function e9(e){let{onLogin:t}=e,[s,n]=(0,a.useState)(""),[r,i]=(0,a.useState)(""),[o,d]=(0,a.useState)(null),[c,x]=(0,a.useState)(!1),h=async e=>{e.preventDefault(),d(null),x(!0);try{await t(s,r)}catch(e){d((null==e?void 0:e.message)||"Đăng nhập thất bại")}finally{x(!1)}};return(0,l.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-6",children:(0,l.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow p-6",children:[(0,l.jsx)("div",{className:"text-xl font-bold text-slate-800",children:"Đăng nhập"}),(0,l.jsx)("div",{className:"text-sm text-slate-500 mt-1",children:" Gi\xe1o vi\xean / Học sinh"}),(0,l.jsxs)("form",{onSubmit:h,className:"mt-6 space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-medium text-slate-700 mb-1",children:"T\xe0i khoản"}),(0,l.jsx)("input",{className:"w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-200",value:s,onChange:e=>n(e.target.value),placeholder:"gv... / MHS",autoComplete:"username"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-medium text-slate-700 mb-1",children:"Mật khẩu"}),(0,l.jsx)("input",{className:"w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-200",value:r,onChange:e=>i(e.target.value),placeholder:"••••••••",type:"password",autoComplete:"current-password"})]}),o?(0,l.jsx)("div",{className:"text-sm text-red-600",children:o}):null,(0,l.jsx)("button",{disabled:c,className:"w-full rounded-xl bg-slate-900 text-white py-2 font-semibold hover:bg-slate-800 disabled:opacity-60",type:"submit",children:c?"Đang đăng nhập...":"Đăng nhập"})]})]})})}function te(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)(!0),[i,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(null),x=(0,a.useMemo)(()=>e?"STUDENT"===e.role?"STUDENT":"ADMIN"===e.role?"ADMIN":"TEACHER":"LOGIN",[e]);async function h(){n(!0);try{let e=await fetch("/api/me",{credentials:"include"}).then(e=>e.json());if((null==e?void 0:e.ok)&&(null==e?void 0:e.session)){let s={username:String(e.session.username||"admin"),name:e.session.name||"User",role:e.session.role};if(s.teacherClass=e.session.teacherClass,t(s),"STUDENT"===s.role){let e=await r.getStudentMe(s.username);c(e)}else{let e=await r.getAllStudents();o(e)}}else t(null),o([]),c(null)}catch(e){t(null),o([]),c(null)}finally{n(!1)}}(0,a.useEffect)(()=>{h()},[]);let m=async(e,s)=>{let l=await r.login(e,s);if(!l.success||!l.user)throw Error(l.error||"Đăng nhập thất bại");t(l.user),"STUDENT"===l.user.role?c(await r.getStudentMe(l.user.username)):o(await r.getAllStudents())},u=async()=>{try{await r.logout()}finally{t(null),o([]),c(null)}},p=async e=>{await r.importExcel(e),o(await r.getAllStudents())},g=async(e,t,s,l)=>{await r.saveReport(e,t,s,l),o(l=>l.map(l=>String(l.mhs).trim()!==String(e).trim()?l:{...l,aiReport:t,activeActions:s}))},b=async(t,s,l)=>{if(e&&"STUDENT"===e.role&&d){c(e=>e?function(e,t,s,l){let a=e=>(Array.isArray(e)?e:[]).map(e=>e&&e.id===t?{...e,ticks:function(e,t,s){let l=(Array.isArray(e)?[...e]:[]).filter(e=>String((null==e?void 0:e.date)||"")!==t);return s&&l.push({date:t,completed:!0}),l}(e.ticks,s,l)}:e),n={...e};if(n.activeActions=a(n.activeActions),n.actionsByMonth&&"object"==typeof n.actionsByMonth){let e={...n.actionsByMonth};for(let t of Object.keys(e))e[t]=a(e[t]);n.actionsByMonth=e}return n}(e,t,s,l):e);try{let a=await r.tick(e.username,t,s,l);if(null==a?void 0:a.student)c(a.student);else{let t=await r.getStudentMe(e.username);c(t)}}catch(t){c(await r.getStudentMe(e.username))}}};return s?(0,l.jsx)("div",{className:"p-6 text-slate-600",children:"Đang tải..."}):"LOGIN"===x?(0,l.jsx)(e9,{onLogin:m}):"STUDENT"===x?d?(0,l.jsx)(P,{student:d,onLogout:u,onUpdateAction:b}):(0,l.jsx)("div",{className:"p-6 text-slate-600",children:"Đang tải dữ liệu học sinh..."}):"ADMIN"===x&&e?(0,l.jsx)(eQ,{user:e,students:i,onLogout:u,onImportData:p,onUpdateStudentReport:g}):(0,l.jsx)(eL,{students:i,onImportData:p,onUpdateStudentReport:g,onLogout:u})}},81389:(e,t,s)=>{Promise.resolve().then(s.bind(s,43205))}},e=>{e.O(0,[485,441,255,358],()=>e(e.s=81389)),_N_E=e.O()}]);